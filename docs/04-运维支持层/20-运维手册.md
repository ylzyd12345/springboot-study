# Spring4demo è¿ç»´æ‰‹å†Œ

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡æ¡£åç§°** | Spring4demo è¿ç»´æ‰‹å†Œ |
| **ç‰ˆæœ¬å·** | v1.0.0 |
| **åˆ›å»ºæ—¥æœŸ** | 2025-12-24 |
| **ä½œè€…** | è¿ç»´å·¥ç¨‹å¸ˆ |
| **å®¡æ ¸äºº** | è¿ç»´ç»ç† |
| **æ‰¹å‡†äºº** | æŠ€æœ¯æ€»ç›‘ |

## ğŸ¯ è¿ç»´æ¦‚è¿°

### è¿ç»´ç›®æ ‡

#### 1. ç³»ç»Ÿå¯ç”¨æ€§
- **ç›®æ ‡å¯ç”¨æ€§**: 99.9% (å¹´åœæœºæ—¶é—´ < 8.76å°æ—¶)
- **æ•…éšœæ¢å¤æ—¶é—´**: < 30åˆ†é’Ÿ (RTO)
- **æ•°æ®æ¢å¤ç‚¹**: < 1å°æ—¶ (RPO)

#### 2. æ€§èƒ½æŒ‡æ ‡
- **å“åº”æ—¶é—´**: APIå¹³å‡å“åº”æ—¶é—´ < 200ms
- **ååé‡**: æ”¯æŒ1000+å¹¶å‘ç”¨æˆ·
- **èµ„æºåˆ©ç”¨ç‡**: CPU < 70%, å†…å­˜ < 80%, ç£ç›˜ < 85%

#### 3. å®‰å…¨åˆè§„
- **æ¼æ´ä¿®å¤**: é«˜å±æ¼æ´24å°æ—¶å†…ä¿®å¤
- **è®¿é—®æ§åˆ¶**: æœ€å°æƒé™åŸåˆ™
- **æ•°æ®ä¿æŠ¤**: ç¬¦åˆGDPRã€ç­‰ä¿2.0è¦æ±‚

### è¿ç»´æ¶æ„

```mermaid
graph TB
    subgraph "ç›‘æ§å±‚"
        A1[åº”ç”¨ç›‘æ§] --> A2[Prometheus]
        A3[æ—¥å¿—ç›‘æ§] --> A4[ELK Stack]
        A5[é“¾è·¯è¿½è¸ª] --> A6[Zipkin]
    end
    
    subgraph "å‘Šè­¦å±‚"
        B1[å‘Šè­¦è§„åˆ™] --> B2[AlertManager]
        B3[é€šçŸ¥æ¸ é“] --> B4[é‚®ä»¶/çŸ­ä¿¡/é’‰é’‰]
    end
    
    subgraph "è‡ªåŠ¨åŒ–å±‚"
        C1[CI/CD] --> C2[GitHub Actions]
        C3[é…ç½®ç®¡ç†] --> C4[Ansible]
        C5[å®¹å™¨ç¼–æ’] --> C6[Kubernetes]
    end
    
    subgraph "å¤‡ä»½å±‚"
        D1[æ•°æ®å¤‡ä»½] --> D2[æ•°æ®åº“å¤‡ä»½]
        D3[æ–‡ä»¶å¤‡ä»½] --> D4[å¯¹è±¡å­˜å‚¨]
        D5[é…ç½®å¤‡ä»½] --> D6[Gitä»“åº“]
    end
    
    A1 --> B1
    B1 --> C1
    C1 --> D1
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### ç¯å¢ƒè¦æ±‚

#### ç¡¬ä»¶è¦æ±‚

| ç¯å¢ƒ | CPU | å†…å­˜ | ç£ç›˜ | ç½‘ç»œ |
|------|-----|------|------|------|
| å¼€å‘ç¯å¢ƒ | 2æ ¸ | 4GB | 50GB SSD | 100Mbps |
| æµ‹è¯•ç¯å¢ƒ | 4æ ¸ | 8GB | 100GB SSD | 1Gbps |
| ç”Ÿäº§ç¯å¢ƒ | 8æ ¸ | 16GB | 500GB SSD | 10Gbps |

#### è½¯ä»¶è¦æ±‚

| ç»„ä»¶ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| æ“ä½œç³»ç»Ÿ | CentOS 8+ / Ubuntu 20.04+ | Linuxç³»ç»Ÿ |
| Java | JDK 25+ | OpenJDKæˆ–Oracle JDK |
| Maven | 3.9.0+ | æ„å»ºå·¥å…· |
| Docker | 20.0+ | å®¹å™¨è¿è¡Œæ—¶ |
| Kubernetes | 1.25+ | å®¹å™¨ç¼–æ’ |
| Nginx | 1.20+ | åå‘ä»£ç† |

### å¿«é€Ÿéƒ¨ç½²

#### 1. Docker Composeéƒ¨ç½²

```yaml
# docker-compose.yml
version: '3.8'

services:
  # åº”ç”¨æœåŠ¡
  spring4demo-app:
    image: spring4demo:latest
    container_name: spring4demo-app
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/spring4demo
      - SPRING_DATASOURCE_USERNAME=spring4demo
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
      - SPRING_REDIS_HOST=redis
      - SPRING_RABBITMQ_HOST=rabbitmq
    depends_on:
      - mysql
      - redis
      - rabbitmq
    volumes:
      - ./logs:/app/logs
    networks:
      - spring4demo-network
    restart: unless-stopped

  # MySQLæ•°æ®åº“
  mysql:
    image: mysql:8.0
    container_name: spring4demo-mysql
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=spring4demo
      - MYSQL_USER=spring4demo
      - MYSQL_PASSWORD=${DB_PASSWORD}
    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql
      - ./mysql/init:/docker-entrypoint-initdb.d
    networks:
      - spring4demo-network
    restart: unless-stopped

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    container_name: spring4demo-redis
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
      - ./redis/redis.conf:/usr/local/etc/redis/redis.conf
    command: redis-server /usr/local/etc/redis/redis.conf
    networks:
      - spring4demo-network
    restart: unless-stopped

  # RabbitMQæ¶ˆæ¯é˜Ÿåˆ—
  rabbitmq:
    image: rabbitmq:3.12-management
    container_name: spring4demo-rabbitmq
    environment:
      - RABBITMQ_DEFAULT_USER=admin
      - RABBITMQ_DEFAULT_PASS=${RABBITMQ_PASSWORD}
    ports:
      - "5672:5672"
      - "15672:15672"
    volumes:
      - rabbitmq-data:/var/lib/rabbitmq
    networks:
      - spring4demo-network
    restart: unless-stopped

  # Nginxåå‘ä»£ç†
  nginx:
    image: nginx:alpine
    container_name: spring4demo-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl:/etc/nginx/ssl
    depends_on:
      - spring4demo-app
    networks:
      - spring4demo-network
    restart: unless-stopped

volumes:
  mysql-data:
  redis-data:
  rabbitmq-data:

networks:
  spring4demo-network:
    driver: bridge
```

#### 2. ç¯å¢ƒå˜é‡é…ç½®

```bash
# .env
# æ•°æ®åº“é…ç½®
MYSQL_ROOT_PASSWORD=your_root_password
DB_PASSWORD=your_db_password

# RabbitMQé…ç½®
RABBITMQ_PASSWORD=your_rabbitmq_password

# SSLè¯ä¹¦è·¯å¾„
SSL_CERT_PATH=./nginx/ssl/cert.pem
SSL_KEY_PATH=./nginx/ssl/key.pem
```

#### 3. éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# deploy.sh

set -e

echo "å¼€å§‹éƒ¨ç½² Spring4demo..."

# æ£€æŸ¥Dockerå’ŒDocker Compose
if ! command -v docker &> /dev/null; then
    echo "é”™è¯¯: Dockeræœªå®‰è£…"
    exit 1
fi

if ! command -v docker-compose &> /dev/null; then
    echo "é”™è¯¯: Docker Composeæœªå®‰è£…"
    exit 1
fi

# åˆ›å»ºå¿…è¦çš„ç›®å½•
mkdir -p logs mysql/init redis nginx/ssl

# å¤åˆ¶é…ç½®æ–‡ä»¶
if [ ! -f nginx/nginx.conf ]; then
    cp nginx/nginx.conf.example nginx/nginx.conf
fi

if [ ! -f redis/redis.conf ]; then
    cp redis/redis.conf.example redis/redis.conf
fi

# æ„å»ºåº”ç”¨é•œåƒ
echo "æ„å»ºåº”ç”¨é•œåƒ..."
docker build -t spring4demo:latest .

# å¯åŠ¨æœåŠ¡
echo "å¯åŠ¨æœåŠ¡..."
docker-compose up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨
echo "ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 30

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo "æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
docker-compose ps

# å¥åº·æ£€æŸ¥
echo "æ‰§è¡Œå¥åº·æ£€æŸ¥..."
curl -f http://localhost:8080/actuator/health || {
    echo "é”™è¯¯: åº”ç”¨å¥åº·æ£€æŸ¥å¤±è´¥"
    docker-compose logs spring4demo-app
    exit 1
}

echo "éƒ¨ç½²å®Œæˆ!"
echo "åº”ç”¨åœ°å€: http://localhost"
echo "APIæ–‡æ¡£: http://localhost/swagger-ui.html"
echo "ç›‘æ§é¢æ¿: http://localhost:3000 (Grafana)"
```

### Kuberneteséƒ¨ç½²

#### 1. å‘½åç©ºé—´é…ç½®

```yaml
# k8s/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: spring4demo
  labels:
    name: spring4demo
```

#### 2. é…ç½®æ˜ å°„

```yaml
# k8s/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: spring4demo-config
  namespace: spring4demo
data:
  application.yml: |
    spring:
      application:
        name: spring4demo
      profiles:
        active: prod
      datasource:
        url: jdbc:mysql://mysql-service:3306/spring4demo
        username: spring4demo
        password: ${DB_PASSWORD}
      redis:
        host: redis-service
        port: 6379
      rabbitmq:
        host: rabbitmq-service
        port: 5672
        username: admin
        password: ${RABBITMQ_PASSWORD}
    
    server:
      port: 8080
    
    management:
      endpoints:
        web:
          exposure:
            include: health,info,metrics,prometheus
      endpoint:
        health:
          show-details: always
```

#### 3. å¯†é’¥é…ç½®

```yaml
# k8s/secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: spring4demo-secrets
  namespace: spring4demo
type: Opaque
data:
  db-password: eW91cl9kYl9wYXNzd29yZA==  # base64ç¼–ç 
  rabbitmq-password: eW91cl9yYWJiaXRtcV9wYXNzd29yZA==
  jwt-secret: eW91cl9qd3Rfc2VjcmV0
```

#### 4. åº”ç”¨éƒ¨ç½²

```yaml
# k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: spring4demo-deployment
  namespace: spring4demo
  labels:
    app: spring4demo
spec:
  replicas: 3
  selector:
    matchLabels:
      app: spring4demo
  template:
    metadata:
      labels:
        app: spring4demo
    spec:
      containers:
      - name: spring4demo
        image: spring4demo:latest
        ports:
        - containerPort: 8080
        env:
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: spring4demo-secrets
              key: db-password
        - name: RABBITMQ_PASSWORD
          valueFrom:
            secretKeyRef:
              name: spring4demo-secrets
              key: rabbitmq-password
        - name: JWT_SECRET
          valueFrom:
            secretKeyRef:
              name: spring4demo-secrets
              key: jwt-secret
        volumeMounts:
        - name: config-volume
          mountPath: /app/config
        - name: logs-volume
          mountPath: /app/logs
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 5
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
      volumes:
      - name: config-volume
        configMap:
          name: spring4demo-config
      - name: logs-volume
        emptyDir: {}
---
apiVersion: v1
kind: Service
metadata:
  name: spring4demo-service
  namespace: spring4demo
spec:
  selector:
    app: spring4demo
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8080
  type: ClusterIP
```

#### 5. Ingressé…ç½®

```yaml
# k8s/ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: spring4demo-ingress
  namespace: spring4demo
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
spec:
  tls:
  - hosts:
    - api.spring4demo.com
    secretName: spring4demo-tls
  rules:
  - host: api.spring4demo.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: spring4demo-service
            port:
              number: 80
```

#### 6. éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# k8s-deploy.sh

set -e

NAMESPACE="spring4demo"
KUBECTL="kubectl"

echo "å¼€å§‹Kuberneteséƒ¨ç½²..."

# åˆ›å»ºå‘½åç©ºé—´
echo "åˆ›å»ºå‘½åç©ºé—´..."
$KUBECTL apply -f k8s/namespace.yaml

# åº”ç”¨é…ç½®
echo "åº”ç”¨é…ç½®æ–‡ä»¶..."
$KUBECTL apply -f k8s/configmap.yaml
$KUBECTL apply -f k8s/secret.yaml

# éƒ¨ç½²æ•°æ®åº“
echo "éƒ¨ç½²æ•°æ®åº“..."
$KUBECTL apply -f k8s/mysql/
$KUBECTL apply -f k8s/redis/
$KUBECTL apply -f k8s/rabbitmq/

# ç­‰å¾…æ•°æ®åº“å°±ç»ª
echo "ç­‰å¾…æ•°æ®åº“å°±ç»ª..."
$KUBECTL wait --for=condition=ready pod -l app=mysql -n $NAMESPACE --timeout=300s
$KUBECTL wait --for=condition=ready pod -l app=redis -n $NAMESPACE --timeout=300s
$KUBECTL wait --for=condition=ready pod -l app=rabbitmq -n $NAMESPACE --timeout=300s

# éƒ¨ç½²åº”ç”¨
echo "éƒ¨ç½²åº”ç”¨..."
$KUBECTL apply -f k8s/deployment.yaml
$KUBECTL apply -f k8s/service.yaml
$KUBECTL apply -f k8s/ingress.yaml

# ç­‰å¾…åº”ç”¨å°±ç»ª
echo "ç­‰å¾…åº”ç”¨å°±ç»ª..."
$KUBECTL wait --for=condition=available deployment/spring4demo-deployment -n $NAMESPACE --timeout=600s

# æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
echo "æ£€æŸ¥éƒ¨ç½²çŠ¶æ€..."
$KUBECTL get pods -n $NAMESPACE
$KUBECTL get services -n $NAMESPACE
$KUBECTL get ingress -n $NAMESPACE

echo "Kuberneteséƒ¨ç½²å®Œæˆ!"
```

## ğŸ“Š ç›‘æ§é…ç½®

### Prometheusé…ç½®

#### 1. Prometheusé…ç½®æ–‡ä»¶

```yaml
# prometheus/prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "rules/*.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093

scrape_configs:
  # Spring Bootåº”ç”¨ç›‘æ§
  - job_name: 'spring4demo'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['spring4demo-app:8080']
    scrape_interval: 15s
    scrape_timeout: 10s

  # MySQLç›‘æ§
  - job_name: 'mysql'
    static_configs:
      - targets: ['mysql-exporter:9104']

  # Redisç›‘æ§
  - job_name: 'redis'
    static_configs:
      - targets: ['redis-exporter:9121']

  # RabbitMQç›‘æ§
  - job_name: 'rabbitmq'
    static_configs:
      - targets: ['rabbitmq:15692']

  # Nodeç›‘æ§
  - job_name: 'node'
    static_configs:
      - targets: ['node-exporter:9100']

  # Kubernetesç›‘æ§
  - job_name: 'kubernetes-apiservers'
    kubernetes_sd_configs:
    - role: endpoints
    scheme: https
    tls_config:
      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
    relabel_configs:
    - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
      action: keep
      regex: default;kubernetes;https
```

#### 2. å‘Šè­¦è§„åˆ™

```yaml
# prometheus/rules/spring4demo.yml
groups:
- name: spring4demo.rules
  rules:
  # åº”ç”¨å¯ç”¨æ€§å‘Šè­¦
  - alert: ApplicationDown
    expr: up{job="spring4demo"} == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "Spring4demoåº”ç”¨ä¸å¯ç”¨"
      description: "Spring4demoåº”ç”¨å·²åœæ­¢è¿è¡Œè¶…è¿‡1åˆ†é’Ÿ"

  # é«˜é”™è¯¯ç‡å‘Šè­¦
  - alert: HighErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.1
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "åº”ç”¨é”™è¯¯ç‡è¿‡é«˜"
      description: "5xxé”™è¯¯ç‡è¶…è¿‡10%ï¼ŒæŒç»­5åˆ†é’Ÿ"

  # é«˜å“åº”æ—¶é—´å‘Šè­¦
  - alert: HighResponseTime
    expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 1
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "åº”ç”¨å“åº”æ—¶é—´è¿‡é•¿"
      description: "95%è¯·æ±‚å“åº”æ—¶é—´è¶…è¿‡1ç§’"

  # å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦
  - alert: HighMemoryUsage
    expr: (jvm_memory_used_bytes / jvm_memory_max_bytes) * 100 > 80
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
      description: "JVMå†…å­˜ä½¿ç”¨ç‡è¶…è¿‡80%"

  # CPUä½¿ç”¨ç‡å‘Šè­¦
  - alert: HighCpuUsage
    expr: rate(process_cpu_seconds_total[5m]) * 100 > 80
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "CPUä½¿ç”¨ç‡è¿‡é«˜"
      description: "CPUä½¿ç”¨ç‡è¶…è¿‡80%"

  # æ•°æ®åº“è¿æ¥æ± å‘Šè­¦
  - alert: DatabaseConnectionPoolExhausted
    expr: hikaricp_connections_active / hikaricp_connections_max > 0.9
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "æ•°æ®åº“è¿æ¥æ± å³å°†è€—å°½"
      description: "æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡è¶…è¿‡90%"

  # Redisè¿æ¥å‘Šè­¦
  - alert: RedisConnectionFailed
    expr: redis_up == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "Redisè¿æ¥å¤±è´¥"
      description: "æ— æ³•è¿æ¥åˆ°RedisæœåŠ¡å™¨"
```

### Grafanaä»ªè¡¨æ¿

#### 1. åº”ç”¨æ€§èƒ½ä»ªè¡¨æ¿

```json
{
  "dashboard": {
    "title": "Spring4demoåº”ç”¨æ€§èƒ½",
    "panels": [
      {
        "title": "è¯·æ±‚ç‡",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(http_requests_total[5m])",
            "legendFormat": "{{method}} {{uri}}"
          }
        ]
      },
      {
        "title": "å“åº”æ—¶é—´",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "95th percentile"
          },
          {
            "expr": "histogram_quantile(0.50, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "50th percentile"
          }
        ]
      },
      {
        "title": "é”™è¯¯ç‡",
        "type": "singlestat",
        "targets": [
          {
            "expr": "rate(http_requests_total{status=~\"5..\"}[5m]) / rate(http_requests_total[5m]) * 100"
          }
        ]
      },
      {
        "title": "JVMå†…å­˜",
        "type": "graph",
        "targets": [
          {
            "expr": "jvm_memory_used_bytes{area=\"heap\"}",
            "legendFormat": "Heap Used"
          },
          {
            "expr": "jvm_memory_max_bytes{area=\"heap\"}",
            "legendFormat": "Heap Max"
          }
        ]
      }
    ]
  }
}
```

### æ—¥å¿—ç®¡ç†

#### 1. Logstashé…ç½®

```ruby
# logstash/pipeline/spring4demo.conf
input {
  beats {
    port => 5044
  }
}

filter {
  if [fields][service] == "spring4demo" {
    # è§£æJSONæ ¼å¼æ—¥å¿—
    json {
      source => "message"
    }
    
    # è§£ææ—¶é—´æˆ³
    date {
      match => [ "timestamp", "ISO8601" ]
    }
    
    # æ·»åŠ æ ‡ç­¾
    mutate {
      add_tag => [ "spring4demo", "java" ]
    }
    
    # è§£æå¼‚å¸¸å †æ ˆ
    if [exception] {
      multiline {
        pattern => "^\\s"
        what => "previous"
      }
    }
    
    # è§£ææ…¢æŸ¥è¯¢æ—¥å¿—
    if [logger_name] == "com.kev1n.spring4demo.performance" {
      grok {
        match => { "message" => "%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:level} %{GREEDYDATA:message}" }
      }
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "spring4demo-%{+YYYY.MM.dd}"
  }
  
  # è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºç”¨äºè°ƒè¯•
  stdout {
    codec => rubydebug
  }
}
```

#### 2. Filebeaté…ç½®

```yaml
# filebeat/filebeat.yml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /app/logs/*.log
  fields:
    service: spring4demo
    environment: production
  fields_under_root: true
  multiline.pattern: '^\d{4}-\d{2}-\d{2}'
  multiline.negate: true
  multiline.match: after

output.logstash:
  hosts: ["logstash:5044"]

processors:
- add_host_metadata:
    when.not.contains.tags: forwarded
- add_docker_metadata: ~
- add_kubernetes_metadata: ~
```

## ğŸ”§ æ•…éšœå¤„ç†

### å¸¸è§æ•…éšœæ’æŸ¥

#### 1. åº”ç”¨æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**: åº”ç”¨å¯åŠ¨å¤±è´¥ï¼Œå®¹å™¨é€€å‡º

**æ’æŸ¥æ­¥éª¤**:
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs spring4demo-app

# æ£€æŸ¥é…ç½®æ–‡ä»¶
docker exec -it spring4demo-app cat /app/config/application.yml

# æ£€æŸ¥ç¯å¢ƒå˜é‡
docker exec -it spring4demo-app env | grep SPRING

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 8080

# æ£€æŸ¥JVMå‚æ•°
docker exec -it spring4demo-app jps -v
```

**å¸¸è§åŸå› åŠè§£å†³æ–¹æ¡ˆ**:
- æ•°æ®åº“è¿æ¥å¤±è´¥: æ£€æŸ¥æ•°æ®åº“æœåŠ¡å’Œè¿æ¥é…ç½®
- ç«¯å£å†²çª: ä¿®æ”¹server.porté…ç½®
- å†…å­˜ä¸è¶³: è°ƒæ•´JVM heapå¤§å°
- é…ç½®é”™è¯¯: æ£€æŸ¥application.ymlè¯­æ³•

#### 2. æ•°æ®åº“è¿æ¥é—®é¢˜

**ç—‡çŠ¶**: åº”ç”¨æ—¥å¿—æ˜¾ç¤ºæ•°æ®åº“è¿æ¥é”™è¯¯

**æ’æŸ¥æ­¥éª¤**:
```bash
# æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
docker exec -it spring4demo-mysql mysql -u root -p -e "SHOW PROCESSLIST;"

# æ£€æŸ¥è¿æ¥æ•°
docker exec -it spring4demo-mysql mysql -u root -p -e "SHOW STATUS LIKE 'Threads_connected';"

# æ£€æŸ¥æ…¢æŸ¥è¯¢
docker exec -it spring4demo-mysql mysql -u root -p -e "SHOW VARIABLES LIKE 'slow_query_log';"

# æµ‹è¯•è¿æ¥
docker exec -it spring4demo-app telnet mysql 3306
```

**è§£å†³æ–¹æ¡ˆ**:
```sql
-- å¢åŠ æœ€å¤§è¿æ¥æ•°
SET GLOBAL max_connections = 1000;

-- ä¼˜åŒ–è¿æ¥æ± é…ç½®
-- åœ¨application.ymlä¸­è°ƒæ•´
spring:
  datasource:
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 20000
```

#### 3. Redisè¿æ¥é—®é¢˜

**ç—‡çŠ¶**: ç¼“å­˜æ“ä½œå¤±è´¥ï¼Œæ€§èƒ½ä¸‹é™

**æ’æŸ¥æ­¥éª¤**:
```bash
# æ£€æŸ¥RedisæœåŠ¡çŠ¶æ€
docker exec -it spring4demo-redis redis-cli ping

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
docker exec -it spring4demo-redis redis-cli info memory

# æ£€æŸ¥è¿æ¥æ•°
docker exec -it spring4demo-redis redis-cli info clients

# æ£€æŸ¥æ…¢æŸ¥è¯¢
docker exec -it spring4demo-redis redis-cli slowlog get 10
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ¸…ç†è¿‡æœŸé”®
docker exec -it spring4demo-redis redis-cli --scan --pattern "*" | xargs docker exec -i spring4demo-redis redis-cli del

# ç›‘æ§Redisæ€§èƒ½
docker exec -it spring4demo-redis redis-cli monitor
```

### æ•…éšœæ¢å¤æµç¨‹

#### 1. æœåŠ¡é‡å¯æµç¨‹

```bash
#!/bin/bash
# restart-service.sh

SERVICE_NAME=$1
NAMESPACE=${2:-spring4demo}

if [ -z "$SERVICE_NAME" ]; then
    echo "ç”¨æ³•: $0 <service-name> [namespace]"
    exit 1
fi

echo "é‡å¯æœåŠ¡: $SERVICE_NAME"

# æ»šåŠ¨æ›´æ–°éƒ¨ç½²
kubectl rollout restart deployment/$SERVICE_NAME -n $NAMESPACE

# ç­‰å¾…æ›´æ–°å®Œæˆ
kubectl rollout status deployment/$SERVICE_NAME -n $NAMESPACE --timeout=300s

# æ£€æŸ¥PodçŠ¶æ€
kubectl get pods -l app=$SERVICE_NAME -n $NAMESPACE

echo "æœåŠ¡é‡å¯å®Œæˆ"
```

#### 2. æ•°æ®åº“æ¢å¤æµç¨‹

```bash
#!/bin/bash
# restore-database.sh

BACKUP_FILE=$1
DB_NAME=${2:-spring4demo}

if [ -z "$BACKUP_FILE" ]; then
    echo "ç”¨æ³•: $0 <backup-file> [database-name]"
    exit 1
fi

echo "æ¢å¤æ•°æ®åº“: $DB_NAME ä»å¤‡ä»½æ–‡ä»¶: $BACKUP_FILE"

# åœæ­¢åº”ç”¨æœåŠ¡
kubectl scale deployment spring4demo-deployment --replicas=0 -n spring4demo

# æ¢å¤æ•°æ®åº“
kubectl exec -i mysql-0 -n spring4demo -- mysql -u root -p$MYSQL_ROOT_PASSWORD $DB_NAME < $BACKUP_FILE

# é‡å¯åº”ç”¨æœåŠ¡
kubectl scale deployment spring4demo-deployment --replicas=3 -n spring4demo

# ç­‰å¾…æœåŠ¡å°±ç»ª
kubectl wait --for=condition=available deployment/spring4demo-deployment -n spring4demo --timeout=300s

echo "æ•°æ®åº“æ¢å¤å®Œæˆ"
```

#### 3. ç´§æ€¥æ•…éšœå“åº”

```bash
#!/bin/bash
# emergency-response.sh

INCIDENT_TYPE=$1

case $INCIDENT_TYPE in
    "app_down")
        echo "åº”ç”¨å®•æœºåº”æ€¥å“åº”"
        # æ£€æŸ¥åº”ç”¨çŠ¶æ€
        kubectl get pods -n spring4demo
        # é‡å¯åº”ç”¨
        kubectl rollout restart deployment/spring4demo-deployment -n spring4demo
        ;;
    "db_down")
        echo "æ•°æ®åº“å®•æœºåº”æ€¥å“åº”"
        # æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
        kubectl get pods -l app=mysql -n spring4demo
        # é‡å¯æ•°æ®åº“
        kubectl delete pod mysql-0 -n spring4demo
        ;;
    "high_cpu")
        echo "é«˜CPUä½¿ç”¨ç‡åº”æ€¥å“åº”"
        # æ‰©å®¹åº”ç”¨å®ä¾‹
        kubectl scale deployment spring4demo-deployment --replicas=5 -n spring4demo
        ;;
    "high_memory")
        echo "é«˜å†…å­˜ä½¿ç”¨ç‡åº”æ€¥å“åº”"
        # é‡å¯åº”ç”¨é‡Šæ”¾å†…å­˜
        kubectl rollout restart deployment/spring4demo-deployment -n spring4demo
        ;;
    *)
        echo "æœªçŸ¥æ•…éšœç±»å‹: $INCIDENT_TYPE"
        exit 1
        ;;
esac
```

## ğŸ“‹ ç»´æŠ¤è®¡åˆ’

### å®šæœŸç»´æŠ¤ä»»åŠ¡

#### 1. æ—¥å¸¸ç»´æŠ¤ (æ¯æ—¥)

```bash
#!/bin/bash
# daily-maintenance.sh

echo "å¼€å§‹æ—¥å¸¸ç»´æŠ¤ä»»åŠ¡..."

# æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
echo "æ£€æŸ¥ç³»ç»ŸçŠ¶æ€..."
kubectl get pods -n spring4demo
kubectl get nodes

# æ¸…ç†æ—¥å¿—æ–‡ä»¶
echo "æ¸…ç†æ—¥å¿—æ–‡ä»¶..."
find /var/log -name "*.log" -mtime +7 -delete

# æ£€æŸ¥ç£ç›˜ç©ºé—´
echo "æ£€æŸ¥ç£ç›˜ç©ºé—´..."
df -h

# å¤‡ä»½é…ç½®æ–‡ä»¶
echo "å¤‡ä»½é…ç½®æ–‡ä»¶..."
kubectl get configmap -n spring4demo -o yaml > backup/configmap-$(date +%Y%m%d).yaml
kubectl get secret -n spring4demo -o yaml > backup/secret-$(date +%Y%m%d).yaml

# å‘é€çŠ¶æ€æŠ¥å‘Š
echo "å‘é€çŠ¶æ€æŠ¥å‘Š..."
./scripts/send-status-report.sh

echo "æ—¥å¸¸ç»´æŠ¤å®Œæˆ"
```

#### 2. å‘¨æœŸç»´æŠ¤ (æ¯å‘¨)

```bash
#!/bin/bash
# weekly-maintenance.sh

echo "å¼€å§‹å‘¨æœŸç»´æŠ¤ä»»åŠ¡..."

# æ›´æ–°ç³»ç»Ÿè¡¥ä¸
echo "æ›´æ–°ç³»ç»Ÿè¡¥ä¸..."
apt update && apt upgrade -y

# æ¸…ç†Dockeré•œåƒ
echo "æ¸…ç†Dockeré•œåƒ..."
docker system prune -f

# æ•°æ®åº“ä¼˜åŒ–
echo "æ•°æ®åº“ä¼˜åŒ–..."
kubectl exec -i mysql-0 -n spring4demo -- mysql -u root -p$MYSQL_ROOT_PASSWORD -e "OPTIMIZE TABLE spring4demo.users;"

# æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
echo "æ£€æŸ¥SSLè¯ä¹¦..."
./scripts/check-ssl-certificates.sh

# æ€§èƒ½æµ‹è¯•
echo "æ‰§è¡Œæ€§èƒ½æµ‹è¯•..."
./scripts/performance-test.sh

echo "å‘¨æœŸç»´æŠ¤å®Œæˆ"
```

#### 3. æœˆåº¦ç»´æŠ¤ (æ¯æœˆ)

```bash
#!/bin/bash
# monthly-maintenance.sh

echo "å¼€å§‹æœˆåº¦ç»´æŠ¤ä»»åŠ¡..."

# å®‰å…¨æ‰«æ
echo "æ‰§è¡Œå®‰å…¨æ‰«æ..."
./scripts/security-scan.sh

# å®¹é‡è§„åˆ’
echo "å®¹é‡è§„åˆ’åˆ†æ..."
./scripts/capacity-planning.sh

# å¤‡ä»½éªŒè¯
echo "éªŒè¯å¤‡ä»½æ–‡ä»¶..."
./scripts/verify-backups.sh

# æ–‡æ¡£æ›´æ–°
echo "æ›´æ–°è¿ç»´æ–‡æ¡£..."
./scripts/update-documentation.sh

echo "æœˆåº¦ç»´æŠ¤å®Œæˆ"
```

### å¤‡ä»½ç­–ç•¥

#### 1. æ•°æ®åº“å¤‡ä»½

```bash
#!/bin/bash
# backup-database.sh

BACKUP_DIR="/backup/mysql"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="spring4demo"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å…¨é‡å¤‡ä»½
echo "æ‰§è¡Œå…¨é‡å¤‡ä»½..."
mysqldump -h mysql -u root -p$MYSQL_ROOT_PASSWORD \
  --single-transaction \
  --routines \
  --triggers \
  $DB_NAME | gzip > $BACKUP_DIR/${DB_NAME}_full_${DATE}.sql.gz

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.sql.gz" -mtime +7 -delete

echo "æ•°æ®åº“å¤‡ä»½å®Œæˆ: ${DB_NAME}_full_${DATE}.sql.gz"
```

#### 2. åº”ç”¨é…ç½®å¤‡ä»½

```bash
#!/bin/bash
# backup-config.sh

BACKUP_DIR="/backup/config"
DATE=$(date +%Y%m%d_%H%M%S)
NAMESPACE="spring4demo"

mkdir -p $BACKUP_DIR

# å¤‡ä»½ConfigMap
kubectl get configmap -n $NAMESPACE -o yaml > $BACKUP_DIR/configmap_${DATE}.yaml

# å¤‡ä»½Secret
kubectl get secret -n $NAMESPACE -o yaml > $BACKUP_DIR/secret_${DATE}.yaml

# å¤‡ä»½Deployment
kubectl get deployment -n $NAMESPACE -o yaml > $BACKUP_DIR/deployment_${DATE}.yaml

# å¤‡ä»½Service
kubectl get service -n $NAMESPACE -o yaml > $BACKUP_DIR/service_${DATE}.yaml

# å¤‡ä»½Ingress
kubectl get ingress -n $NAMESPACE -o yaml > $BACKUP_DIR/ingress_${DATE}.yaml

echo "é…ç½®å¤‡ä»½å®Œæˆ"
```

#### 3. è‡ªåŠ¨å¤‡ä»½é…ç½®

```yaml
# k8s/cronjob-backup.yaml
apiVersion: batch/v1
kind: CronJob
metadata:
  name: database-backup
  namespace: spring4demo
spec:
  schedule: "0 2 * * *"  # æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: mysql-backup
            image: mysql:8.0
            command:
            - /bin/bash
            - -c
            - |
              mysqldump -h mysql -u root -p$MYSQL_ROOT_PASSWORD \
                --single-transaction \
                --routines \
                --triggers \
                spring4demo | gzip > /backup/${DB_NAME}_$(date +%Y%m%d_%H%M%S).sql.gz
            env:
            - name: MYSQL_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: spring4demo-secrets
                  key: db-password
            volumeMounts:
            - name: backup-storage
              mountPath: /backup
          volumes:
          - name: backup-storage
            persistentVolumeClaim:
              claimName: backup-pvc
          restartPolicy: OnFailure
```

## ğŸ”’ å®‰å…¨è¿ç»´

### å®‰å…¨æ£€æŸ¥æ¸…å•

#### 1. ç³»ç»Ÿå®‰å…¨æ£€æŸ¥

```bash
#!/bin/bash
# security-check.sh

echo "æ‰§è¡Œç³»ç»Ÿå®‰å…¨æ£€æŸ¥..."

# æ£€æŸ¥å¼€æ”¾ç«¯å£
echo "æ£€æŸ¥å¼€æ”¾ç«¯å£..."
nmap -sT -O localhost

# æ£€æŸ¥ç”¨æˆ·æƒé™
echo "æ£€æŸ¥ç”¨æˆ·æƒé™..."
cat /etc/passwd | grep -E "sh$"

# æ£€æŸ¥sudoæƒé™
echo "æ£€æŸ¥sudoæƒé™..."
cat /etc/sudoers

# æ£€æŸ¥SSHé…ç½®
echo "æ£€æŸ¥SSHé…ç½®..."
cat /etc/ssh/sshd_config | grep -E "PermitRootLogin|PasswordAuthentication"

# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
echo "æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€..."
ufw status

# æ£€æŸ¥è¿›ç¨‹
echo "æ£€æŸ¥å¯ç–‘è¿›ç¨‹..."
ps aux | grep -E "sh|bash|python|perl" | grep -v grep

echo "å®‰å…¨æ£€æŸ¥å®Œæˆ"
```

#### 2. åº”ç”¨å®‰å…¨æ£€æŸ¥

```bash
#!/bin/bash
# app-security-check.sh

echo "æ‰§è¡Œåº”ç”¨å®‰å…¨æ£€æŸ¥..."

# æ£€æŸ¥ä¾èµ–æ¼æ´
echo "æ£€æŸ¥ä¾èµ–æ¼æ´..."
mvn dependency-check:check

# æ£€æŸ¥é…ç½®å®‰å…¨
echo "æ£€æŸ¥é…ç½®å®‰å…¨..."
kubectl get secret -n spring4demo -o yaml | grep -i "password\|key\|secret"

# æ£€æŸ¥ç½‘ç»œç­–ç•¥
echo "æ£€æŸ¥ç½‘ç»œç­–ç•¥..."
kubectl get networkpolicy -n spring4demo

# æ£€æŸ¥Podå®‰å…¨ç­–ç•¥
echo "æ£€æŸ¥Podå®‰å…¨ç­–ç•¥..."
kubectl get psp

# æ£€æŸ¥RBACé…ç½®
echo "æ£€æŸ¥RBACé…ç½®..."
kubectl get role,rolebinding -n spring4demo

echo "åº”ç”¨å®‰å…¨æ£€æŸ¥å®Œæˆ"
```

### è¯ä¹¦ç®¡ç†

#### 1. SSLè¯ä¹¦è‡ªåŠ¨æ›´æ–°

```yaml
# k8s/cert-manager.yaml
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@spring4demo.com
    privateKeySecretRef:
      name: letsencrypt-prod
    solvers:
    - http01:
        ingress:
          class: nginx
```

#### 2. è¯ä¹¦ç›‘æ§è„šæœ¬

```bash
#!/bin/bash
# check-certificates.sh

DOMAINS=("api.spring4demo.com" "admin.spring4demo.com")
ALERT_EMAIL="admin@spring4demo.com"

for domain in "${DOMAINS[@]}"; do
    # è·å–è¯ä¹¦è¿‡æœŸæ—¶é—´
    expiry_date=$(echo | openssl s_client -servername $domain -connect $domain:443 2>/dev/null | openssl x509 -noout -enddate | cut -d= -f2)
    
    # è½¬æ¢ä¸ºæ—¶é—´æˆ³
    expiry_timestamp=$(date -d "$expiry_date" +%s)
    current_timestamp=$(date +%s)
    
    # è®¡ç®—å‰©ä½™å¤©æ•°
    days_left=$(( (expiry_timestamp - current_timestamp) / 86400 ))
    
    echo "$domain è¯ä¹¦è¿˜æœ‰ $days_left å¤©è¿‡æœŸ"
    
    # å¦‚æœå‰©ä½™å¤©æ•°å°‘äº30å¤©ï¼Œå‘é€å‘Šè­¦
    if [ $days_left -lt 30 ]; then
        echo "è­¦å‘Š: $domain è¯ä¹¦å³å°†è¿‡æœŸ" | mail -s "SSLè¯ä¹¦è¿‡æœŸå‘Šè­¦" $ALERT_EMAIL
    fi
done
```

---

*æœ¬è¿ç»´æ‰‹å†Œå°†éšç€ç³»ç»Ÿæ¶æ„å’Œè¿ç»´éœ€æ±‚çš„å˜åŒ–æŒç»­æ›´æ–°ï¼Œç¡®ä¿è¿ç»´å·¥ä½œçš„æœ‰æ•ˆæ€§å’Œå®‰å…¨æ€§ã€‚*