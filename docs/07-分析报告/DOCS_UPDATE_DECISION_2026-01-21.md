# Junmo Platform 设计文档更新决策报告

**决策日期**: 2026年1月21日
**决策依据**: 架构评审报告（ARCHITECTURE_REVIEW_2026-01-21.md）
**决策人**: 架构师

---

## 执行摘要

基于对 junmo-platform 项目的全面架构评审，发现实际代码实现与现有设计文档存在多处不一致。为确保文档与代码的一致性，建议对部分设计文档进行更新。

### 决策结论

**需要更新的设计文档**: 15个文档（共23个）
**无需更新的文档**: 8个文档
**更新优先级**: 高

---

## 评审发现与文档差异分析

### 1. 模块结构差异

#### 实际模块结构（11个模块）
```
junmo-platform/
├── junmo-build-tools/          # 构建工具模块
├── junmo-base/                 # 基础模块（新增）
├── junmo-common/               # 公共模块
├── junmo-api/                  # API 模块
├── junmo-model/                # 模型模块（新增）
├── junmo-core/                 # 核心业务模块
├── junmo-test-support/         # 测试支持模块
├── junmo-integration/          # 集成测试模块
├── junmo-generator/            # 代码生成器模块
├── junmo-starter/              # 前端启动模块
└── junmo-admin-starter/        # 管理后台启动模块
```

#### 设计文档中的模块结构（可能不一致）
设计文档中可能只提到了10个模块，缺少 junmo-base 和 junmo-model 模块。

**影响文档**:
- ✅ 05-项目结构设计.md
- ✅ 04-技术架构设计.md
- ✅ 06-概要设计.md
- ✅ 07-详细设计.md

### 2. 技术栈差异

#### 实际技术栈
- 同时使用 RabbitMQ 和 Kafka
- 使用了更多中间件（Neo4j、InfluxDB3）
- 配置文件数量：18个 yml 文件

#### 设计文档中的技术栈
设计文档可能未反映实际使用的完整技术栈。

**影响文档**:
- ✅ 04-技术架构设计.md
- ✅ 13-非功能性设计.md
- ✅ 20-运维手册.md

### 3. 架构问题差异

#### 实际发现的问题
- 测试覆盖率 0%
- 存在硬编码密码
- junmo-common 模块职责过重
- junmo-core 模块依赖过多
- 配置文件过多（18个）

#### 设计文档中的描述
设计文档可能未反映这些架构问题。

**影响文档**:
- ✅ 07-详细设计.md
- ✅ 18-安全设计详细文档.md
- ✅ 19-测试设计文档.md
- ✅ 20-运维手册.md

### 4. 配置管理差异

#### 实际配置文件
- 18个 yml 配置文件
- 模块化配置（datasource、redis、mq、seata 等）

#### 设计文档中的描述
设计文档可能未反映实际的配置文件数量和结构。

**影响文档**:
- ✅ 20-运维手册.md
- ✅ 22-开发指南.md

---

## 文档更新决策矩阵

### 需要更新的文档（15个）

| 序号 | 文档名称 | 更新原因 | 更新优先级 | 预计工作量 |
|-----|---------|---------|-----------|-----------|
| 1 | 01-产品架构设计.md | 模块结构变化 | P0 | 2小时 |
| 2 | 04-技术架构设计.md | 技术栈差异、模块结构变化 | P0 | 4小时 |
| 3 | 05-项目结构设计.md | 模块结构变化、依赖关系变化 | P0 | 3小时 |
| 4 | 06-概要设计.md | 模块结构变化 | P1 | 3小时 |
| 5 | 07-详细设计.md | 架构问题、模块职责 | P1 | 4小时 |
| 6 | 08-业务架构设计.md | 模块职责变化 | P1 | 3小时 |
| 7 | 11-数据架构设计.md | 数据存储技术栈 | P2 | 2小时 |
| 8 | 13-非功能性设计.md | 技术栈、性能问题 | P1 | 3小时 |
| 9 | 14-部署架构设计.md | Docker配置、模块结构 | P1 | 4小时 |
| 10 | 15-实施方案设计.md | 实施步骤、模块结构 | P2 | 3小时 |
| 11 | 18-安全设计详细文档.md | 安全问题、硬编码密码 | P0 | 3小时 |
| 12 | 19-测试设计文档.md | 测试覆盖率问题 | P0 | 3小时 |
| 13 | 20-运维手册.md | 配置管理、技术栈 | P1 | 4小时 |
| 14 | 22-开发指南.md | 配置文件、模块结构 | P1 | 3小时 |
| 15 | 23-版本发布计划.md | 模块结构变化 | P2 | 2小时 |

### 无需更新的文档（8个）

| 序号 | 文档名称 | 无需更新原因 |
|-----|---------|-------------|
| 1 | 02-项目管理.md | 项目管理流程未变化 |
| 2 | 03-总体设计.md | 总体设计理念未变化 |
| 3 | 09-功能分解设计.md | 功能需求未变化 |
| 4 | 10-应用交互设计.md | 交互设计未变化 |
| 5 | 12-接口设计.md | API设计规范未变化 |
| 6 | 16-API文档规范.md | API文档规范未变化 |
| 7 | 17-数据库详细设计.md | 数据库设计未变化 |
| 8 | 21-用户手册.md | 用户操作流程未变化 |

---

## 详细更新内容

### P0 优先级文档（4个）

#### 1. 01-产品架构设计.md

**更新内容**:
- 更新模块结构图，包含11个模块
- 更新模块职责描述
- 更新模块依赖关系图
- 更新技术栈列表

**关键变更**:
```markdown
## 模块架构

### 新增模块
- **junmo-base**: 基础模块，无依赖，纯基础、无业务、public权限
- **junmo-model**: 模型模块，仅依赖 junmo-base，纯对内数据层

### 模块依赖关系
```

#### 2. 04-技术架构设计.md

**更新内容**:
- 更新技术栈清单（添加 Neo4j、InfluxDB3）
- 更新配置文件数量（18个 yml 文件）
- 更新模块结构图
- 更新架构决策（同时使用 RabbitMQ 和 Kafka）

**关键变更**:
```markdown
## 技术栈

### 新增技术
- **Neo4j**: 图数据库 5.12.0
- **InfluxDB3**: 时序数据库 3.0

### 配置文件
- 配置文件数量：18个 yml 文件
- 模块化配置：datasource、redis、mq、seata 等
```

#### 3. 05-项目结构设计.md

**更新内容**:
- 更新项目结构树（包含11个模块）
- 更新包结构图
- 更新模块依赖关系
- 更新 pom.xml 配置示例

**关键变更**:
```markdown
## 模块结构

```
junmo-platform/
├── junmo-base/                 # 基础模块
├── junmo-model/                # 模型模块
├── junmo-common/               # 公共模块
├── junmo-api/                  # API 模块
├── junmo-core/                 # 核心业务模块
├── junmo-starter/              # 前端启动模块
├── junmo-admin-starter/        # 管理后台启动模块
└── ...
```
```

#### 4. 18-安全设计详细文档.md

**更新内容**:
- 添加硬编码密码安全问题
- 添加安全问题清单
- 更新安全风险评估
- 更新安全改进建议

**关键变更**:
```markdown
## 安全问题

### P0 问题
1. **硬编码密码**: DynamicDataSourceProperties.java 中存在硬编码密码 "admin"
   - 影响：高
   - 解决方案：移至配置文件，使用环境变量管理敏感信息
   - 解决时间：2小时

## 安全改进建议
1. 移除所有硬编码密码
2. 实现敏感信息加密
3. 实现安全审计日志
```

#### 5. 19-测试设计文档.md

**更新内容**:
- 添加测试覆盖率问题
- 更新测试策略
- 添加测试改进计划
- 更新测试覆盖率目标

**关键变更**:
```markdown
## 测试现状

### 测试覆盖率
- 当前覆盖率：0%
- 目标覆盖率：≥ 85%
- 差距：85%

### 测试问题
1. 仅有8个集成测试，无单元测试
2. 未使用 Testcontainers 进行容器化测试
3. 未实现测试覆盖率检查

## 测试改进计划
1. 添加单元测试（5天）
2. 添加集成测试（3天）
3. 启用 Testcontainers（2天）
4. 启用测试覆盖率检查（1天）
```

### P1 优先级文档（8个）

#### 6. 06-概要设计.md
- 更新模块结构
- 更新模块职责
- 更新依赖关系

#### 7. 07-详细设计.md
- 更新模块设计
- 添加架构问题说明
- 更新类设计

#### 8. 08-业务架构设计.md
- 更新模块职责
- 更新业务分层
- 更新业务流程

#### 9. 13-非功能性设计.md
- 更新技术栈
- 添加性能问题
- 更新性能指标

#### 10. 14-部署架构设计.md
- 更新Docker配置
- 更新模块结构
- 更新部署方案

#### 11. 20-运维手册.md
- 更新配置管理
- 更新技术栈
- 添加配置文件说明

#### 12. 22-开发指南.md
- 更新配置文件说明
- 更新模块结构
- 更新开发流程

#### 13. 23-版本发布计划.md
- 更新模块结构
- 更新发布流程

### P2 优先级文档（3个）

#### 14. 11-数据架构设计.md
- 更新数据存储技术栈
- 更新数据访问层设计

#### 15. 15-实施方案设计.md
- 更新实施步骤
- 更新模块结构

---

## 更新实施计划

### 阶段1：P0 文档更新（1周）

**目标**: 更新最关键的设计文档

**任务**:
1. 更新 01-产品架构设计.md（2小时）
2. 更新 04-技术架构设计.md（4小时）
3. 更新 05-项目结构设计.md（3小时）
4. 更新 18-安全设计详细文档.md（3小时）
5. 更新 19-测试设计文档.md（3小时）

**总计**: 15小时（约2个工作日）

### 阶段2：P1 文档更新（1周）

**目标**: 更新重要设计文档

**任务**:
1. 更新 06-概要设计.md（3小时）
2. 更新 07-详细设计.md（4小时）
3. 更新 08-业务架构设计.md（3小时）
4. 更新 13-非功能性设计.md（3小时）
5. 更新 14-部署架构设计.md（4小时）
6. 更新 20-运维手册.md（4小时）
7. 更新 22-开发指南.md（3小时）
8. 更新 23-版本发布计划.md（2小时）

**总计**: 26小时（约3个工作日）

### 阶段3：P2 文档更新（3天）

**目标**: 更新一般设计文档

**任务**:
1. 更新 11-数据架构设计.md（2小时）
2. 更新 15-实施方案设计.md（3小时）
3. 验证所有文档一致性（2小时）

**总计**: 7小时（约1个工作日）

**总工作量**: 48小时（约6个工作日）

---

## 更新验证标准

### 文档一致性检查

- [ ] 所有文档中的模块结构一致（11个模块）
- [ ] 所有文档中的技术栈一致
- [ ] 所有文档中的配置文件数量一致（18个）
- [ ] 所有文档中的包名一致（com.junmo.platform）
- [ ] 所有文档中的项目名称一致（Junmo Platform）

### 文档完整性检查

- [ ] 每个文档都有完整的章节结构
- [ ] 每个文档都有清晰的图表
- [ ] 每个文档都有代码示例
- [ ] 每个文档都有更新日志

### 文档准确性检查

- [ ] 文档描述与实际代码一致
- [ ] 文档中的示例代码可运行
- [ ] 文档中的配置示例正确
- [ ] 文档中的命令可执行

---

## 风险评估

### 更新风险

| 风险 | 影响 | 概率 | 应对措施 |
|-----|------|------|---------|
| 文档更新遗漏 | 中 | 中 | 使用检查清单逐项验证 |
| 文档不一致 | 高 | 中 | 建立文档一致性检查机制 |
| 更新工作量超时 | 中 | 低 | 优先更新P0文档，P1/P2文档可延后 |
| 文档质量下降 | 低 | 低 | 建立文档评审机制 |

### 不更新风险

| 风险 | 影响 | 概率 |
|-----|------|------|
| 文档与代码不一致 | 高 | 高 |
| 新成员理解困难 | 中 | 中 |
| 维护成本增加 | 中 | 中 |
| 架构问题无法追踪 | 高 | 高 |

---

## 最终建议

### 决策

**建议**: 立即开始更新设计文档

**理由**:
1. 实际代码与设计文档存在多处不一致
2. 不更新文档会导致维护成本增加
3. 不更新文档会影响新成员的理解
4. 架构问题需要在文档中记录和追踪

### 优先级

1. **立即执行**: 更新P0文档（5个文档）
2. **1周内完成**: 更新P1文档（8个文档）
3. **2周内完成**: 更新P2文档（3个文档）

### 资源需求

- **人力**: 1名架构师或技术文档编写人员
- **时间**: 6个工作日
- **工具**: Markdown编辑器、图表工具（Mermaid）

### 成功标准

- [ ] 所有文档与代码一致
- [ ] 所有文档通过一致性检查
- [ ] 所有文档通过完整性检查
- [ ] 所有文档通过准确性检查
- [ ] 文档更新日志完整

---

## 附录

### A. 文档更新检查清单

#### 模块结构检查
- [ ] 包含11个模块
- [ ] 包含 junmo-base 模块
- [ ] 包含 junmo-model 模块
- [ ] 模块依赖关系正确
- [ ] 模块职责描述准确

#### 技术栈检查
- [ ] 包含 Neo4j
- [ ] 包含 InfluxDB3
- [ ] 包含 RabbitMQ 和 Kafka
- [ ] 技术版本号正确
- [ ] 技术选型理由清晰

#### 配置文件检查
- [ ] 配置文件数量：18个
- [ ] 配置文件名称正确
- [ ] 配置文件用途清晰
- [ ] 配置文件依赖关系正确

#### 架构问题检查
- [ ] 测试覆盖率问题已记录
- [ ] 硬编码密码问题已记录
- [ ] 模块职责问题已记录
- [ ] 配置文件过多问题已记录

### B. 文档更新日志模板

```markdown
## 更新日志

### 2026-01-21
- 更新模块结构：添加 junmo-base 和 junmo-model 模块
- 更新技术栈：添加 Neo4j 和 InfluxDB3
- 更新配置文件：配置文件数量更新为18个
- 添加架构问题：记录测试覆盖率、硬编码密码等问题
```

---

**决策人**: 架构师
**决策日期**: 2026年1月21日
**下次评审**: 2026年4月21日