# Spring4demo æŠ€æœ¯æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡æ¡£åç§°** | Spring4demo æŠ€æœ¯æ¶æ„è®¾è®¡ |
| **ç‰ˆæœ¬å·** | v1.1.0 |
| **åˆ›å»ºæ—¥æœŸ** | 2025-12-24 |
| **æ›´æ–°æ—¥æœŸ** | 2026-01-07 |
| **ä½œè€…** | æŠ€æœ¯æ¶æ„å¸ˆ |
| **å®¡æ ¸äºº** | é¦–å¸­æ¶æ„å¸ˆ |
| **æ‰¹å‡†äºº** | æŠ€æœ¯æ€»ç›‘ |

## ğŸ“ æ›´æ–°è¯´æ˜

**v1.1.0 (2026-01-07)**:
- æ¶æ„åˆ†å±‚ä»DDD 7å±‚è°ƒæ•´ä¸ºä¸‰å±‚æ¶æ„ï¼ˆWebå±‚ã€Serviceå±‚ã€Mapperå±‚ï¼‰
- è®¤è¯æ¡†æ¶ä»Spring Securityè°ƒæ•´ä¸ºSa-Token
- æ•°æ®è®¿é—®ä»Spring Data JPAè°ƒæ•´ä¸ºMyBatis-Plus
- ä¸»é”®ç­–ç•¥ä»AUTO_INCREMENT/UUIDè°ƒæ•´ä¸ºé›ªèŠ±ç®—æ³•
- å»æ‰é¢†åŸŸå±‚ã€èšåˆæ ¹ã€å€¼å¯¹è±¡ã€é¢†åŸŸäº‹ä»¶ç­‰DDDæ¦‚å¿µ
- å»æ‰é™ç•Œä¸Šä¸‹æ–‡ã€é¢†åŸŸæœåŠ¡ç­‰DDDæ¦‚å¿µ
- æ›´æ–°æŠ€æœ¯æ ˆæ¶æ„å›¾ï¼Œåæ˜ å®é™…ä½¿ç”¨çš„æŠ€æœ¯æ ˆ

## ğŸ¯ æ¶æ„è®¾è®¡åŸåˆ™

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

#### 1. åˆ†å±‚æ¶æ„åŸåˆ™
- **å…³æ³¨ç‚¹åˆ†ç¦»**: æ¯å±‚åªå…³æ³¨è‡ªå·±çš„èŒè´£
- **ä¾èµ–æ–¹å‘**: ä¸Šå±‚ä¾èµ–ä¸‹å±‚ï¼Œä¸‹å±‚ä¸ä¾èµ–ä¸Šå±‚
- **æ¥å£éš”ç¦»**: é€šè¿‡æ¥å£å®šä¹‰å±‚é—´äº¤äº’
- **æ¾è€¦åˆ**: å±‚é—´é€šè¿‡æ¥å£å’ŒDTOè§£è€¦

#### 2. æ¨¡å—åŒ–è®¾è®¡åŸåˆ™
- **é«˜å†…èš**: æ¨¡å—å†…éƒ¨åŠŸèƒ½é«˜åº¦ç›¸å…³
- **ä½è€¦åˆ**: æ¨¡å—é—´ä¾èµ–æœ€å°åŒ–
- **å•ä¸€èŒè´£**: æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªä¸šåŠ¡é¢†åŸŸ
- **å¼€æ”¾å°é—­**: å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­

#### 3. ä¸‰å±‚æ¶æ„åŸåˆ™
- **Webå±‚**: è´Ÿè´£æ¥æ”¶HTTPè¯·æ±‚ã€å‚æ•°æ ¡éªŒã€è¿”å›å“åº”
- **Serviceå±‚**: è´Ÿè´£ä¸šåŠ¡é€»è¾‘å¤„ç†ã€äº‹åŠ¡ç®¡ç†ã€ä¸šåŠ¡è§„åˆ™æ ¡éªŒ
- **Mapperå±‚**: è´Ÿè´£æ•°æ®è®¿é—®ã€SQLæ‰§è¡Œã€ç»“æœæ˜ å°„

## ğŸ—ï¸ æ•´ä½“æŠ€æœ¯æ¶æ„

### æ¶æ„åˆ†å±‚æ¨¡å‹

```mermaid
graph TB
    subgraph "æ¥å…¥å±‚ (Access Layer)"
        A1[è´Ÿè½½å‡è¡¡å™¨] --> A2[Nginx/HAProxy]
        A3[APIç½‘å…³] --> A4[Spring Cloud Gateway]
        A5[é™æµç†”æ–­] --> A6[Sentinel]
    end

    subgraph "Webå±‚ (Web Layer)"
        B1[Web MVC] --> B2[Spring MVC]
        B3[WebFlux] --> B4[Spring WebFlux]
        B5[WebSocket] --> B6[Spring WebSocket]
        B7[GraphQL] --> B8[Spring GraphQL]
    end

    subgraph "Serviceå±‚ (Service Layer)"
        C1[ä¸šåŠ¡æœåŠ¡] --> C2[Business Services]
        C3[äº‹åŠ¡ç®¡ç†] --> C4[Transaction Management]
        C5[ä¸šåŠ¡è§„åˆ™] --> C6[Business Rules]
        C7[å·¥ä½œæµ] --> C8[Workflow Engine]
    end

    subgraph "Mapperå±‚ (Mapper Layer)"
        D1[æ•°æ®è®¿é—®] --> D2[MyBatis-Plus]
        D3[SQLæ‰§è¡Œ] --> D4[SQL Execution]
        D5[ç»“æœæ˜ å°„] --> D6[Result Mapping]
    end

    subgraph "åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)"
        E1[æ¶ˆæ¯ä¸­é—´ä»¶] --> E2[RabbitMQ/Kafka]
        E3[ç¼“å­˜æœåŠ¡] --> E4[Redis]
        E5[æœç´¢å¼•æ“] --> E6[Elasticsearch]
    end

    subgraph "æ•°æ®å±‚ (Data Layer)"
        F1[å…³ç³»æ•°æ®åº“] --> F2[MySQL Cluster]
        F3[æ–‡æ¡£æ•°æ®åº“] --> F4[MongoDB]
        F5[æ—¶åºæ•°æ®åº“] --> F6[InfluxDB]
        F7[å›¾æ•°æ®åº“] --> F8[Neo4j]
    end

    A1 --> B1
    A3 --> B1
    B1 --> C1
    B3 --> C1
    C1 --> D1
    C3 --> D1
    D1 --> F1
    E1 --> F1
    E3 --> F1
    E5 --> F1
```

### æŠ€æœ¯æ ˆæ¶æ„å›¾

```mermaid
graph LR
    subgraph "å‰ç«¯æŠ€æœ¯æ ˆ"
        A1[Vue.js 3.x] --> A2[Element Plus]
        A3[TypeScript] --> A4[Vite]
        A5[ECharts] --> A6[Axios]
    end
    
    subgraph "åç«¯æŠ€æœ¯æ ˆ"
        B1[Spring Boot 4.0.1] --> B2[Spring Framework 6.x]
        B3[Java 25] --> B4[Maven 3.9.12]
        B5[Lombok] --> B6[MapStruct]
    end
    
    subgraph "æ•°æ®æŠ€æœ¯æ ˆ"
        C1[MySQL 8.0] --> C2[MyBatis-Plus]
        C3[Redis 7.0] --> C4[Sa-Token Redis]
        C5[MongoDB 6.0] --> C6[MongoDB Driver]
        C7[Elasticsearch 8.0] --> C8[ES Rest Client]
    end
    
    subgraph "ä¸­é—´ä»¶æŠ€æœ¯æ ˆ"
        D1[RabbitMQ 3.12] --> D2[Spring AMQP]
        D3[Apache Kafka] --> D4[Spring Kafka]
        D5[Spring Integration] --> D6[RSocket]
    end
    
    subgraph "ç›‘æ§æŠ€æœ¯æ ˆ"
        E1[Spring Boot Actuator] --> E2[Micrometer]
        E3[Prometheus] --> E4[Grafana]
        E5[Zipkin] --> E6[OpenTelemetry]
    end
    
    subgraph "éƒ¨ç½²æŠ€æœ¯æ ˆ"
        F1[Docker] --> F2[Docker Compose]
        F3[Nginx] --> F4[Let's Encrypt]
        F5[GitHub Actions] --> F6[ArgoCD]
    end
```

## ğŸ”§ æ ¸å¿ƒæ¶æ„ç»„ä»¶

### 1. æ¥å…¥å±‚æ¶æ„

#### è´Ÿè½½å‡è¡¡è®¾è®¡
```yaml
# è´Ÿè½½å‡è¡¡é…ç½®
load_balancer:
  type: "nginx"
  algorithm: "round_robin"
  health_check:
    path: "/actuator/health"
    interval: "30s"
    timeout: "5s"
    retries: 3
  upstream:
    servers:
      - host: "app-server-1"
        port: 8080
        weight: 1
      - host: "app-server-2"
        port: 8080
        weight: 1
```

#### APIç½‘å…³è®¾è®¡
```java
@Configuration
public class GatewayConfig {
    
    @Bean
    public RouteLocator customRouteLocator(RouteLocatorBuilder builder) {
        return builder.routes()
            .route("user-service", r -> r.path("/api/users/**")
                .uri("lb://user-service"))
            .route("content-service", r -> r.path("/api/content/**")
                .uri("lb://content-service"))
            .route("workflow-service", r -> r.path("/api/workflow/**")
                .uri("lb://workflow-service"))
            .build();
    }
}
```

#### é™æµç†”æ–­è®¾è®¡
```java
@Configuration
public class SentinelConfig {
    
    @Bean
    public SentinelResourceAspect sentinelResourceAspect() {
        return new SentinelResourceAspect();
    }
    
    @PostConstruct
    public void initFlowRules() {
        List<FlowRule> rules = new ArrayList<>();
        FlowRule rule = new FlowRule();
        rule.setResource("getUserInfo");
        rule.setGrade(RuleConstant.FLOW_GRADE_QPS);
        rule.setCount(100);
        rules.add(rule);
        FlowRuleManager.loadRules(rules);
    }
}
```

### 2. åº”ç”¨å±‚æ¶æ„

#### MVCæ¶æ„è®¾è®¡
```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @GetMapping("/{id}")
    public ResponseEntity<UserDTO> getUser(@PathVariable Long id) {
        UserDTO user = userService.getUserById(id);
        return ResponseEntity.ok(user);
    }
    
    @PostMapping
    public ResponseEntity<UserDTO> createUser(@Valid @RequestBody CreateUserRequest request) {
        UserDTO user = userService.createUser(request);
        return ResponseEntity.status(HttpStatus.CREATED).body(user);
    }
}
```

#### WebFluxå“åº”å¼è®¾è®¡
```java
@RestController
@RequestMapping("/api/reactive")
public class ReactiveUserController {
    
    @Autowired
    private ReactiveUserService userService;
    
    @GetMapping("/users/{id}")
    public Mono<UserDTO> getUser(@PathVariable Long id) {
        return userService.getUserById(id);
    }
    
    @GetMapping("/users")
    public Flux<UserDTO> getAllUsers() {
        return userService.getAllUsers();
    }
}
```

#### WebSocketå®æ—¶é€šä¿¡
```java
@Configuration
@EnableWebSocket
public class WebSocketConfig implements WebSocketConfigurer {
    
    @Override
    public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
        registry.addHandler(new NotificationWebSocketHandler(), "/ws/notifications")
                .setAllowedOrigins("*");
    }
}

@Component
public class NotificationWebSocketHandler extends TextWebSocketHandler {
    
    @Override
    public void afterConnectionEstablished(WebSocketSession session) {
        // è¿æ¥å»ºç«‹åçš„å¤„ç†é€»è¾‘
    }
    
    @Override
    protected void handleTextMessage(WebSocketSession session, TextMessage message) {
        // æ¶ˆæ¯å¤„ç†é€»è¾‘
    }
}
```

### 3. Serviceå±‚æ¶æ„

#### ä¸šåŠ¡æœåŠ¡è®¾è®¡
```java
@Service
@Transactional
public class UserServiceImpl implements UserService {

    @Autowired
    private UserMapper userMapper;

    @Autowired
    private PasswordEncoder passwordEncoder;

    @Override
    public UserDTO createUser(CreateUserRequest request) {
        // 1. éªŒè¯ä¸šåŠ¡è§„åˆ™
        validateUserRequest(request);

        // 2. æ£€æŸ¥ç”¨æˆ·åå”¯ä¸€æ€§
        if (userMapper.existsByUsername(request.getUsername())) {
            throw new UserAlreadyExistsException("Username already exists");
        }

        // 3. æ£€æŸ¥é‚®ç®±å”¯ä¸€æ€§
        if (userMapper.existsByEmail(request.getEmail())) {
            throw new UserAlreadyExistsException("Email already exists");
        }

        // 4. å¯†ç åŠ å¯†
        String encodedPassword = passwordEncoder.encode(request.getPassword());

        // 5. åˆ›å»ºç”¨æˆ·å®ä½“
        User user = new User();
        user.setUsername(request.getUsername());
        user.setEmail(request.getEmail());
        user.setPassword(encodedPassword);
        user.setStatus(UserStatus.ACTIVE);
        user.setCreateTime(LocalDateTime.now());
        user.setUpdateTime(LocalDateTime.now());

        // 6. ä¿å­˜åˆ°æ•°æ®åº“
        userMapper.insert(user);

        // 7. è¿”å›DTO
        return UserMapper.toDTO(user);
    }

    @Override
    public UserDTO getUserById(Long id) {
        User user = userMapper.selectById(id);
        if (user == null) {
            throw new UserNotFoundException("User not found");
        }
        return UserMapper.toDTO(user);
    }

    @Override
    public void updateUser(Long id, UpdateUserRequest request) {
        User user = userMapper.selectById(id);
        if (user == null) {
            throw new UserNotFoundException("User not found");
        }

        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
        if (request.getEmail() != null) {
            user.setEmail(request.getEmail());
        }
        if (request.getPassword() != null) {
            user.setPassword(passwordEncoder.encode(request.getPassword()));
        }
        user.setUpdateTime(LocalDateTime.now());

        userMapper.updateById(user);
    }

    @Override
    public void deleteUser(Long id) {
        User user = userMapper.selectById(id);
        if (user == null) {
            throw new UserNotFoundException("User not found");
        }
        userMapper.deleteById(id);
    }
}
```

#### äº‹åŠ¡ç®¡ç†è®¾è®¡
```java
@Service
public class OrderServiceImpl implements OrderService {

    @Autowired
    private OrderMapper orderMapper;

    @Autowired
    private OrderItemMapper orderItemMapper;

    @Autowired
    private ProductMapper productMapper;

    @Override
    @Transactional(rollbackFor = Exception.class)
    public OrderDTO createOrder(CreateOrderRequest request) {
        // 1. åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setOrderNo(generateOrderNo());
        order.setUserId(request.getUserId());
        order.setStatus(OrderStatus.PENDING);
        order.setTotalAmount(request.getTotalAmount());
        order.setCreateTime(LocalDateTime.now());
        order.setUpdateTime(LocalDateTime.now());

        orderMapper.insert(order);

        // 2. åˆ›å»ºè®¢å•é¡¹
        for (CreateOrderItemRequest itemRequest : request.getItems()) {
            OrderItem item = new OrderItem();
            item.setOrderId(order.getId());
            item.setProductId(itemRequest.getProductId());
            item.setQuantity(itemRequest.getQuantity());
            item.setPrice(itemRequest.getPrice());
            item.setCreateTime(LocalDateTime.now());

            orderItemMapper.insert(item);

            // 3. æ‰£å‡åº“å­˜
            Product product = productMapper.selectById(itemRequest.getProductId());
            if (product.getStock() < itemRequest.getQuantity()) {
                throw new InsufficientStockException("Insufficient stock");
            }
            product.setStock(product.getStock() - itemRequest.getQuantity());
            product.setUpdateTime(LocalDateTime.now());
            productMapper.updateById(product);
        }

        return OrderMapper.toDTO(order);
    }
}
```

### 4. Mapperå±‚æ¶æ„

#### æ•°æ®è®¿é—®è®¾è®¡
```java
@Mapper
public interface UserMapper extends BaseMapper<User> {

    /**
     * æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·
     */
    @Select("SELECT * FROM users WHERE username = #{username} AND deleted = 0")
    User findByUsername(@Param("username") String username);

    /**
     * æ ¹æ®é‚®ç®±æŸ¥è¯¢ç”¨æˆ·
     */
    @Select("SELECT * FROM users WHERE email = #{email} AND deleted = 0")
    User findByEmail(@Param("email") String email);

    /**
     * æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å­˜åœ¨
     */
    @Select("SELECT COUNT(1) FROM users WHERE username = #{username} AND deleted = 0")
    boolean existsByUsername(@Param("username") String username);

    /**
     * æ£€æŸ¥é‚®ç®±æ˜¯å¦å­˜åœ¨
     */
    @Select("SELECT COUNT(1) FROM users WHERE email = #{email} AND deleted = 0")
    boolean existsByEmail(@Param("email") String email);

    /**
     * æ ¹æ®è§’è‰²æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
     */
    @Select("SELECT u.* FROM users u " +
            "JOIN user_roles ur ON u.id = ur.user_id " +
            "JOIN roles r ON ur.role_id = r.id " +
            "WHERE r.name = #{roleName} AND u.deleted = 0")
    List<User> findByRole(@Param("roleName") String roleName);

    /**
     * åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
     */
    IPage<User> selectUserPage(Page<User> page, @Param("username") String username, @Param("status") UserStatus status);
}
```

#### å®ä½“ç±»è®¾è®¡
```java
@Data
@TableName("users")
public class User {

    /**
     * ä¸»é”®IDï¼ˆé›ªèŠ±ç®—æ³•ï¼‰
     */
    @TableId(type = IdType.ASSIGN_ID)
    private Long id;

    /**
     * ç”¨æˆ·å
     */
    @TableField("username")
    private String username;

    /**
     * é‚®ç®±
     */
    @TableField("email")
    private String email;

    /**
     * å¯†ç ï¼ˆåŠ å¯†åï¼‰
     */
    @TableField("password")
    private String password;

    /**
     * ç”¨æˆ·çŠ¶æ€
     */
    @TableField("status")
    private UserStatus status;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    @TableField("create_time")
    private LocalDateTime createTime;

    /**
     * æ›´æ–°æ—¶é—´
     */
    @TableField("update_time")
    private LocalDateTime updateTime;

    /**
     * åˆ é™¤æ ‡è®°ï¼ˆ0ï¼šæœªåˆ é™¤ï¼Œ1ï¼šå·²åˆ é™¤ï¼‰
     */
    @TableField("deleted")
    @TableLogic
    private Integer deleted;
}
```

#### DTOæ˜ å°„è®¾è®¡
```java
@Mapper(componentModel = "spring")
public interface UserMapper {

    /**
     * å®ä½“è½¬DTO
     */
    @Mapping(target = "roles", ignore = true)
    UserDTO toDTO(User user);

    /**
     * DTOè½¬å®ä½“
     */
    @Mapping(target = "id", ignore = true)
    @Mapping(target = "createTime", ignore = true)
    @Mapping(target = "updateTime", ignore = true)
    @Mapping(target = "deleted", ignore = true)
    User toEntity(UserDTO userDTO);

    /**
     * å®ä½“åˆ—è¡¨è½¬DTOåˆ—è¡¨
     */
    List<UserDTO> toDTOList(List<User> users);
}
```

#### ç¼“å­˜è®¾è®¡
```java
@Service
@CacheConfig(cacheNames = "users")
public class UserCacheService {
    
    @Autowired
    private UserRepository userRepository;
    
    @Cacheable(key = "#id")
    public User getUserById(Long id) {
        return userRepository.findById(id).orElse(null);
    }
    
    @CachePut(key = "#user.id")
    public User updateUser(User user) {
        return userRepository.save(user);
    }
    
    @CacheEvict(key = "#id")
    public void deleteUser(Long id) {
        userRepository.deleteById(id);
    }
}
```

#### æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡
```java
@Component
public class MessageProducer {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    public void sendUserCreatedMessage(Long userId) {
        UserCreatedMessage message = new UserCreatedMessage(userId);
        rabbitTemplate.convertAndSend("user.exchange", "user.created", message);
    }
    
    public void sendNotificationMessage(NotificationMessage message) {
        rabbitTemplate.convertAndSend("notification.exchange", "notification.send", message);
    }
}

@Component
public class MessageConsumer {
    
    @RabbitListener(queues = "user.created.queue")
    public void handleUserCreated(UserCreatedMessage message) {
        // å¤„ç†ç”¨æˆ·åˆ›å»ºäº‹ä»¶
        log.info("User created: {}", message.getUserId());
    }
    
    @RabbitListener(queues = "notification.queue")
    public void handleNotification(NotificationMessage message) {
        // å¤„ç†é€šçŸ¥æ¶ˆæ¯
        log.info("Notification: {}", message.getContent());
    }
}
```

## ğŸ”’ å®‰å…¨æ¶æ„è®¾è®¡

### è®¤è¯æˆæƒæ¶æ„

```mermaid
graph TB
    subgraph "è®¤è¯å±‚"
        A1[ç”¨æˆ·è®¤è¯] --> A2[Sa-Token]
        A3[OAuth2] --> A4[Sa-Token OAuth2]
        A5[SSO] --> A6[Sa-Token SSO]
    end
    
    subgraph "æˆæƒå±‚"
        B1[RBAC] --> B2[è§’è‰²æƒé™]
        B3[ABAC] --> B4[å±æ€§æƒé™]
        B5[èµ„æºæƒé™] --> B6[APIæƒé™æ§åˆ¶]
    end
    
    subgraph "å®‰å…¨ç­–ç•¥å±‚"
        C1[å¯†ç ç­–ç•¥] --> C2[å¼ºå¯†ç è¦æ±‚]
        C3[ä¼šè¯ç­–ç•¥] --> C4[ä¼šè¯è¶…æ—¶]
        C5[è®¿é—®ç­–ç•¥] --> C6[IPé™åˆ¶]
    end
    
    A1 --> B1
    B1 --> C1
```

### å®‰å…¨é…ç½®å®ç°

```java
@Configuration
public class SaTokenConfig {
    
    @Bean
    public SaTokenDao saTokenDao() {
        // ä½¿ç”¨ Redis å­˜å‚¨ Token
        return new SaTokenDaoRedisImpl();
    }
    
    @Bean
    public StpInterface stpInterface() {
        return new StpInterfaceImpl();
    }
}

@Component
public class StpInterfaceImpl implements StpInterface {
    
    @Autowired
    private UserMapper userMapper;
    
    @Override
    public List<String> getPermissionList(Object loginId, String loginType) {
        // è¿”å›æ­¤ loginId æ‹¥æœ‰çš„æƒé™åˆ—è¡¨
        User user = userMapper.selectById((Long) loginId);
        return user.getPermissions();
    }
    
    @Override
    public List<String> getRoleList(Object loginId, String loginType) {
        // è¿”å›æ­¤ loginId æ‹¥æœ‰çš„è§’è‰²ç åˆ—è¡¨
        User user = userMapper.selectById((Long) loginId);
        return user.getRoles();
    }
}
```

## ğŸ“Š ç›‘æ§æ¶æ„è®¾è®¡

### ç›‘æ§ä½“ç³»æ¶æ„

```mermaid
graph TB
    subgraph "åº”ç”¨ç›‘æ§"
        A1[Spring Boot Actuator] --> A2[å¥åº·æ£€æŸ¥]
        A1 --> A3[æŒ‡æ ‡æ”¶é›†]
        A1 --> A4[ä¿¡æ¯ç«¯ç‚¹]
    end
    
    subgraph "æŒ‡æ ‡ç›‘æ§"
        B1[Micrometer] --> B2[Prometheus]
        B2 --> B3[Grafana]
        B3 --> B4[ç›‘æ§é¢æ¿]
    end
    
    subgraph "é“¾è·¯è¿½è¸ª"
        C1[OpenTelemetry] --> C2[Zipkin]
        C2 --> C3[é“¾è·¯åˆ†æ]
    end
    
    subgraph "æ—¥å¿—ç›‘æ§"
        D1[Logback] --> D2[ELK Stack]
        D2 --> D3[æ—¥å¿—åˆ†æ]
    end
    
    A1 --> B1
    A1 --> C1
    A1 --> D1
```

### ç›‘æ§é…ç½®å®ç°

```java
@Configuration
public class MonitoringConfig {
    
    @Bean
    public MeterRegistryCustomizer<MeterRegistry> metricsCommonTags() {
        return registry -> registry.config().commonTags(
            "application", "spring4demo",
            "region", System.getenv().getOrDefault("REGION", "local")
        );
    }
    
    @Bean
    public TimedAspect timedAspect(MeterRegistry registry) {
        return new TimedAspect(registry);
    }
    
    @Bean
    public CountedAspect countedAspect(MeterRegistry registry) {
        return new CountedAspect(registry);
    }
}
```

## ğŸš€ æ€§èƒ½æ¶æ„è®¾è®¡

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 1. ç¼“å­˜æ¶æ„
```java
@Configuration
@EnableCaching
public class CacheConfig {
    
    @Bean
    public CacheManager cacheManager() {
        RedisCacheManager.Builder builder = RedisCacheManager
            .RedisCacheManagerBuilder
            .fromConnectionFactory(redisConnectionFactory())
            .cacheDefaults(cacheConfiguration());
        
        return builder.build();
    }
    
    private RedisCacheConfiguration cacheConfiguration() {
        return RedisCacheConfiguration.defaultCacheConfig()
            .entryTtl(Duration.ofMinutes(30))
            .serializeKeysWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new StringRedisSerializer()))
            .serializeValuesWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new GenericJackson2JsonRedisSerializer()));
    }
}
```

#### 2. è¿æ¥æ± é…ç½®
```yaml
spring:
  datasource:
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      idle-timeout: 300000
      max-lifetime: 1200000
      connection-timeout: 20000
      leak-detection-threshold: 60000
      
  redis:
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0
        max-wait: -1ms
```

#### 3. å¼‚æ­¥å¤„ç†
```java
@Configuration
@EnableAsync
public class AsyncConfig {
    
    @Bean(name = "taskExecutor")
    public Executor taskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);
        executor.setMaxPoolSize(10);
        executor.setQueueCapacity(25);
        executor.setThreadNamePrefix("Async-");
        executor.initialize();
        return executor;
    }
}

@Service
public class AsyncService {
    
    @Async("taskExecutor")
    public CompletableFuture<String> asyncMethod() {
        // å¼‚æ­¥å¤„ç†é€»è¾‘
        return CompletableFuture.completedFuture("Result");
    }
}
```

## ğŸ”„ æ¶æ„æ¼”è¿›è®¾è®¡

### å¾®æœåŠ¡æ¼”è¿›è·¯å¾„

```mermaid
graph LR
    subgraph "é˜¶æ®µ1: å•ä½“æ¶æ„"
        A1[Spring Boot App] --> A2[MySQL]
        A1 --> A3[Redis]
        A1 --> A4[RabbitMQ]
    end
    
    subgraph "é˜¶æ®µ2: æ¨¡å—åŒ–"
        B1[User Module] --> B2[Content Module]
        B2 --> B3[Workflow Module]
        B3 --> B4[Shared Library]
    end
    
    subgraph "é˜¶æ®µ3: å¾®æœåŠ¡"
        C1[User Service] --> C2[Content Service]
        C2 --> C3[Workflow Service]
        C3 --> C4[API Gateway]
    end
    
    subgraph "é˜¶æ®µ4: äº‘åŸç”Ÿ"
        D1[Service Mesh] --> D2[Serverless]
        D2 --> D3[Event Sourcing]
        D3 --> D4[CQRS]
    end
    
    A1 --> B1
    B1 --> C1
    C1 --> D1
```

### æ¶æ„å†³ç­–è®°å½• (ADR)

#### ADR-001: é€‰æ‹©Spring Bootä½œä¸ºåº”ç”¨æ¡†æ¶
**çŠ¶æ€**: å·²æ¥å—  
**å†³ç­–**: ä½¿ç”¨Spring Boot 4.0.1ä½œä¸ºä¸»è¦åº”ç”¨æ¡†æ¶  
**ç†ç”±**: 
- æˆç†Ÿçš„ç”Ÿæ€ç³»ç»Ÿå’Œä¸°å¯Œçš„åŠŸèƒ½
- ç®€åŒ–é…ç½®å’Œå¿«é€Ÿå¼€å‘èƒ½åŠ›
- ä¸ç°æœ‰æŠ€æœ¯æ ˆå…¼å®¹æ€§å¥½
- ç¤¾åŒºæ´»è·ƒï¼Œæ–‡æ¡£å®Œå–„

**åæœ**:
- æ­£é¢: å¼€å‘æ•ˆç‡é«˜ï¼Œå­¦ä¹ æˆæœ¬ä½
- è´Ÿé¢: æ¡†æ¶è¾ƒé‡ï¼Œå¯åŠ¨æ—¶é—´è¾ƒé•¿
- é£é™©: ç‰ˆæœ¬å‡çº§å¯èƒ½å¸¦æ¥å…¼å®¹æ€§é—®é¢˜

#### ADR-002: é€‰æ‹©MySQLä½œä¸ºä¸»æ•°æ®åº“
**çŠ¶æ€**: å·²æ¥å—  
**å†³ç­–**: ä½¿ç”¨MySQL 8.0ä½œä¸ºä¸»æ•°æ®åº“  
**ç†ç”±**:
- å…³ç³»å‹æ•°æ®æ¨¡å‹é€‚åˆä¸šåŠ¡éœ€æ±‚
- äº‹åŠ¡æ”¯æŒå®Œå–„ï¼Œæ•°æ®ä¸€è‡´æ€§å¼º
- è¿ç»´å·¥å…·ä¸°å¯Œï¼Œç¤¾åŒºæ”¯æŒå¥½
- ä¸MyBatis-Plusé›†æˆè‰¯å¥½ï¼ŒSQLæ§åˆ¶çµæ´»

**åæœ**:
- æ­£é¢: æ•°æ®ä¸€è‡´æ€§å¼ºï¼Œè¿ç»´æˆç†Ÿï¼ŒSQLå¯æ§æ€§å¼º
- è´Ÿé¢: æ‰©å±•æ€§ç›¸å¯¹æœ‰é™
- é£é™©: å¤§æ•°æ®é‡åœºæ™¯æ€§èƒ½ç“¶é¢ˆ

---

*æœ¬æ–‡æ¡£ä¸ºæŠ€æœ¯æ¶æ„çš„æ ¸å¿ƒæŒ‡å¯¼æ–‡æ¡£ï¼Œæ‰€æœ‰æŠ€æœ¯å®ç°éƒ½åº”éµå¾ªæœ¬æ–‡æ¡£çš„æ¶æ„è®¾è®¡åŸåˆ™ã€‚*