# Junmo Platform åŠŸèƒ½åˆ†è§£è®¾è®¡

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡æ¡£åç§°** | Junmo Platform åŠŸèƒ½åˆ†è§£è®¾è®¡ |
| **ç‰ˆæœ¬å·** | v1.0.0 |
| **åˆ›å»ºæ—¥æœŸ** | 2025-12-24 |
| **ä½œè€…** | ç³»ç»Ÿæ¶æ„å¸ˆ |
| **å®¡æ ¸äºº** | æŠ€æœ¯æ¶æ„å¸ˆ |
| **æ‰¹å‡†äºº** | é¡¹ç›®ç»ç† |

## ğŸ¯ åŠŸèƒ½æ¶æ„æ¦‚è¿°

Junmo Platformä¼ä¸šçº§æ™ºèƒ½ç®¡ç†å¹³å°çš„åŠŸèƒ½æ¶æ„åŸºäºæ¨¡å—åŒ–è®¾è®¡ç†å¿µï¼Œé‡‡ç”¨åˆ†å±‚è§£è€¦çš„æ–¹å¼ç»„ç»‡åŠŸèƒ½æ¨¡å—ã€‚æ¯ä¸ªåŠŸèƒ½æ¨¡å—éƒ½æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œå’Œæ¥å£å®šä¹‰ï¼Œæ”¯æŒç‹¬ç«‹å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚

## ğŸ—ï¸ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—åˆ†è§£

### 1. ç”¨æˆ·æƒé™ç®¡ç†æ¨¡å— (User & Permission Module)

#### 1.1 ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½

**åŠŸèƒ½æè¿°**: æä¾›å¤šç§æ¸ é“çš„ç”¨æˆ·æ³¨å†Œèƒ½åŠ›ï¼Œæ”¯æŒé‚®ç®±æ³¨å†Œã€æ‰‹æœºå·æ³¨å†Œå’Œç¬¬ä¸‰æ–¹OAuthç™»å½•

**æŠ€æœ¯å®ç°**:

```java
@RestController
@RequestMapping("/api/v1/auth")
@Validated
@Slf4j
public class AuthController {
    
    @Autowired
    private UserRegistrationService userRegistrationService;
    
    @Autowired
    private CaptchaService captchaService;
    
    /**
     * é‚®ç®±æ³¨å†Œ
     */
    @PostMapping("/register/email")
    public ResponseEntity<ApiResponse<RegisterResult>> registerByEmail(
            @Valid @RequestBody EmailRegisterRequest request) {
        
        log.info("Email registration request for: {}", request.getEmail());
        
        // 1. éªŒè¯å›¾å½¢éªŒè¯ç 
        captchaService.validateCaptcha(request.getCaptchaKey(), request.getCaptchaCode());
        
        // 2. å‘é€é‚®ç®±éªŒè¯ç 
        String verificationCode = userRegistrationService.sendEmailVerification(request.getEmail());
        
        // 3. ç¼“å­˜éªŒè¯ç 
        userRegistrationService.cacheVerificationCode(request.getEmail(), verificationCode);
        
        return ResponseEntity.ok(ApiResponse.success(
            RegisterResult.builder()
                .step("EMAIL_VERIFICATION_SENT")
                .message("éªŒè¯ç å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±")
                .build()
        ));
    }
    
    /**
     * éªŒè¯é‚®ç®±å¹¶å®Œæˆæ³¨å†Œ
     */
    @PostMapping("/register/email/verify")
    public ResponseEntity<ApiResponse<UserDTO>> verifyEmailAndRegister(
            @Valid @RequestBody EmailVerifyRequest request) {
        
        log.info("Email verification for: {}", request.getEmail());
        
        // 1. éªŒè¯é‚®ç®±éªŒè¯ç 
        userRegistrationService.validateEmailCode(request.getEmail(), request.getVerificationCode());
        
        // 2. åˆ›å»ºç”¨æˆ·
        CreateUserCommand command = CreateUserCommand.builder()
            .username(request.getUsername())
            .email(request.getEmail())
            .password(request.getPassword())
            .firstName(request.getFirstName())
            .lastName(request.getLastName())
            .registrationType(RegistrationType.EMAIL)
            .build();
        
        User user = userRegistrationService.registerUser(command);
        
        return ResponseEntity.status(HttpStatus.CREATED)
            .body(ApiResponse.success(UserMapper.toDTO(user)));
    }
    
    /**
     * æ‰‹æœºå·æ³¨å†Œ
     */
    @PostMapping("/register/phone")
    public ResponseEntity<ApiResponse<RegisterResult>> registerByPhone(
            @Valid @RequestBody PhoneRegisterRequest request) {
        
        log.info("Phone registration request for: {}", request.getPhoneNumber());
        
        // 1. å‘é€çŸ­ä¿¡éªŒè¯ç 
        String smsCode = userRegistrationService.sendSmsVerification(request.getPhoneNumber());
        
        // 2. ç¼“å­˜éªŒè¯ç 
        userRegistrationService.cacheSmsCode(request.getPhoneNumber(), smsCode);
        
        return ResponseEntity.ok(ApiResponse.success(
            RegisterResult.builder()
                .step("SMS_VERIFICATION_SENT")
                .message("éªŒè¯ç å·²å‘é€åˆ°æ‚¨çš„æ‰‹æœº")
                .build()
        ));
    }
    
    /**
     * ç¬¬ä¸‰æ–¹OAuthç™»å½•
     */
    @PostMapping("/oauth/{provider}")
    public ResponseEntity<ApiResponse<OAuthResult>> oauthLogin(
            @PathVariable String provider,
            @RequestBody OAuthRequest request) {
        
        log.info("OAuth login request for provider: {}", provider);
        
        // 1. éªŒè¯OAuth token
        OAuthUserInfo userInfo = oauthService.validateOAuthToken(provider, request.getAccessToken());
        
        // 2. æŸ¥æ‰¾æˆ–åˆ›å»ºç”¨æˆ·
        User user = userRegistrationService.findOrCreateOAuthUser(provider, userInfo);
        
        // 3. ç”ŸæˆJWT token
        String jwtToken = jwtTokenService.generateToken(user);
        
        return ResponseEntity.ok(ApiResponse.success(
            OAuthResult.builder()
                .user(UserMapper.toDTO(user))
                .token(jwtToken)
                .isNewUser(user.getCreatedAt().isAfter(LocalDateTime.now().minusMinutes(5)))
                .build()
        ));
    }
}
```

**æœåŠ¡å±‚å®ç°**:

```java
@Service
@Transactional
public class UserRegistrationService {
    
    @Autowired
    private UserRepository userRepository;
    
    @Autowired
    private RoleRepository roleRepository;
    
    @Autowired
    private PasswordEncoder passwordEncoder;
    
    @Autowired
    private EmailService emailService;
    
    @Autowired
    private SmsService smsService;
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    /**
     * å‘é€é‚®ç®±éªŒè¯ç 
     */
    public String sendEmailVerification(String email) {
        // 1. ç”Ÿæˆ6ä½æ•°å­—éªŒè¯ç 
        String verificationCode = generateVerificationCode();
        
        // 2. å‘é€é‚®ä»¶
        EmailRequest emailRequest = EmailRequest.builder()
            .to(email)
            .subject("Junmo Platform - é‚®ç®±éªŒè¯ç ")
            .template("email-verification")
            .variable("verificationCode", verificationCode)
            .variable("expirationMinutes", 10)
            .build();
        
        emailService.send(emailRequest);
        
        return verificationCode;
    }
    
    /**
     * æ³¨å†Œç”¨æˆ·
     */
    public User registerUser(CreateUserCommand command) {
        // 1. éªŒè¯ç”¨æˆ·åå”¯ä¸€æ€§
        if (userRepository.existsByUsername(command.getUsername())) {
            throw new UserAlreadyExistsException("ç”¨æˆ·åå·²å­˜åœ¨: " + command.getUsername());
        }
        
        // 2. éªŒè¯é‚®ç®±å”¯ä¸€æ€§
        if (userRepository.existsByEmail(command.getEmail())) {
            throw new UserAlreadyExistsException("é‚®ç®±å·²å­˜åœ¨: " + command.getEmail());
        }
        
        // 3. å¯†ç åŠ å¯†
        String encodedPassword = passwordEncoder.encode(command.getPassword());
        
        // 4. åˆ›å»ºç”¨æˆ·å®ä½“
        User user = User.create(command.getUsername(), command.getEmail(), encodedPassword);
        user.setFirstName(command.getFirstName());
        user.setLastName(command.getLastName());
        user.setRegistrationType(command.getRegistrationType());
        
        // 5. åˆ†é…é»˜è®¤è§’è‰²
        assignDefaultRole(user);
        
        // 6. ä¿å­˜ç”¨æˆ·
        User savedUser = userRepository.save(user);
        
        // 7. å‘é€æ¬¢è¿é‚®ä»¶
        sendWelcomeEmail(savedUser);
        
        // 8. å‘å¸ƒäº‹ä»¶
        DomainEventPublisher.publish(new UserRegisteredEvent(savedUser.getId()));
        
        return savedUser;
    }
    
    private String generateVerificationCode() {
        return String.format("%06d", new Random().nextInt(1000000));
    }
    
    private void assignDefaultRole(User user) {
        Role defaultRole = roleRepository.findByName("USER")
            .orElseThrow(() -> new RoleNotFoundException("é»˜è®¤è§’è‰²ä¸å­˜åœ¨"));
        
        user.assignRole(defaultRole);
    }
    
    private void sendWelcomeEmail(User user) {
        EmailRequest emailRequest = EmailRequest.builder()
            .to(user.getEmail())
            .subject("æ¬¢è¿åŠ å…¥Junmo Platform")
            .template("welcome-email")
            .variable("userName", user.getUsername())
            .build();
        
        emailService.send(emailRequest);
    }
}
```

#### 1.2 èº«ä»½è®¤è¯åŠŸèƒ½

**åŠŸèƒ½æè¿°**: æä¾›å®‰å…¨çš„èº«ä»½è®¤è¯æœºåˆ¶ï¼Œæ”¯æŒå¤šç§è®¤è¯æ–¹å¼å’Œä¼šè¯ç®¡ç†

**æŠ€æœ¯å®ç°**:

```java
@Service
public class AuthenticationService {
    
    @Autowired
    private AuthenticationManager authenticationManager;
    
    @Autowired
    private JwtTokenService jwtTokenService;
    
    @Autowired
    private UserSessionService userSessionService;
    
    @Autowired
    private MfaService mfaService;
    
    /**
     * ç”¨æˆ·ç™»å½•
     */
    public LoginResult login(LoginCommand command) {
        // 1. èº«ä»½è®¤è¯
        Authentication authentication = authenticationManager.authenticate(
            new UsernamePasswordAuthenticationToken(
                command.getUsername(),
                command.getPassword()
            )
        );
        
        // 2. è·å–ç”¨æˆ·ä¿¡æ¯
        User user = (User) authentication.getPrincipal();
        
        // 3. æ£€æŸ¥MFAè¦æ±‚
        if (user.isMfaEnabled()) {
            return handleMfaLogin(user, command);
        }
        
        // 4. ç”ŸæˆJWT token
        String accessToken = jwtTokenService.generateAccessToken(user);
        String refreshToken = jwtTokenService.generateRefreshToken(user);
        
        // 5. åˆ›å»ºç”¨æˆ·ä¼šè¯
        UserSession session = userSessionService.createSession(
            user.getId(),
            command.getIpAddress(),
            command.getUserAgent(),
            refreshToken
        );
        
        // 6. æ›´æ–°ç™»å½•ä¿¡æ¯
        user.updateLoginInfo(command.getIpAddress());
        userRepository.save(user);
        
        return LoginResult.builder()
            .accessToken(accessToken)
            .refreshToken(refreshToken)
            .sessionId(session.getId())
            .user(UserMapper.toDTO(user))
            .expiresIn(jwtTokenService.getAccessTokenExpiration())
            .build();
    }
    
    /**
     * å¤šå› å­è®¤è¯ç™»å½•
     */
    private LoginResult handleMfaLogin(User user, LoginCommand command) {
        // 1. ç”ŸæˆMFAæŒ‘æˆ˜
        String challengeId = mfaService.generateChallenge(user.getId());
        
        // 2. å‘é€MFAéªŒè¯ç 
        mfaService.sendMfaCode(user.getId(), user.getMfaMethod());
        
        return LoginResult.builder()
            .step("MFA_REQUIRED")
            .challengeId(challengeId)
            .mfaMethod(user.getMfaMethod())
            .message("è¯·è¾“å…¥å¤šå› å­éªŒè¯ç ")
            .build();
    }
    
    /**
     * éªŒè¯MFAå¹¶å®Œæˆç™»å½•
     */
    public LoginResult verifyMfaAndLogin(MfaVerificationCommand command) {
        // 1. éªŒè¯MFAæŒ‘æˆ˜
        MfaChallenge challenge = mfaService.getChallenge(command.getChallengeId());
        if (challenge == null || challenge.isExpired()) {
            throw new InvalidMfaChallengeException("MFAæŒ‘æˆ˜æ— æ•ˆæˆ–å·²è¿‡æœŸ");
        }
        
        // 2. éªŒè¯MFAä»£ç 
        boolean mfaValid = mfaService.verifyCode(
            challenge.getUserId(),
            command.getCode(),
            challenge.getMethod()
        );
        
        if (!mfaValid) {
            throw new InvalidMfaCodeException("MFAéªŒè¯ç é”™è¯¯");
        }
        
        // 3. è·å–ç”¨æˆ·å¹¶ç”Ÿæˆtoken
        User user = userRepository.findById(challenge.getUserId())
            .orElseThrow(() -> new UserNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨"));
        
        String accessToken = jwtTokenService.generateAccessToken(user);
        String refreshToken = jwtTokenService.generateRefreshToken(user);
        
        // 4. æ¸…é™¤MFAæŒ‘æˆ˜
        mfaService.clearChallenge(command.getChallengeId());
        
        return LoginResult.builder()
            .accessToken(accessToken)
            .refreshToken(refreshToken)
            .user(UserMapper.toDTO(user))
            .expiresIn(jwtTokenService.getAccessTokenExpiration())
            .build();
    }
}
```

#### 1.3 æƒé™ç®¡ç†åŠŸèƒ½

**åŠŸèƒ½æè¿°**: åŸºäºRBACæ¨¡å‹çš„ç»†ç²’åº¦æƒé™æ§åˆ¶ï¼Œæ”¯æŒåŠ¨æ€æƒé™åˆ†é…å’Œæƒé™ç»§æ‰¿

**æŠ€æœ¯å®ç°**:

```java
@Service
public class PermissionService {
    
    @Autowired
    private UserRepository userRepository;
    
    @Autowired
    private RoleRepository roleRepository;
    
    @Autowired
    private PermissionRepository permissionRepository;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    /**
     * æ£€æŸ¥ç”¨æˆ·æƒé™
     */
    public boolean hasPermission(Long userId, String resource, String action) {
        // 1. ä»ç¼“å­˜è·å–ç”¨æˆ·æƒé™
        Set<String> permissions = getUserPermissions(userId);
        
        // 2. æ„å»ºæ‰€éœ€æƒé™æ ¼å¼
        String requiredPermission = String.format("%s:%s", resource, action);
        
        // 3. æ£€æŸ¥æƒé™
        return permissions.contains(requiredPermission) ||
               permissions.contains(String.format("%s:*", resource)) ||
               permissions.contains("*:*");
    }
    
    /**
     * è·å–ç”¨æˆ·æƒé™åˆ—è¡¨
     */
    @Cacheable(value = "user_permissions", key = "#userId")
    public Set<String> getUserPermissions(Long userId) {
        User user = userRepository.findById(userId)
            .orElseThrow(() -> new UserNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨"));
        
        return user.getPermissions();
    }
    
    /**
     * åˆ†é…è§’è‰²æƒé™
     */
    @Transactional
    public void assignRolePermission(Long roleId, Long permissionId) {
        Role role = roleRepository.findById(roleId)
            .orElseThrow(() -> new RoleNotFoundException("è§’è‰²ä¸å­˜åœ¨"));
        
        Permission permission = permissionRepository.findById(permissionId)
            .orElseThrow(() -> new PermissionNotFoundException("æƒé™ä¸å­˜åœ¨"));
        
        // 1. æ£€æŸ¥æƒé™æ˜¯å¦å·²å­˜åœ¨
        if (role.hasPermission(permission.getName())) {
            throw new PermissionAlreadyAssignedException("æƒé™å·²åˆ†é…ç»™è¯¥è§’è‰²");
        }
        
        // 2. åˆ†é…æƒé™
        role.addPermission(permission);
        roleRepository.save(role);
        
        // 3. æ¸…é™¤ç›¸å…³ç”¨æˆ·æƒé™ç¼“å­˜
        clearUserPermissionCache(role);
        
        // 4. å‘å¸ƒäº‹ä»¶
        DomainEventPublisher.publish(new RolePermissionAssignedEvent(roleId, permissionId));
    }
    
    /**
     * åŠ¨æ€æƒé™æ£€æŸ¥æ³¨è§£å¤„ç†å™¨
     */
    @Component
    public class PermissionCheckAspect {
        
        @Autowired
        private PermissionService permissionService;
        
        @Around("@annotation(requirePermission)")
        public Object checkPermission(ProceedingJoinPoint joinPoint, RequirePermission requirePermission) throws Throwable {
            // 1. è·å–å½“å‰ç”¨æˆ·
            Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
            if (authentication == null || !authentication.isAuthenticated()) {
                throw new AuthenticationException("ç”¨æˆ·æœªè®¤è¯");
            }
            
            User user = (User) authentication.getPrincipal();
            
            // 2. æ£€æŸ¥æƒé™
            boolean hasPermission = permissionService.hasPermission(
                user.getId(),
                requirePermission.resource(),
                requirePermission.action()
            );
            
            if (!hasPermission) {
                throw new AccessDeniedException(
                    String.format("ç”¨æˆ·æ²¡æœ‰æƒé™æ‰§è¡Œæ“ä½œ: %s:%s", 
                        requirePermission.resource(), requirePermission.action())
                );
            }
            
            // 3. æ‰§è¡Œç›®æ ‡æ–¹æ³•
            return joinPoint.proceed();
        }
    }
}
```

### 2. å†…å®¹ç®¡ç†æ¨¡å— (Content Management Module)

#### 2.1 æ–‡æ¡£ç®¡ç†åŠŸèƒ½

**åŠŸèƒ½æè¿°**: æä¾›å®Œæ•´çš„æ–‡æ¡£ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œæ”¯æŒå¯Œæ–‡æœ¬ç¼–è¾‘ã€ç‰ˆæœ¬æ§åˆ¶å’ŒååŒç¼–è¾‘

**æŠ€æœ¯å®ç°**:

```java
@Service
@Transactional
public class DocumentManagementService {
    
    @Autowired
    private DocumentRepository documentRepository;
    
    @Autowired
    private DocumentVersionService documentVersionService;
    
    @Autowired
    private DocumentSearchService documentSearchService;
    
    @Autowired
    private WorkflowService workflowService;
    
    /**
     * åˆ›å»ºæ–‡æ¡£
     */
    public Document createDocument(CreateDocumentCommand command) {
        // 1. éªŒè¯æƒé™
        permissionService.checkPermission(command.getAuthorId(), "document", "create");
        
        // 2. åˆ›å»ºæ–‡æ¡£å®ä½“
        Document document = Document.create(
            command.getTitle(),
            command.getContent(),
            command.getAuthor(),
            command.getCategory()
        );
        
        // 3. è®¾ç½®æ ‡ç­¾
        if (command.getTagIds() != null && !command.getTagIds().isEmpty()) {
            List<Tag> tags = tagRepository.findAllById(command.getTagIds());
            document.setTags(new HashSet<>(tags));
        }
        
        // 4. è®¾ç½®è®¿é—®æƒé™
        document.setAccessLevel(command.getAccessLevel());
        document.setAllowedUsers(command.getAllowedUserIds());
        document.setAllowedRoles(command.getAllowedRoleIds());
        
        // 5. ä¿å­˜æ–‡æ¡£
        Document savedDocument = documentRepository.save(document);
        
        // 6. åˆ›å»ºåˆå§‹ç‰ˆæœ¬
        documentVersionService.createVersion(savedDocument, "åˆå§‹ç‰ˆæœ¬");
        
        // 7. æ›´æ–°æœç´¢ç´¢å¼•
        documentSearchService.indexDocument(savedDocument);
        
        // 8. å¯åŠ¨å®¡æ ¸æµç¨‹ï¼ˆå¦‚æœéœ€è¦ï¼‰
        if (command.requiresReview()) {
            workflowService.startDocumentReviewProcess(savedDocument.getId());
        }
        
        // 9. å‘å¸ƒäº‹ä»¶
        DomainEventPublisher.publish(new DocumentCreatedEvent(savedDocument.getId()));
        
        return savedDocument;
    }
    
    /**
     * æ›´æ–°æ–‡æ¡£
     */
    public Document updateDocument(UpdateDocumentCommand command) {
        // 1. è·å–æ–‡æ¡£
        Document document = documentRepository.findById(command.getDocumentId())
            .orElseThrow(() -> new DocumentNotFoundException("æ–‡æ¡£ä¸å­˜åœ¨"));
        
        // 2. æ£€æŸ¥æƒé™
        permissionService.checkDocumentPermission(
            command.getUserId(), 
            document, 
            "edit"
        );
        
        // 3. æ£€æŸ¥æ–‡æ¡£çŠ¶æ€
        if (document.isLocked()) {
            throw new DocumentLockedException("æ–‡æ¡£å·²è¢«é”å®šï¼Œæ— æ³•ç¼–è¾‘");
        }
        
        // 4. åˆ›å»ºç‰ˆæœ¬å¤‡ä»½
        documentVersionService.createVersion(document, command.getChangeDescription());
        
        // 5. æ›´æ–°æ–‡æ¡£å†…å®¹
        document.updateContent(command.getContent(), command.getUpdatedBy());
        if (command.getTitle() != null) {
            document.setTitle(command.getTitle());
        }
        
        // 6. æ›´æ–°æ ‡ç­¾
        if (command.getTagIds() != null) {
            List<Tag> tags = tagRepository.findAllById(command.getTagIds());
            document.setTags(new HashSet<>(tags));
        }
        
        // 7. ä¿å­˜æ–‡æ¡£
        Document updatedDocument = documentRepository.save(document);
        
        // 8. æ›´æ–°æœç´¢ç´¢å¼•
        documentSearchService.indexDocument(updatedDocument);
        
        // 9. å‘å¸ƒäº‹ä»¶
        DomainEventPublisher.publish(new DocumentUpdatedEvent(updatedDocument.getId()));
        
        return updatedDocument;
    }
    
    /**
     * ååŒç¼–è¾‘
     */
    @EventListener
    public void handleDocumentEditOperation(DocumentEditOperationEvent event) {
        // 1. è·å–æ–‡æ¡£
        Document document = documentRepository.findById(event.getDocumentId())
            .orElseThrow(() -> new DocumentNotFoundException("æ–‡æ¡£ä¸å­˜åœ¨"));
        
        // 2. åº”ç”¨ç¼–è¾‘æ“ä½œ
        DocumentEditResult result = document.applyEditOperation(event.getOperation());
        
        // 3. ä¿å­˜æ–‡æ¡£
        documentRepository.save(document);
        
        // 4. å¹¿æ’­ç¼–è¾‘ç»“æœç»™å…¶ä»–åä½œè€…
        webSocketService.broadcastToDocumentEditors(
            event.getDocumentId(),
            DocumentEditMessage.builder()
                .operation(event.getOperation())
                .result(result)
                .editedBy(event.getUserId())
                .timestamp(LocalDateTime.now())
                .build()
        );
        
        // 5. å®šæœŸåˆ›å»ºç‰ˆæœ¬ï¼ˆæ¯10åˆ†é’Ÿæˆ–æ¯50æ¬¡æ“ä½œï¼‰
        if (shouldCreateVersion(document)) {
            documentVersionService.createVersion(document, "è‡ªåŠ¨ä¿å­˜ç‰ˆæœ¬");
        }
    }
}
```

#### 2.2 å¯Œæ–‡æœ¬ç¼–è¾‘å™¨é›†æˆ

**å‰ç«¯é›†æˆ**:

```javascript
// å¯Œæ–‡æœ¬ç¼–è¾‘å™¨é…ç½®
class RichTextEditor {
    constructor(container, options = {}) {
        this.container = container;
        this.options = {
            height: 500,
            language: 'zh-CN',
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript']],
                ['para', ['ul', 'ol', 'paragraph', 'height']],
                ['insert', ['picture', 'link', 'video', 'table', 'hr']],
                ['view', ['fullscreen', 'codeview', 'help']]
            ],
            callbacks: {
                onInit: () => this.onInit(),
                onChange: () => this.onChange(),
                onImageUpload: (files) => this.onImageUpload(files),
                onPaste: (e) => this.onPaste(e)
            },
            ...options
        };
        
        this.init();
    }
    
    init() {
        this.editor = $(this.container).summernote(this.options);
        this.setupCollaboration();
        this.setupAutoSave();
    }
    
    setupCollaboration() {
        // WebSocketè¿æ¥ç”¨äºååŒç¼–è¾‘
        this.websocket = new WebSocket(`ws://localhost:8080/ws/document/${this.documentId}`);
        
        this.websocket.onmessage = (event) => {
            const message = JSON.parse(event.data);
            if (message.type === 'EDIT_OPERATION') {
                this.applyRemoteOperation(message.operation);
            }
        };
        
        // ç›‘å¬æœ¬åœ°ç¼–è¾‘æ“ä½œ
        this.editor.on('summernote.change', () => {
            const operation = this.createEditOperation();
            this.websocket.send(JSON.stringify({
                type: 'EDIT_OPERATION',
                operation: operation,
                userId: this.currentUserId
            }));
        });
    }
    
    setupAutoSave() {
        // è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
        let saveTimer;
        this.editor.on('summernote.change', () => {
            clearTimeout(saveTimer);
            saveTimer = setTimeout(() => {
                this.autoSave();
            }, 5000); // 5ç§’åè‡ªåŠ¨ä¿å­˜
        });
    }
    
    async onImageUpload(files) {
        const file = files[0];
        const formData = new FormData();
        formData.append('file', file);
        formData.append('documentId', this.documentId);
        
        try {
            const response = await fetch('/api/v1/documents/upload-image', {
                method: 'POST',
                body: formData,
                headers: {
                    'Authorization': `Bearer ${this.authToken}`
                }
            });
            
            const result = await response.json();
            if (result.success) {
                this.editor.summernote('insertImage', result.data.url);
            }
        } catch (error) {
            console.error('Image upload failed:', error);
        }
    }
    
    autoSave() {
        const content = this.editor.summernote('code');
        
        fetch(`/api/v1/documents/${this.documentId}/auto-save`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${this.authToken}`
            },
            body: JSON.stringify({
                content: content,
                timestamp: new Date().toISOString()
            })
        }).then(response => {
            if (response.ok) {
                this.showSaveStatus('å·²è‡ªåŠ¨ä¿å­˜');
            }
        });
    }
}
```

### 3. å·¥ä½œæµå¼•æ“æ¨¡å— (Workflow Engine Module)

#### 3.1 æµç¨‹è®¾è®¡å™¨åŠŸèƒ½

**åŠŸèƒ½æè¿°**: æä¾›å¯è§†åŒ–çš„æµç¨‹è®¾è®¡å™¨ï¼Œæ”¯æŒæ‹–æ‹½å¼æµç¨‹è®¾è®¡å’ŒBPMNæ ‡å‡†

**æŠ€æœ¯å®ç°**:

```javascript
// BPMNæµç¨‹è®¾è®¡å™¨
class BpmnDesigner {
    constructor(container, options = {}) {
        this.container = container;
        this.options = {
            keyboard: {
                bindTo: window
            },
            propertiesPanel: {
                parent: '#properties-panel'
            },
            additionalModules: [
                BpmnPropertiesPanelModule,
                BpmnModelerModule
            ],
            moddleExtensions: {
                camunda: camundaModdleDescriptor
            },
            ...options
        };
        
        this.init();
    }
    
    init() {
        this.modeler = new BpmnModeler({
            container: this.container,
            ...this.options
        });
        
        this.setupEventListeners();
        this.loadDefaultDiagram();
    }
    
    setupEventListeners() {
        // ç›‘å¬å…ƒç´ é€‰æ‹©äº‹ä»¶
        this.modeler.on('selection.changed', (event) => {
            const { newSelection } = event;
            this.onElementSelected(newSelection[0]);
        });
        
        // ç›‘å¬å…ƒç´ å˜æ›´äº‹ä»¶
        this.modeler.on('element.changed', (event) => {
            const { element } = event;
            this.onElementChanged(element);
        });
        
        // ç›‘å¬å½¢çŠ¶æ·»åŠ äº‹ä»¶
        this.modeler.on('shape.added', (event) => {
            const { element } = event;
            this.onShapeAdded(element);
        });
    }
    
    async saveProcessDefinition() {
        try {
            const { xml } = await this.modeler.saveXML({ format: true });
            const { svg } = await this.modeler.saveSVG();
            
            const processDefinition = {
                name: this.getProcessName(),
                key: this.getProcessKey(),
                description: this.getProcessDescription(),
                bpmnXml: xml,
                svg: svg,
                version: this.getVersion()
            };
            
            const response = await fetch('/api/v1/process-definitions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${this.authToken}`
                },
                body: JSON.stringify(processDefinition)
            });
            
            if (response.ok) {
                this.showSaveStatus('æµç¨‹å®šä¹‰å·²ä¿å­˜');
                return await response.json();
            }
        } catch (error) {
            console.error('Save failed:', error);
            this.showSaveStatus('ä¿å­˜å¤±è´¥', 'error');
        }
    }
    
    async loadProcessDefinition(processDefinitionId) {
        try {
            const response = await fetch(`/api/v1/process-definitions/${processDefinitionId}`);
            const processDefinition = await response.json();
            
            await this.modeler.importXML(processDefinition.bpmnXml);
            this.setProcessInfo(processDefinition);
            
        } catch (error) {
            console.error('Load failed:', error);
        }
    }
    
    validateProcess() {
        const warnings = [];
        const errors = [];
        
        // æ£€æŸ¥å¼€å§‹äº‹ä»¶
        const startEvents = this.modeler.getDefinitions().rootElements[0].flowElements
            .filter(element => element.$type === 'bpmn:StartEvent');
        
        if (startEvents.length === 0) {
            errors.push('æµç¨‹å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå¼€å§‹äº‹ä»¶');
        }
        
        // æ£€æŸ¥ç»“æŸäº‹ä»¶
        const endEvents = this.modeler.getDefinitions().rootElements[0].flowElements
            .filter(element => element.$type === 'bpmn:EndEvent');
        
        if (endEvents.length === 0) {
            errors.push('æµç¨‹å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªç»“æŸäº‹ä»¶');
        }
        
        // æ£€æŸ¥ç½‘å…³é…ç½®
        const gateways = this.modeler.getDefinitions().rootElements[0].flowElements
            .filter(element => element.$type === 'bpmn:ExclusiveGateway');
        
        gateways.forEach(gateway => {
            const outgoingFlows = gateway.outgoing || [];
            if (outgoingFlows.length < 2) {
                warnings.push(`æ’ä»–ç½‘å…³ "${gateway.name || gateway.id}" è‡³å°‘éœ€è¦ä¸¤æ¡è¾“å‡ºæµ`);
            }
        });
        
        return { warnings, errors };
    }
}
```

#### 3.2 æµç¨‹æ‰§è¡Œå¼•æ“

**åç«¯å®ç°**:

```java
@Service
@Transactional
public class WorkflowExecutionService {
    
    @Autowired
    private ProcessEngine processEngine;
    
    @Autowired
    private TaskService taskService;
    
    @Autowired
    private RuntimeService runtimeService;
    
    @Autowired
    private HistoryService historyService;
    
    /**
     * å¯åŠ¨æµç¨‹å®ä¾‹
     */
    public ProcessInstance startProcess(StartProcessCommand command) {
        // 1. éªŒè¯æµç¨‹å®šä¹‰
        ProcessDefinition processDefinition = processEngine.getRepositoryService()
            .createProcessDefinitionQuery()
            .processDefinitionId(command.getProcessDefinitionId())
            .singleResult();
        
        if (processDefinition == null) {
            throw new ProcessDefinitionNotFoundException("æµç¨‹å®šä¹‰ä¸å­˜åœ¨");
        }
        
        // 2. å‡†å¤‡å¯åŠ¨å˜é‡
        Map<String, Object> variables = new HashMap<>(command.getVariables());
        variables.put("startUserId", command.getStartUserId());
        variables.put("businessKey", command.getBusinessKey());
        
        // 3. å¯åŠ¨æµç¨‹å®ä¾‹
        ProcessInstance processInstance = runtimeService.startProcessInstanceById(
            command.getProcessDefinitionId(),
            command.getBusinessKey(),
            variables
        );
        
        // 4. ä¿å­˜æµç¨‹å®ä¾‹æ‰©å±•ä¿¡æ¯
        saveProcessInstanceExtension(processInstance, command);
        
        // 5. å‘å¸ƒäº‹ä»¶
        DomainEventPublisher.publish(new ProcessStartedEvent(
            processInstance.getId(),
            command.getStartUserId()
        ));
        
        return processInstance;
    }
    
    /**
     * å®Œæˆä»»åŠ¡
     */
    public void completeTask(CompleteTaskCommand command) {
        // 1. è·å–ä»»åŠ¡
        Task task = taskService.createTaskQuery()
            .taskId(command.getTaskId())
            .singleResult();
        
        if (task == null) {
            throw new TaskNotFoundException("ä»»åŠ¡ä¸å­˜åœ¨");
        }
        
        // 2. éªŒè¯ä»»åŠ¡åˆ†é…
        if (!task.getAssignee().equals(command.getUserId().toString())) {
            throw new TaskNotAssignedException("ä»»åŠ¡æœªåˆ†é…ç»™å½“å‰ç”¨æˆ·");
        }
        
        // 3. æ‰§è¡Œå‰ç½®éªŒè¯
        validateTaskCompletion(task, command);
        
        // 4. æ·»åŠ å®¡æ‰¹æ„è§
        if (command.getComment() != null) {
            taskService.addComment(command.getTaskId(), task.getProcessInstanceId(), command.getComment());
        }
        
        // 5. å¤„ç†é™„ä»¶
        if (command.getAttachments() != null) {
            handleTaskAttachments(command.getTaskId(), command.getAttachments());
        }
        
        // 6. å®Œæˆä»»åŠ¡
        taskService.complete(command.getTaskId(), command.getVariables());
        
        // 7. å‘å¸ƒäº‹ä»¶
        DomainEventPublisher.publish(new TaskCompletedEvent(
            command.getTaskId(),
            command.getUserId(),
            task.getProcessInstanceId()
        ));
    }
    
    /**
     * é©³å›ä»»åŠ¡
     */
    public void rejectTask(RejectTaskCommand command) {
        // 1. è·å–ä»»åŠ¡å’Œæµç¨‹å®ä¾‹
        Task task = taskService.createTaskQuery()
            .taskId(command.getTaskId())
            .singleResult();
        
        ProcessInstance processInstance = runtimeService.createProcessInstanceQuery()
            .processInstanceId(task.getProcessInstanceId())
            .singleResult();
        
        // 2. æ·»åŠ é©³å›æ„è§
        taskService.addComment(command.getTaskId(), task.getProcessInstanceId(), command.getReason());
        
        // 3. é©³å›åˆ°æŒ‡å®šèŠ‚ç‚¹
        if (command.getRejectToActivityId() != null) {
            runtimeService.createProcessInstanceModification(processInstance.getId())
                .startBeforeActivity(command.getRejectToActivityId())
                .cancelAllForActivity(task.getTaskDefinitionKey())
                .execute();
        } else {
            // é©³å›åˆ°å¼€å§‹èŠ‚ç‚¹
            runtimeService.createProcessInstanceModification(processInstance.getId())
                .startBeforeActivity(processInstance.getStartActivityId())
                .cancelAllForActivity(task.getTaskDefinitionKey())
                .execute();
        }
        
        // 4. å‘å¸ƒäº‹ä»¶
        DomainEventPublisher.publish(new TaskRejectedEvent(
            command.getTaskId(),
            command.getUserId(),
            command.getReason()
        ));
    }
    
    /**
     * å§”æ´¾ä»»åŠ¡
     */
    public void delegateTask(DelegateTaskCommand command) {
        Task task = taskService.createTaskQuery()
            .taskId(command.getTaskId())
            .singleResult();
        
        if (task == null) {
            throw new TaskNotFoundException("ä»»åŠ¡ä¸å­˜åœ¨");
        }
        
        // éªŒè¯å§”æ´¾æƒé™
        if (!task.getAssignee().equals(command.getUserId().toString())) {
            throw new TaskNotAssignedException("åªæœ‰ä»»åŠ¡è´Ÿè´£äººå¯ä»¥å§”æ´¾ä»»åŠ¡");
        }
        
        // æ‰§è¡Œå§”æ´¾
        taskService.delegateTask(command.getTaskId(), command.getDelegateUserId().toString());
        
        // æ·»åŠ å§”æ´¾è®°å½•
        taskService.addComment(command.getTaskId(), task.getProcessInstanceId(), 
            String.format("ä»»åŠ¡å·²å§”æ´¾ç»™ç”¨æˆ· %sï¼Œå§”æ´¾åŸå› ï¼š%s", 
                command.getDelegateUserId(), command.getReason()));
        
        // å‘å¸ƒäº‹ä»¶
        DomainEventPublisher.publish(new TaskDelegatedEvent(
            command.getTaskId(),
            command.getUserId(),
            command.getDelegateUserId()
        ));
    }
}
```

## ğŸ“Š åŠŸèƒ½æ¨¡å—ä¾èµ–å…³ç³»

### 1. æ¨¡å—ä¾èµ–å›¾

```mermaid
graph TB
    subgraph "æ ¸å¿ƒä¸šåŠ¡æ¨¡å—"
        A[ç”¨æˆ·æƒé™æ¨¡å—] --> B[å†…å®¹ç®¡ç†æ¨¡å—]
        B --> C[å·¥ä½œæµå¼•æ“æ¨¡å—]
        A --> C
    end
    
    subgraph "æ”¯æ’‘æ¨¡å—"
        D[æ¶ˆæ¯é€šçŸ¥æ¨¡å—] --> A
        D --> B
        D --> C
        E[æ–‡ä»¶ç®¡ç†æ¨¡å—] --> B
        F[ç³»ç»Ÿç›‘æ§æ¨¡å—] --> A
        F --> B
        F --> C
    end
    
    subgraph "åŸºç¡€è®¾æ–½æ¨¡å—"
        G[ç¼“å­˜æœåŠ¡] --> A
        G --> B
        G --> C
        H[æœç´¢æœåŠ¡] --> B
        I[æ¶ˆæ¯é˜Ÿåˆ—] --> D
        I --> C
        J[å­˜å‚¨æœåŠ¡] --> E
    end
```

### 2. æ¥å£ä¾èµ–çŸ©é˜µ

| æ¨¡å— | ç”¨æˆ·æƒé™ | å†…å®¹ç®¡ç† | å·¥ä½œæµå¼•æ“ | æ¶ˆæ¯é€šçŸ¥ | æ–‡ä»¶ç®¡ç† |
|------|----------|----------|------------|----------|----------|
| ç”¨æˆ·æƒé™ | - | âœ“ç”¨æˆ·ä¿¡æ¯ | âœ“ç”¨æˆ·æƒé™ | âœ“é€šçŸ¥ç”¨æˆ· | - |
| å†…å®¹ç®¡ç† | âœ“æƒé™æ£€æŸ¥ | - | âœ“å®¡æ ¸æµç¨‹ | âœ“å†…å®¹é€šçŸ¥ | âœ“æ–‡ä»¶å­˜å‚¨ |
| å·¥ä½œæµå¼•æ“ | âœ“ä»»åŠ¡åˆ†é… | âœ“æµç¨‹è§¦å‘ | - | âœ“ä»»åŠ¡é€šçŸ¥ | âœ“æµç¨‹é™„ä»¶ |
| æ¶ˆæ¯é€šçŸ¥ | âœ“ç”¨æˆ·é€šçŸ¥ | âœ“å†…å®¹é€šçŸ¥ | âœ“æµç¨‹é€šçŸ¥ | - | - |
| æ–‡ä»¶ç®¡ç† | - | âœ“æ–‡æ¡£å­˜å‚¨ | âœ“æµç¨‹é™„ä»¶ | - | - |

## ğŸš€ åŠŸèƒ½å®ç°ä¼˜å…ˆçº§

### 1. MVPåŠŸèƒ½é›† (v1.0)

| åŠŸèƒ½æ¨¡å— | åŠŸèƒ½ç‚¹ | ä¼˜å…ˆçº§ | å·¥æœŸ(å¤©) | ä¾èµ– |
|----------|--------|--------|----------|------|
| ç”¨æˆ·æƒé™ | ç”¨æˆ·æ³¨å†Œ/ç™»å½• | P0 | 5 | - |
| ç”¨æˆ·æƒé™ | åŸºç¡€æƒé™ç®¡ç† | P0 | 3 | ç”¨æˆ·æ³¨å†Œ |
| å†…å®¹ç®¡ç† | æ–‡æ¡£CRUD | P0 | 7 | ç”¨æˆ·æƒé™ |
| å†…å®¹ç®¡ç† | åŸºç¡€æœç´¢ | P1 | 5 | æ–‡æ¡£CRUD |
| å·¥ä½œæµå¼•æ“ | ç®€å•å®¡æ‰¹æµ | P1 | 10 | å†…å®¹ç®¡ç† |
| æ¶ˆæ¯é€šçŸ¥ | é‚®ä»¶é€šçŸ¥ | P1 | 3 | ç”¨æˆ·æƒé™ |

### 2. å¢å¼ºåŠŸèƒ½é›† (v2.0)

| åŠŸèƒ½æ¨¡å— | åŠŸèƒ½ç‚¹ | ä¼˜å…ˆçº§ | å·¥æœŸ(å¤©) | ä¾èµ– |
|----------|--------|--------|----------|------|
| ç”¨æˆ·æƒé™ | å¤šå› å­è®¤è¯ | P0 | 5 | åŸºç¡€æƒé™ |
| å†…å®¹ç®¡ç† | å¯Œæ–‡æœ¬ç¼–è¾‘ | P0 | 8 | æ–‡æ¡£CRUD |
| å†…å®¹ç®¡ç† | ååŒç¼–è¾‘ | P1 | 12 | å¯Œæ–‡æœ¬ç¼–è¾‘ |
| å·¥ä½œæµå¼•æ“ | å¯è§†åŒ–è®¾è®¡å™¨ | P0 | 15 | ç®€å•å®¡æ‰¹æµ |
| å·¥ä½œæµå¼•æ“ | å¤æ‚æµç¨‹æ”¯æŒ | P1 | 10 | å¯è§†åŒ–è®¾è®¡å™¨ |
| æ–‡ä»¶ç®¡ç† | åˆ†å¸ƒå¼å­˜å‚¨ | P0 | 7 | åŸºç¡€å­˜å‚¨ |

### 3. æ‰©å±•åŠŸèƒ½é›† (v3.0)

| åŠŸèƒ½æ¨¡å— | åŠŸèƒ½ç‚¹ | ä¼˜å…ˆçº§ | å·¥æœŸ(å¤©) | ä¾èµ– |
|----------|--------|--------|----------|------|
| ç”¨æˆ·æƒé™ | OAuthé›†æˆ | P1 | 6 | åŸºç¡€æƒé™ |
| å†…å®¹ç®¡ç† | AIå†…å®¹æ¨è | P2 | 15 | ååŒç¼–è¾‘ |
| å·¥ä½œæµå¼•æ“ | æ€§èƒ½ä¼˜åŒ– | P1 | 8 | å¤æ‚æµç¨‹ |
| æ¶ˆæ¯é€šçŸ¥ | å¤šæ¸ é“æ¨é€ | P1 | 10 | é‚®ä»¶é€šçŸ¥ |
| ç³»ç»Ÿç›‘æ§ | å®æ—¶ç›‘æ§ | P0 | 8 | åŸºç¡€æ¨¡å— |

## ğŸ§ª åŠŸèƒ½æµ‹è¯•å®ç°

### 1. å•å…ƒæµ‹è¯•æ¡†æ¶

```java
@ExtendWith(MockitoExtension.class)
class DocumentManagementServiceTest {
    
    @Mock
    private DocumentRepository documentRepository;
    
    @Mock
    private DocumentVersionService documentVersionService;
    
    @Mock
    private DocumentSearchService documentSearchService;
    
    @Mock
    private PermissionService permissionService;
    
    @InjectMocks
    private DocumentManagementService documentManagementService;
    
    @Test
    @DisplayName("åˆ›å»ºæ–‡æ¡£ - æˆåŠŸ")
    void createDocument_Success() {
        // Given
        CreateDocumentCommand command = CreateDocumentCommand.builder()
            .title("æµ‹è¯•æ–‡æ¡£")
            .content("æµ‹è¯•å†…å®¹")
            .authorId(1L)
            .categoryId(1L)
            .accessLevel(AccessLevel.PUBLIC)
            .build();
        
        User author = User.builder()
            .id(1L)
            .username("testuser")
            .build();
        
        Category category = Category.builder()
            .id(1L)
            .name("æµ‹è¯•åˆ†ç±»")
            .build();
        
        Document savedDocument = Document.builder()
            .id(1L)
            .title("æµ‹è¯•æ–‡æ¡£")
            .content("æµ‹è¯•å†…å®¹")
            .author(author)
            .category(category)
            .status(DocumentStatus.DRAFT)
            .build();
        
        when(documentRepository.save(any(Document.class))).thenReturn(savedDocument);
        
        // When
        Document result = documentManagementService.createDocument(command);
        
        // Then
        assertThat(result.getTitle()).isEqualTo("æµ‹è¯•æ–‡æ¡£");
        assertThat(result.getContent()).isEqualTo("æµ‹è¯•å†…å®¹");
        assertThat(result.getStatus()).isEqualTo(DocumentStatus.DRAFT);
        
        verify(documentRepository).save(any(Document.class));
        verify(documentVersionService).createVersion(any(Document.class), eq("åˆå§‹ç‰ˆæœ¬"));
        verify(documentSearchService).indexDocument(any(Document.class));
    }
    
    @Test
    @DisplayName("åˆ›å»ºæ–‡æ¡£ - æƒé™ä¸è¶³")
    void createDocument_InsufficientPermission() {
        // Given
        CreateDocumentCommand command = CreateDocumentCommand.builder()
            .title("æµ‹è¯•æ–‡æ¡£")
            .authorId(1L)
            .build();
        
        doThrow(new AccessDeniedException("æƒé™ä¸è¶³"))
            .when(permissionService).checkPermission(eq(1L), eq("document"), eq("create"));
        
        // When & Then
        assertThrows(AccessDeniedException.class, () -> {
            documentManagementService.createDocument(command);
        });
        
        verify(documentRepository, never()).save(any(Document.class));
    }
}
```

### 2. é›†æˆæµ‹è¯•æ¡†æ¶

```java
@SpringBootTest
@TestPropertySource(properties = {
    "spring.datasource.url=jdbc:h2:mem:testdb",
    "spring.jpa.hibernate.ddl-auto=create-drop"
})
@Transactional
class DocumentControllerIntegrationTest {
    
    @Autowired
    private TestRestTemplate restTemplate;
    
    @Autowired
    private DocumentRepository documentRepository;
    
    @Autowired
    private UserRepository userRepository;
    
    @Autowired
    private CategoryRepository categoryRepository;
    
    private String authToken;
    
    @BeforeEach
    void setUp() {
        // åˆ›å»ºæµ‹è¯•ç”¨æˆ·å¹¶è·å–token
        User testUser = User.builder()
            .username("testuser")
            .email("test@example.com")
            .password("password")
            .status(UserStatus.ACTIVE)
            .build();
        userRepository.save(testUser);
        
        LoginRequest loginRequest = LoginRequest.builder()
            .username("testuser")
            .password("password")
            .build();
        
        ResponseEntity<ApiResponse<LoginResult>> loginResponse = restTemplate.postForEntity(
            "/api/v1/auth/login", loginRequest, 
            new ParameterizedTypeReference<ApiResponse<LoginResult>>() {});
        
        authToken = loginResponse.getBody().getData().getAccessToken();
    }
    
    @Test
    @DisplayName("åˆ›å»ºæ–‡æ¡£ - é›†æˆæµ‹è¯•")
    void createDocument_Integration() {
        // Given
        CreateDocumentRequest request = CreateDocumentRequest.builder()
            .title("é›†æˆæµ‹è¯•æ–‡æ¡£")
            .content("è¿™æ˜¯é›†æˆæµ‹è¯•å†…å®¹")
            .categoryId(1L)
            .accessLevel("PUBLIC")
            .build();
        
        HttpHeaders headers = new HttpHeaders();
        headers.setBearerAuth(authToken);
        HttpEntity<CreateDocumentRequest> entity = new HttpEntity<>(request, headers);
        
        // When
        ResponseEntity<ApiResponse<DocumentDTO>> response = restTemplate.postForEntity(
            "/api/v1/documents", entity, 
            new ParameterizedTypeReference<ApiResponse<DocumentDTO>>() {});
        
        // Then
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.CREATED);
        assertThat(response.getBody().getData().getTitle()).isEqualTo("é›†æˆæµ‹è¯•æ–‡æ¡£");
        assertThat(response.getBody().getData().getContent()).isEqualTo("è¿™æ˜¯é›†æˆæµ‹è¯•å†…å®¹");
        
        // éªŒè¯æ•°æ®åº“ä¸­çš„æ•°æ®
        Document savedDocument = documentRepository.findById(response.getBody().getData().getId()).orElse(null);
        assertThat(savedDocument).isNotNull();
        assertThat(savedDocument.getTitle()).isEqualTo("é›†æˆæµ‹è¯•æ–‡æ¡£");
    }
}
```

---

*æœ¬æ–‡æ¡£æä¾›äº†è¯¦ç»†çš„åŠŸèƒ½åˆ†è§£è®¾è®¡ï¼ŒåŒ…æ‹¬å…·ä½“çš„å®ç°ä»£ç ã€é…ç½®ç¤ºä¾‹å’Œæµ‹è¯•ç­–ç•¥ï¼Œä¸ºå¼€å‘å›¢é˜Ÿæä¾›äº†å®Œæ•´çš„åŠŸèƒ½å®ç°æŒ‡å¯¼ã€‚*