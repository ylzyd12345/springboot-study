# æ—¥å¿—é‡‡é›†æ–¹æ¡ˆå¯¹æ¯”ä¸æ¨è

æœ¬æ–‡æ¡£å¯¹æ¯”äº†ä¸»æµçš„æ—¥å¿—é‡‡é›†æ–¹æ¡ˆï¼Œå¹¶ç»™å‡ºæ¨èæ–¹æ¡ˆã€‚

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

### 1. ELK Stack (Elasticsearch + Logstash + Kibana)

#### ä¼˜ç‚¹
- âœ… åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå¤æ‚çš„æ—¥å¿—åˆ†æ
- âœ… ç”Ÿæ€ç³»ç»Ÿå®Œå–„ï¼Œæ’ä»¶ä¸°å¯Œ
- âœ… æ”¯æŒå…¨æ–‡æ£€ç´¢ï¼ŒæŸ¥è¯¢èƒ½åŠ›å¼º
- âœ… å¯è§†åŒ–åŠŸèƒ½å¼ºå¤§
- âœ… ç¤¾åŒºæˆç†Ÿï¼Œæ–‡æ¡£é½å…¨

#### ç¼ºç‚¹
- âŒ èµ„æºå ç”¨é«˜ï¼ˆElasticsearch å†…å­˜æ¶ˆè€—å¤§ï¼‰
- âŒ å­¦ä¹ æ›²çº¿é™¡å³­
- âŒ é…ç½®å¤æ‚
- âŒ å¯åŠ¨æ…¢ï¼Œè¿ç»´æˆæœ¬é«˜
- âŒ å•†ä¸šç‰ˆæ”¶è´¹

#### é€‚ç”¨åœºæ™¯
- å¤§å‹ä¼ä¸šçº§åº”ç”¨
- éœ€è¦å¤æ‚çš„æ—¥å¿—åˆ†æå’Œæ£€ç´¢
- æœ‰è¶³å¤Ÿçš„ç¡¬ä»¶èµ„æº
- ä¸“ä¸šçš„è¿ç»´å›¢é˜Ÿ

### 2. Loki (Grafana Loki)

#### ä¼˜ç‚¹
- âœ… è½»é‡çº§ï¼Œèµ„æºå ç”¨ä½
- âœ… ä¸ Grafana å®Œç¾é›†æˆ
- âœ… ä¸ Prometheus æŠ€æœ¯æ ˆç»Ÿä¸€
- âœ… å­¦ä¹ æ›²çº¿å¹³ç¼“
- âœ… æˆæœ¬ä½ï¼Œå®Œå…¨å¼€æº
- âœ… æ”¯æŒæ ‡ç­¾ç´¢å¼•ï¼ŒæŸ¥è¯¢é«˜æ•ˆ
- âœ… é€‚åˆäº‘åŸç”Ÿç¯å¢ƒ

#### ç¼ºç‚¹
- âŒ å…¨æ–‡æ£€ç´¢èƒ½åŠ›ä¸å¦‚ Elasticsearch
- âŒ ç”Ÿæ€ç³»ç»Ÿç›¸å¯¹è¾ƒå°
- âŒ ä¸æ”¯æŒå¤æ‚çš„æ—¥å¿—åˆ†æ

#### é€‚ç”¨åœºæ™¯
- ä¸­å°å‹åº”ç”¨
- äº‘åŸç”Ÿç¯å¢ƒ
- å·²ä½¿ç”¨ Prometheus + Grafana
- èµ„æºå—é™çš„ç¯å¢ƒ
- éœ€è¦å¿«é€Ÿéƒ¨ç½²

### 3. Graylog

#### ä¼˜ç‚¹
- âœ… åŸºäº Elasticsearchï¼ŒåŠŸèƒ½å¼ºå¤§
- âœ… Web ç•Œé¢å‹å¥½
- âœ… æ”¯æŒå‘Šè­¦åŠŸèƒ½
- âœ… å¼€æºå…è´¹

#### ç¼ºç‚¹
- âŒ ä¾èµ– Elasticsearchï¼Œèµ„æºå ç”¨é«˜
- âŒ ç¤¾åŒºç›¸å¯¹è¾ƒå°
- âŒ æ–‡æ¡£ä¸å¦‚ ELK å®Œå–„

#### é€‚ç”¨åœºæ™¯
- éœ€è¦ Web ç•Œé¢çš„æ—¥å¿—ç®¡ç†
- å·²æœ‰ Elasticsearch åŸºç¡€è®¾æ–½
- éœ€è¦å‘Šè­¦åŠŸèƒ½

### 4. Fluentd + Elasticsearch

#### ä¼˜ç‚¹
- âœ… Fluentd æ’ä»¶ä¸°å¯Œ
- âœ… æ”¯æŒå¤šç§æ•°æ®æº
- âœ… é…ç½®çµæ´»
- âœ… ç¤¾åŒºæ´»è·ƒ

#### ç¼ºç‚¹
- âŒ é…ç½®å¤æ‚
- âŒ ä¾èµ– Elasticsearch
- âŒ èµ„æºå ç”¨é«˜

#### é€‚ç”¨åœºæ™¯
- éœ€è¦é‡‡é›†å¤šç§æ•°æ®æº
- å·²æœ‰ Elasticsearch åŸºç¡€è®¾æ–½

### 5. Seq

#### ä¼˜ç‚¹
- âœ… ä¸“ä¸º .NET è®¾è®¡
- âœ… æ”¯æŒç»“æ„åŒ–æ—¥å¿—
- âœ… æŸ¥è¯¢è¯­è¨€ç®€å•
- âœ… èµ„æºå ç”¨ä½

#### ç¼ºç‚¹
- âŒ ä¸»è¦é¢å‘ .NET
- âŒ åŠŸèƒ½ç›¸å¯¹ç®€å•
- âŒ å•†ä¸šç‰ˆæ”¶è´¹

#### é€‚ç”¨åœºæ™¯
- .NET åº”ç”¨
- éœ€è¦ç»“æ„åŒ–æ—¥å¿—

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šLoki + Grafanaï¼ˆå¼ºçƒˆæ¨èï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… Spring Boot åº”ç”¨
- âœ… å·²ä½¿ç”¨ Prometheus + Grafana
- âœ… èµ„æºå—é™çš„ç¯å¢ƒ
- âœ… äº‘åŸç”Ÿç¯å¢ƒ
- âœ… éœ€è¦å¿«é€Ÿéƒ¨ç½²

**ä¼˜åŠ¿**ï¼š
1. **è½»é‡é«˜æ•ˆ**ï¼šLoki èµ„æºå ç”¨ä»…ä¸º ELK çš„ 1/10
2. **ç»Ÿä¸€æŠ€æœ¯æ ˆ**ï¼šä¸ Prometheus + Grafana å®Œç¾é›†æˆ
3. **æ˜“äºä½¿ç”¨**ï¼šå­¦ä¹ æ›²çº¿å¹³ç¼“ï¼Œé…ç½®ç®€å•
4. **æˆæœ¬ä½**ï¼šå®Œå…¨å¼€æºï¼Œæ— å•†ä¸šç‰ˆé™åˆ¶
5. **äº‘åŸç”Ÿ**ï¼šä¸“ä¸ºå®¹å™¨åŒ–ç¯å¢ƒè®¾è®¡

**æ¶æ„å›¾**ï¼š
```
åº”ç”¨ â†’ Promtail â†’ Loki â†’ Grafana
                     â†“
                  Prometheus
```

### æ–¹æ¡ˆäºŒï¼šELK Stack

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… å¤§å‹ä¼ä¸šçº§åº”ç”¨
- âœ… éœ€è¦å¤æ‚çš„æ—¥å¿—åˆ†æ
- âœ… éœ€è¦å…¨æ–‡æ£€ç´¢
- âœ… æœ‰è¶³å¤Ÿçš„ç¡¬ä»¶èµ„æº
- âœ… æœ‰ä¸“ä¸šçš„è¿ç»´å›¢é˜Ÿ

**ä¼˜åŠ¿**ï¼š
1. **åŠŸèƒ½å¼ºå¤§**ï¼šæ”¯æŒå¤æ‚çš„æ—¥å¿—åˆ†æå’Œæ£€ç´¢
2. **ç”Ÿæ€å®Œå–„**ï¼šæ’ä»¶ä¸°å¯Œï¼Œæ‰©å±•æ€§å¼º
3. **å¯è§†åŒ–å¼ºå¤§**ï¼šKibana åŠŸèƒ½å…¨é¢
4. **ç¤¾åŒºæˆç†Ÿ**ï¼šæ–‡æ¡£é½å…¨ï¼Œé—®é¢˜è§£å†³æ–¹æ¡ˆå¤š

**æ¶æ„å›¾**ï¼š
```
åº”ç”¨ â†’ Filebeat â†’ Logstash â†’ Elasticsearch â†’ Kibana
```

### æ–¹æ¡ˆä¸‰ï¼šæ··åˆæ–¹æ¡ˆï¼ˆæ¨èï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… éœ€è¦ Loki çš„è½»é‡çº§ç‰¹æ€§
- âœ… éœ€è¦ Elasticsearch çš„å¼ºå¤§æ£€ç´¢èƒ½åŠ›
- âœ… æœ‰å……è¶³çš„èµ„æº
- âœ… éœ€è¦åŒæ—¶æ”¯æŒæ—¥å¿—æŸ¥çœ‹å’Œä¸šåŠ¡æ–‡æ¡£æ£€ç´¢

**æ¶æ„**ï¼š
```
åº”ç”¨ â†’ Promtail â†’ Loki â†’ Grafana (å®æ—¶æ—¥å¿—æŸ¥çœ‹)
                   â†“
              Elasticsearch â†’ Kibana (ä¸šåŠ¡æ–‡æ¡£æ£€ç´¢)
```

**èŒè´£åˆ†å·¥**ï¼š
- **Loki + Grafana**ï¼šåº”ç”¨æ—¥å¿—é‡‡é›†å’ŒæŸ¥çœ‹ï¼ˆè½»é‡é«˜æ•ˆï¼‰
- **Elasticsearch + Kibana**ï¼šä¸šåŠ¡æ–‡æ¡£æ£€ç´¢ï¼ˆå¼ºå¤§å…¨æ–‡æ£€ç´¢ï¼‰
- **ä¸¤è€…ä¸å†²çª**ï¼šå„å¸å…¶èŒï¼Œäº’ä¸å¹²æ‰°

## ğŸ“‹ æ–¹æ¡ˆå¯¹æ¯”è¡¨

| ç‰¹æ€§ | ELK Stack | Loki | Graylog | Fluentd + ES |
|------|-----------|-----|---------|--------------|
| **èµ„æºå ç”¨** | é«˜ï¼ˆ8GB+ï¼‰ | ä½ï¼ˆ1-2GBï¼‰ | é«˜ï¼ˆ8GB+ï¼‰ | é«˜ï¼ˆ8GB+ï¼‰ |
| **å­¦ä¹ æ›²çº¿** | é™¡å³­ | å¹³ç¼“ | ä¸­ç­‰ | é™¡å³­ |
| **éƒ¨ç½²éš¾åº¦** | å¤æ‚ | ç®€å• | ä¸­ç­‰ | å¤æ‚ |
| **å…¨æ–‡æ£€ç´¢** | âœ… å¼º | âš ï¸ ä¸€èˆ¬ | âœ… å¼º | âœ… å¼º |
| **æ ‡ç­¾ç´¢å¼•** | âŒ | âœ… ä¼˜ç§€ | âŒ | âŒ |
| **å¯è§†åŒ–** | âœ… Kibana | âœ… Grafana | âœ… Web UI | âœ… Kibana |
| **å‘Šè­¦åŠŸèƒ½** | âœ… | âœ… | âœ… | âœ… |
| **æˆæœ¬** | é«˜ï¼ˆå•†ä¸šç‰ˆï¼‰ | ä½ï¼ˆå®Œå…¨å¼€æºï¼‰ | ä½ï¼ˆå¼€æºï¼‰ | é«˜ |
| **äº‘åŸç”Ÿ** | âš ï¸ ä¸€èˆ¬ | âœ… ä¼˜ç§€ | âš ï¸ ä¸€èˆ¬ | âš ï¸ ä¸€èˆ¬ |
| **ç”Ÿæ€å®Œå–„** | âœ… | âš ï¸ | âš ï¸ | âœ… |
| **ç¤¾åŒºæ´»è·ƒ** | âœ… | âœ… | âš ï¸ | âœ… |

## ğŸš€ Junmo Platform æ¨èæ–¹æ¡ˆ

### æ¨èï¼šLoki + Grafana + Elasticsearchï¼ˆæ··åˆæ–¹æ¡ˆï¼‰

**ç†ç”±**ï¼š
1. **é¡¹ç›®å·²ä½¿ç”¨ Prometheus + Grafana**ï¼šæŠ€æœ¯æ ˆç»Ÿä¸€
2. **Spring Boot åº”ç”¨**ï¼šLoki å¯¹ç»“æ„åŒ–æ—¥å¿—æ”¯æŒè‰¯å¥½
3. **èµ„æºä¼˜åŒ–**ï¼šLoki èµ„æºå ç”¨ä½ï¼Œé€‚åˆå¼€å‘ç¯å¢ƒ
4. **ä¸šåŠ¡éœ€æ±‚**ï¼šElasticsearch ç”¨äºä¸šåŠ¡æ–‡æ¡£æ£€ç´¢
5. **å¿«é€Ÿéƒ¨ç½²**ï¼šé…ç½®ç®€å•ï¼Œ5åˆ†é’Ÿå³å¯å¯åŠ¨
6. **æˆæœ¬æ§åˆ¶**ï¼šå®Œå…¨å¼€æºï¼Œæ— å•†ä¸šç‰ˆé™åˆ¶
7. **åŠŸèƒ½å®Œå–„**ï¼šä¸¤è€…ç»“åˆï¼ŒåŠŸèƒ½äº’è¡¥

### æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Junmo Platform åº”ç”¨                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
        â–¼                                       â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Promtail â”‚                           â”‚ åº”ç”¨æ—¥å¿—  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                               â”‚
        â–¼                               â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Loki    â”‚                   â”‚Elasticsearchâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                               â”‚
        â–¼                               â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Grafana â”‚                   â”‚  Kibana  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                               â”‚
        â–¼                               â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚         ç»Ÿä¸€çš„ç›‘æ§å’Œæ—¥å¿—æŸ¥çœ‹ç•Œé¢          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éƒ¨ç½²æ­¥éª¤

#### 1. å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåŒ…æ‹¬ Loki å’Œ Elasticsearchï¼‰

```bash
cd F:\codes\roadmap\github-project\springboot-study\Junmo Platform

# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆLoki å·²é›†æˆåˆ°åŸºçº¿é…ç½®ï¼‰
docker-compose up -d
```

#### 2. é…ç½®åº”ç”¨æ—¥å¿—æ ¼å¼

åœ¨ `application.yml` ä¸­é…ç½® JSON æ ¼å¼æ—¥å¿—ï¼š

```yaml
logging:
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%X{traceId:-},%X{userId:-}] %logger{50} - %msg%n"
  file:
    name: /app/logs/Junmo Platform.log
```

#### 3. è®¿é—®æœåŠ¡

| æœåŠ¡ | åœ°å€ | ç”¨é€” |
|------|------|------|
| **Grafana** | http://localhost:3000 | ç»Ÿä¸€æŸ¥çœ‹æ—¥å¿—å’ŒæŒ‡æ ‡ |
| **Loki** | http://localhost:3100 | æ—¥å¿—å­˜å‚¨ API |
| **Kibana** | http://localhost:5601 | ä¸šåŠ¡æ–‡æ¡£æ£€ç´¢ |
| **Prometheus** | http://localhost:9090 | æŒ‡æ ‡ç›‘æ§ |

#### 4. åœ¨ Grafana ä¸­æŸ¥çœ‹æ—¥å¿—

1. ç™»å½• Grafana (admin/admin)
2. ç‚¹å‡»å·¦ä¾§ **Explore** å›¾æ ‡
3. é€‰æ‹© **Loki** æ•°æ®æº
4. è¾“å…¥æŸ¥è¯¢ï¼š`{job="Junmo Platform"}`
5. ç‚¹å‡» **Run query**

#### 5. åœ¨ Kibana ä¸­æ£€ç´¢æ–‡æ¡£

1. è®¿é—® Kibana (http://localhost:5601)
2. åˆ›å»ºç´¢å¼•æ¨¡å¼
3. åœ¨ Discover ä¸­æœç´¢ä¸šåŠ¡æ–‡æ¡£

### æ—¥å¿—æŸ¥è¯¢ç¤ºä¾‹

#### åœ¨ Grafana ä¸­æŸ¥è¯¢æ—¥å¿—ï¼ˆLokiï¼‰

```
# æŸ¥è¯¢æ‰€æœ‰åº”ç”¨æ—¥å¿—
{job="Junmo Platform"}

# æŸ¥è¯¢é”™è¯¯æ—¥å¿—
{job="Junmo Platform", level="error"}

# æŸ¥è¯¢ç‰¹å®šç”¨æˆ·æ—¥å¿—
{job="Junmo Platform", userId="123"}

# æŸ¥è¯¢ç‰¹å®š Trace ID æ—¥å¿—
{job="Junmo Platform", traceId="abc123"}

# ç»Ÿè®¡é”™è¯¯æ•°é‡
count_over_time({job="Junmo Platform", level="error"}[5m])
```

#### åœ¨ Kibana ä¸­æ£€ç´¢æ–‡æ¡£ï¼ˆElasticsearchï¼‰

```
// æœç´¢äº§å“ä¿¡æ¯
{
  "query": {
    "match": {
      "content": "Spring Boot"
    }
  }
}

// æœç´¢ç”¨æˆ·æ•°æ®
{
  "query": {
    "match": {
      "username": "admin"
    }
  }
}

// å…¨æ–‡æ£€ç´¢
{
  "query": {
    "multi_match": {
      "query": "è®¢å• æ”¯ä»˜ æˆåŠŸ",
      "fields": ["title", "content", "tags"]
    }
  }
}
```

## ğŸ”§ é…ç½®è¯´æ˜

### Loki é…ç½®

**é…ç½®æ–‡ä»¶**ï¼š`scripts/loki/loki-config.yml`

**å…³é”®é…ç½®**ï¼š
- `path_prefix`: Loki æ•°æ®å­˜å‚¨è·¯å¾„
- `storage.filesystem`: æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨
- `schema_config`: ç´¢å¼•é…ç½®
- `retention_period`: æ—¥å¿—ä¿ç•™æ—¶é—´

### Promtail é…ç½®

**é…ç½®æ–‡ä»¶**ï¼š`scripts/loki/promtail-config.yml`

**å…³é”®é…ç½®**ï¼š
- `clients.url`: Loki æœåŠ¡åœ°å€
- `scrape_configs`: é‡‡é›†é…ç½®
- `pipeline_stages`: æ—¥å¿—å¤„ç†ç®¡é“

### Elasticsearch é…ç½®

**é…ç½®æ–‡ä»¶**ï¼š`docker-compose.yml` ä¸­çš„ Elasticsearch æœåŠ¡é…ç½®

**å…³é”®é…ç½®**ï¼š
- `ES_JAVA_OPTS`: JVM å†…å­˜é…ç½®
- `discovery.type`: å•èŠ‚ç‚¹æ¨¡å¼
- `xpack.security.enabled`: å®‰å…¨é…ç½®

### Grafana é…ç½®

**æ•°æ®æºé…ç½®**ï¼š`scripts/grafana/provisioning/datasources/datasource.yml`

**å…³é”®é…ç½®**ï¼š
- Prometheus æ•°æ®æºï¼šç”¨äºæŒ‡æ ‡ç›‘æ§
- Loki æ•°æ®æºï¼šç”¨äºæ—¥å¿—æŸ¥è¯¢
- ä»ªè¡¨æ¿é…ç½®ï¼šè‡ªåŠ¨åŠ è½½

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### èµ„æºå ç”¨

| æ–¹æ¡ˆ | CPU | å†…å­˜ | ç£ç›˜ | å¯åŠ¨æ—¶é—´ |
|------|-----|------|------|---------|
| **ELK** | 4æ ¸+ | 8GB+ | 50GB+ | 5-10åˆ†é’Ÿ |
| **Loki** | 1-2æ ¸ | 1-2GB | 10GB | 1-2åˆ†é’Ÿ |
| **æ··åˆæ–¹æ¡ˆ** | 4-6æ ¸ | 10-12GB | 60GB | 5-10åˆ†é’Ÿ |

### æŸ¥è¯¢æ€§èƒ½

| æ–¹æ¡ˆ | ç®€å•æŸ¥è¯¢ | å¤æ‚æŸ¥è¯¢ | å…¨æ–‡æ£€ç´¢ |
|------|---------|---------|---------|
| **ELK** | å¿« | ä¸­ç­‰ | å¿« |
| **Loki** | å¿« | å¿« | æ…¢ |
| **æ··åˆæ–¹æ¡ˆ** | å¿« | å¿« | å¿«ï¼ˆä½¿ç”¨ ESï¼‰ |

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ç»“æ„åŒ–æ—¥å¿—

ä½¿ç”¨ JSON æ ¼å¼æ—¥å¿—ï¼Œä¾¿äºè§£æå’ŒæŸ¥è¯¢ï¼š

```java
@Slf4j
@RestController
public class UserController {
    
    @GetMapping("/users/{id}")
    public User getUser(@PathVariable Long id) {
        log.info("Getting user", 
            "userId", id, 
            "traceId", MDC.get("traceId"));
        // ...
    }
}
```

### 2. æ·»åŠ ä¸Šä¸‹æ–‡ä¿¡æ¯

åœ¨æ—¥å¿—ä¸­æ·»åŠ  Trace IDã€User ID ç­‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š

```java
MDC.put("traceId", traceId);
MDC.put("userId", userId);
```

### 3. åˆç†é…ç½®æ—¥å¿—çº§åˆ«

```yaml
logging:
  level:
    root: info
    com.junmo.Junmo Platform: debug
    org.springframework: warn
    org.hibernate: warn
```

### 4. é…ç½®æ—¥å¿—ä¿ç•™ç­–ç•¥

åœ¨ Loki é…ç½®ä¸­è®¾ç½®åˆç†çš„ä¿ç•™æ—¶é—´ï¼š

```yaml
retention_period: 168h  # 7å¤©
```

### 5. ä½¿ç”¨æ ‡ç­¾è¿‡æ»¤

åœ¨ Promtail ä¸­é…ç½®æ ‡ç­¾ï¼Œä¾¿äºæŸ¥è¯¢ï¼š

```yaml
labels:
  level:
  logger:
  service:
```

## ğŸ”„ è¿ç§»æ–¹æ¡ˆ

### ä» ELK è¿ç§»åˆ°æ··åˆæ–¹æ¡ˆ

1. **å®‰è£… Loki + Promtail**
2. **é…ç½®æ—¥å¿—é‡‡é›†**
3. **å¯¼å…¥ Grafana ä»ªè¡¨æ¿**
4. **é€æ­¥åˆ‡æ¢æ—¥å¿—æŸ¥è¯¢åˆ° Grafana**
5. **ä¿ç•™ Elasticsearch ç”¨äºä¸šåŠ¡æ–‡æ¡£æ£€ç´¢**

### ä»ä¼ ç»Ÿæ—¥å¿—è¿ç§»åˆ°æ··åˆæ–¹æ¡ˆ

1. **é…ç½®åº”ç”¨è¾“å‡ºæ—¥å¿—åˆ°æ–‡ä»¶**
2. **å®‰è£… Promtail é‡‡é›†æ–‡ä»¶æ—¥å¿—**
3. **é…ç½® Loki æ¥æ”¶æ—¥å¿—**
4. **åœ¨ Grafana ä¸­æŸ¥çœ‹æ—¥å¿—**
5. **åœ¨ Elasticsearch ä¸­å­˜å‚¨ä¸šåŠ¡æ–‡æ¡£**

## ğŸ“š ç›¸å…³èµ„æº

- [Loki å®˜æ–¹æ–‡æ¡£](https://grafana.com/docs/loki/latest/)
- [Promtail å®˜æ–¹æ–‡æ¡£](https://grafana.com/docs/loki/latest/clients/promtail/)
- [Grafana Loki æ’ä»¶](https://grafana.com/grafana/plugins/lokiexplore-app/)
- [Loki æŸ¥è¯¢è¯­è¨€](https://grafana.com/docs/loki/latest/logql/)
- [Elasticsearch å®˜æ–¹æ–‡æ¡£](https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html)
- [Kibana å®˜æ–¹æ–‡æ¡£](https://www.elastic.co/guide/en/kibana/current/index.html)

## ğŸ¯ æ€»ç»“

### æ¨èæ–¹æ¡ˆé€‰æ‹©

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | ç†ç”± |
|------|---------|------|
| **Spring Boot + Prometheus** | Loki | æŠ€æœ¯æ ˆç»Ÿä¸€ï¼Œè½»é‡é«˜æ•ˆ |
| **å¤§å‹ä¼ä¸šåº”ç”¨** | ELK | åŠŸèƒ½å¼ºå¤§ï¼Œç”Ÿæ€å®Œå–„ |
| **èµ„æºå—é™** | Loki | èµ„æºå ç”¨ä½ |
| **éœ€è¦å…¨æ–‡æ£€ç´¢** | Elasticsearch | æ£€ç´¢èƒ½åŠ›å¼º |
| **äº‘åŸç”Ÿç¯å¢ƒ** | Loki | ä¸“ä¸ºå®¹å™¨åŒ–è®¾è®¡ |
| **æ—¥å¿—+ä¸šåŠ¡æ–‡æ¡£** | æ··åˆæ–¹æ¡ˆ | åŠŸèƒ½äº’è¡¥ï¼Œå„å¸å…¶èŒ |

### Junmo Platform éƒ¨ç½²è¯´æ˜

**é…ç½®æ–‡ä»¶**ï¼š
- Docker Compose é…ç½®ï¼š`docker-compose.yml`
- Loki é…ç½®ï¼š`scripts/loki/loki-config.yml`
- Promtail é…ç½®ï¼š`scripts/loki/promtail-config.yml`

**éƒ¨ç½²å‘½ä»¤**ï¼š

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåŒ…æ‹¬ Loki å’Œ Elasticsearchï¼‰
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f app
```

**è®¿é—®åœ°å€**ï¼š
- Grafana: http://localhost:3000
- Loki: http://localhost:3100
- Kibana: http://localhost:5601

**ç³»ç»Ÿè¯´æ˜**ï¼š
- **Loki**ï¼šç”¨äºåº”ç”¨æ—¥å¿—é‡‡é›†å’ŒæŸ¥çœ‹
- **Elasticsearch**ï¼šç”¨äºä¸šåŠ¡æ–‡æ¡£æ£€ç´¢
- **ä¸¤è€…ä¸å†²çª**ï¼šå„å¸å…¶èŒï¼Œäº’ä¸å¹²æ‰°

**å¿«é€Ÿå¯åŠ¨**ï¼š
```bash
cd F:\codes\roadmap\github-project\springboot-study\Junmo Platform
docker-compose up -d
```

**é¦–æ¬¡å¯åŠ¨**ï¼šéœ€è¦ä¸‹è½½é•œåƒï¼Œå¤§çº¦éœ€è¦ 5-10 åˆ†é’Ÿã€‚