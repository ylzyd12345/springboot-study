# 安全配置
spring:
  security:
    # CSRF配置
    csrf:
      enabled: true
      token-repository: cookie
      cookie-name: XSRF-TOKEN
      header-name: X-XSRF-TOKEN
      cookie-http-only: false
      cookie-secure: true
      cookie-same-site: strict
      cookie-path: /
      cookie-max-age: 3600
    # 防火墙配置
    filter:
      order: 0
      dispatcher-types:
        - async
        - error
        - request
    # 授权配置
    authorization:
      permit-all:
        - /actuator/**
        - /graphql/**
        - /graphiql/**
        - /swagger-ui/**
        - /api-docs/**
        - /v3/api-docs/**
        - /doc.html
        - /api/auth/**
        - /api/public/**
    # 会话管理
    session:
      maximum-sessions: 1
      max-sessions-prevents-login: false
      session-fixation-protection: migrateSession
      expired-url: /login?expired
      invalid-session-url: /login?invalid
    # 密码编码
    password:
      encoder: bcrypt
      strength: 10

# 安全过滤器配置
security:
  # SQL注入防护
  sql-injection:
    enabled: true
    patterns:
      - "(?i)(\\b(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|TRUNCATE|UNION|EXEC|EXECUTE|SP_EXECUTESQL|DECLARE|CAST|CONVERT|SCRIPT|JAVASCRIPT|VBSCRIPT|ONLOAD|ONERROR|ONCLICK|ONMOUSEOVER|ONKEYDOWN|ONFOCUS|ONBLUR|ONCHANGE|ONSUBMIT|ONRESET)\\b)"
      - "(?i)(\\b(OR|AND|XOR|NOT|LIKE|BETWEEN|IN|IS|NULL|TRUE|FALSE|EXISTS|DISTINCT|ALL|ANY|SOME|GROUP BY|ORDER BY|HAVING|LIMIT|OFFSET|UNION ALL|UNION DISTINCT|INNER JOIN|LEFT JOIN|RIGHT JOIN|FULL JOIN|CROSS JOIN|NATURAL JOIN|JOIN|ON|WHERE|CASE|WHEN|THEN|ELSE|END|IF|ELSEIF|WHILE|LOOP|BEGIN|END|TRY|CATCH|THROW|RAISEERROR|PRINT|RETURN|GOTO|WAITFOR|DELAY|KILL|SHUTDOWN|RESTART|BACKUP|RESTORE|GRANT|REVOKE|DENY|COMMIT|ROLLBACK|SAVEPOINT|TRANSACTION|LOCK|UNLOCK|SET|IDENTITY_INSERT|IDENTITY|IDENTITY_COL|IDENTITY_SEED)\\b)"
      - "(?i)(\\b(CHAR|VARCHAR|NVARCHAR|NCHAR|TEXT|NTEXT|XML|JSON|BINARY|VARBINARY|IMAGE|DATETIME|DATE|TIME|TIMESTAMP|SMALLDATETIME|DECIMAL|NUMERIC|FLOAT|REAL|MONEY|SMALLMONEY|TINYINT|SMALLINT|INT|BIGINT|BIT|UNIQUEIDENTIFIER|GUID|CURSOR|TABLE|VIEW|PROCEDURE|FUNCTION|TRIGGER|INDEX|CONSTRAINT|PRIMARY KEY|FOREIGN KEY|UNIQUE KEY|CHECK|DEFAULT|IDENTITY|AUTO_INCREMENT|SERIAL|BIGSERIAL|SMALLSERIAL|ENUM|SET|GEOMETRY|GEOGRAPHY|POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|COLLECTION|ROW|COLUMN|DATABASE|SCHEMA|USER|ROLE|PERMISSION|GRANT|REVOKE|DENY|OWNER|CREATED|UPDATED|DELETED|VERSION|STATUS|TYPE|NAME|DESCRIPTION|VALUE|CODE|MESSAGE|ERROR|SUCCESS|FAILURE|TRUE|FALSE|NULL|NOT NULL|DEFAULT|AUTO_INCREMENT|PRIMARY KEY|FOREIGN KEY|UNIQUE|INDEX|CHECK|CONSTRAINT|CASCADE|RESTRICT|SET NULL|NO ACTION)\\b)"
    # 白名单路径（不进行SQL注入检查）
    whitelist:
      - /actuator/**
      - /graphql/**
      - /api/auth/**

  # XSS防护
  xss:
    enabled: true
    patterns:
      - "(?i)<(script|iframe|object|embed|form|input|textarea|button|link|meta|style|img|video|audio|canvas|svg|math|div|span|a|p|table|tr|td|th|ul|ol|li|h[1-6]|b|i|u|s|strike|tt|code|pre|blockquote|cite|abbr|acronym|address|bdo|bdi|del|ins|q|dfn|kbd|samp|var|strong|em|mark|small|big|sub|sup|time|data|wbr|br|hr|col|colgroup|section|article|aside|header|footer|nav|main|figure|figcaption|details|summary|dialog|menu|menuitem|command|datalist|keygen|output|progress|meter|fieldset|legend|label|datalist|option|optgroup|select|textarea|button|form|input|object|param|embed|video|audio|source|track|canvas|map|area|base|link|meta|style|script|noscript|template|slot|shadow|content|picture|source|iframe|frame|frameset|noframes|applet|marquee|blink|font|basefont|center|dir|listing|plaintext|xmp|listing|menu|dir|multicol|nextid|server|client|ilayer|layer|nolayer|xml|namespace|import|implement|declare|element|attribute|interface|include|exclude|annotation|processing-instruction|entity|notation|attribute|cdata|comment|text|pcdata|any|mixed|empty)\\s*.*?>"
      - "(?i)javascript:"
      - "(?i)vbscript:"
      - "(?i)on\\w+\\s*="
      - "(?i)expression\\("
      - "(?i)eval\\("
      - "(?i)alert\\("
      - "(?i)confirm\\("
      - "(?i)prompt\\("
      - "(?i)document\\.cookie"
      - "(?i)window\\.location"
      - "(?i)document\\.write"
      - "(?i)document\\.getElementById"
      - "(?i)document\\.createElement"
      - "(?i)document\\.appendChild"
      - "(?i)innerHTML"
      - "(?i)outerHTML"
      - "(?i)insertAdjacentHTML"
      - "(?i)insertAdjacentText"
      - "(?i)createContextualFragment"
      - "(?i)Range\\.createContextualFragment"
      - "(?i)DOMParser\\.parseFromString"
      - "(?i)XMLHttpRequest"
      - "(?i)fetch"
      - "(?i)WebSocket"
      - "(?i)EventSource"
      - "(?i)FormData"
      - "(?i)File"
      - "(?i)Blob"
      - "(?i)URL"
      - "(?i)URLSearchParams"
      - "(?i)atob"
      - "(?i)btoa"
      - "(?i)escape"
      - "(?i)unescape"
      - "(?i)encodeURI"
      - "(?i)decodeURI"
      - "(?i)encodeURIComponent"
      - "(?i)decodeURIComponent"
      - "(?i)setTimeout"
      - "(?i)setInterval"
      - "(?i)requestAnimationFrame"
      - "(?i)cancelAnimationFrame"
      - "(?i)requestIdleCallback"
      - "(?i)cancelIdleCallback"
      - "(?i)Promise"
      - "(?i)async"
      - "(?i)await"
      - "(?i)import"
      - "(?i)export"
      - "(?i)from"
      - "(?i)as"
      - "(?i)class"
      - "(?i)extends"
      - "(?i)super"
      - "(?i)this"
      - "(?i)new"
      - "(?i)typeof"
      - "(?i)instanceof"
      - "(?i)in"
      - "(?i)of"
      - "(?i)delete"
      - "(?i)void"
      - "(?i)return"
      - "(?i)throw"
      - "(?i)try"
      - "(?i)catch"
      - "(?i)finally"
      - "(?i)switch"
      - "(?i)case"
      - "(?i)break"
      - "(?i)continue"
      - "(?i)do"
      - "(?i)while"
      - "(?i)for"
      - "(?i)if"
      - "(?i)else"
      - "(?i)with"
      - "(?i)debugger"
      - "(?i)yield"
      - "(?i)let"
      - "(?i)const"
      - "(?i)var"
      - "(?i)function"
      - "(?i)=>"
    # 白名单路径（不进行XSS检查）
    whitelist:
      - /actuator/**
      - /api/auth/**

  # CSRF防护
  csrf:
    enabled: true
    # 忽略CSRF检查的路径
    ignore-paths:
      - /graphql/**
      - /api/auth/**
      - /api/public/**
      - /actuator/**