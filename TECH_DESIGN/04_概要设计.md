# Spring4demo æ¦‚è¦è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡æ¡£åç§°** | Spring4demo æ¦‚è¦è®¾è®¡ |
| **ç‰ˆæœ¬å·** | v1.0.0 |
| **åˆ›å»ºæ—¥æœŸ** | 2025-12-24 |
| **ä½œè€…** | ç³»ç»Ÿæ¶æ„å¸ˆ |
| **å®¡æ ¸äºº** | æŠ€æœ¯æ¶æ„å¸ˆ |
| **æ‰¹å‡†äºº** | æŠ€æœ¯æ€»ç›‘ |

## ğŸ¯ è®¾è®¡æ¦‚è¿°

### ç³»ç»Ÿç›®æ ‡
Spring4demo ä¼ä¸šçº§æ™ºèƒ½ç®¡ç†å¹³å°æ˜¯ä¸€ä¸ªåŸºäº Spring Boot 4.0.1 çš„ç»¼åˆæ€§ä¼ä¸šç®¡ç†ç³»ç»Ÿï¼Œæ—¨åœ¨æä¾›å®Œæ•´çš„æ•°å­—åŒ–ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œæ”¯æŒé«˜å¹¶å‘ã€é«˜å¯ç”¨ã€é«˜æ‰©å±•æ€§ã€‚

### è®¾è®¡åŸåˆ™
1. **åˆ†å±‚æ¶æ„**: æ¸…æ™°çš„åˆ†å±‚ç»“æ„ï¼ŒèŒè´£åˆ†ç¦»
2. **æ¨¡å—åŒ–è®¾è®¡**: é«˜å†…èšä½è€¦åˆçš„æ¨¡å—åŒ–æ¶æ„
3. **é¢†åŸŸé©±åŠ¨**: ä»¥ä¸šåŠ¡é¢†åŸŸä¸ºæ ¸å¿ƒçš„è®¾è®¡æ€æƒ³
4. **å¾®æœåŠ¡å°±ç»ª**: æ”¯æŒå‘å¾®æœåŠ¡æ¶æ„æ¼”è¿›

### æŠ€æœ¯æ ˆé€‰æ‹©
- **åç«¯æ¡†æ¶**: Spring Boot 4.0.1 + Spring Framework 6.x
- **æ•°æ®åº“**: MySQL 8.0 + MongoDB 6.0 + Redis 7.0
- **æ¶ˆæ¯é˜Ÿåˆ—**: RabbitMQ 3.12 + Apache Kafka
- **æœç´¢å¼•æ“**: Elasticsearch 8.0
- **å®¹å™¨åŒ–**: Docker + Docker Compose

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "ç”¨æˆ·å±‚"
        A1[Webç®¡ç†åå°] --> A2[Vue.js + Element UI]
        A3[ç§»åŠ¨ç«¯åº”ç”¨] --> A4[React Native]
        A5[å¼€æ”¾API] --> A6[RESTful API]
    end
    
    subgraph "æ¥å…¥å±‚"
        B1[è´Ÿè½½å‡è¡¡] --> B2[Nginx/HAProxy]
        B3[APIç½‘å…³] --> B4[Spring Cloud Gateway]
        B5[é™æµç†”æ–­] --> B6[Sentinel]
    end
    
    subgraph "åº”ç”¨å±‚"
        C1[Web MVC] --> C2[Spring MVC]
        C3[WebFlux] --> C4[Spring WebFlux]
        C5[WebSocket] --> C6[Spring WebSocket]
        C7[GraphQL] --> C8[Spring GraphQL]
    end
    
    subgraph "ä¸šåŠ¡å±‚"
        D1[åº”ç”¨æœåŠ¡] --> D2[Application Services]
        D3[é¢†åŸŸæœåŠ¡] --> D4[Domain Services]
        D5[äº‹ä»¶å¤„ç†] --> D6[Event Handlers]
    end
    
    subgraph "é¢†åŸŸå±‚"
        E1[ç”¨æˆ·æƒé™åŸŸ] --> E2[User/Role/Permission]
        E3[å†…å®¹ç®¡ç†åŸŸ] --> E4[Document/Category/Tag]
        E5[å·¥ä½œæµåŸŸ] --> E6[Process/Task/Definition]
    end
    
    subgraph "åŸºç¡€è®¾æ–½å±‚"
        F1[æ•°æ®è®¿é—®] --> F2[Spring Data JPA]
        F3[æ¶ˆæ¯ä¸­é—´ä»¶] --> F4[RabbitMQ/Kafka]
        F5[ç¼“å­˜æœåŠ¡] --> F6[Redis]
        F7[æœç´¢å¼•æ“] --> F8[Elasticsearch]
    end
    
    subgraph "æ•°æ®å±‚"
        G1[MySQLé›†ç¾¤] --> G2[ä¸»ä»å¤åˆ¶]
        G3[MongoDBé›†ç¾¤] --> G4[å‰¯æœ¬é›†]
        G5[Redisé›†ç¾¤] --> G6[å“¨å…µæ¨¡å¼]
        G7[Elasticsearch] --> G8[é›†ç¾¤æ¨¡å¼]
    end
    
    A1 --> B1
    A3 --> B1
    A5 --> B1
    B1 --> C1
    C1 --> D1
    D1 --> E1
    E1 --> F1
    F1 --> G1
```

### æ ¸å¿ƒæ¨¡å—è®¾è®¡

#### 1. ç”¨æˆ·æƒé™ç®¡ç†æ¨¡å—

**åŠŸèƒ½æ¦‚è¿°**
æä¾›å®Œæ•´çš„ç”¨æˆ·èº«ä»½è®¤è¯å’Œæƒé™ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§Ÿæˆ·ã€è§’è‰²æƒé™ã€ç»„ç»‡æ¶æ„ç®¡ç†ã€‚

**æ ¸å¿ƒåŠŸèƒ½**
- ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯ç®¡ç†
- è§’è‰²æƒé™ç®¡ç†ã€RBACæ¨¡å‹
- ç»„ç»‡æ¶æ„ç®¡ç†ã€å±‚çº§ç»“æ„
- å•ç‚¹ç™»å½•ã€OAuth2é›†æˆ
- å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»

**æŠ€æœ¯å®ç°**
- Spring Security + JWTè®¤è¯
- Spring Data JPAæ•°æ®è®¿é—®
- Redisç¼“å­˜ç”¨æˆ·ä¼šè¯
- WebSocketå®æ—¶æƒé™æ›´æ–°

#### 2. å†…å®¹ç®¡ç†æ¨¡å—

**åŠŸèƒ½æ¦‚è¿°**
æä¾›ä¼ä¸šçº§å†…å®¹ç®¡ç†èƒ½åŠ›ï¼Œæ”¯æŒæ–‡æ¡£ç®¡ç†ã€çŸ¥è¯†åº“ã€å†…å®¹å®¡æ ¸ç­‰åŠŸèƒ½ã€‚

**æ ¸å¿ƒåŠŸèƒ½**
- æ–‡æ¡£ä¸Šä¼ ã€ç¼–è¾‘ã€ç‰ˆæœ¬æ§åˆ¶
- åˆ†ç±»ç®¡ç†ã€æ ‡ç­¾ç³»ç»Ÿ
- å…¨æ–‡æœç´¢ã€å†…å®¹æ¨è
- å·¥ä½œæµå®¡æ ¸ã€å†…å®¹åˆè§„
- å¤šåª’ä½“æ–‡ä»¶å¤„ç†

**æŠ€æœ¯å®ç°**
- Spring Contentæ–‡ä»¶ç®¡ç†
- Elasticsearchå…¨æ–‡æœç´¢
- MongoDBå­˜å‚¨éç»“æ„åŒ–æ•°æ®
- Activitiå·¥ä½œæµå¼•æ“

#### 3. å·¥ä½œæµå¼•æ“æ¨¡å—

**åŠŸèƒ½æ¦‚è¿°**
æä¾›çµæ´»çš„ä¸šåŠ¡æµç¨‹ç®¡ç†èƒ½åŠ›ï¼Œæ”¯æŒå¯è§†åŒ–æµç¨‹è®¾è®¡ã€ä»»åŠ¡ç®¡ç†ã€å®¡æ‰¹æµè½¬ã€‚

**æ ¸å¿ƒåŠŸèƒ½**
- å¯è§†åŒ–æµç¨‹è®¾è®¡å™¨
- ä»»åŠ¡åˆ†é…ã€çŠ¶æ€è·Ÿè¸ª
- å¤šçº§å®¡æ‰¹ã€å¹¶è¡Œå®¡æ‰¹
- æµç¨‹ç›‘æ§ã€æ€§èƒ½åˆ†æ
- æµç¨‹æ¨¡æ¿ç®¡ç†

**æŠ€æœ¯å®ç°**
- Activitiå·¥ä½œæµå¼•æ“
- Spring Integrationä¼ä¸šé›†æˆ
- RabbitMQå¼‚æ­¥ä»»åŠ¡å¤„ç†
- Redisä»»åŠ¡çŠ¶æ€ç¼“å­˜

#### 4. æ•°æ®åˆ†ææ¨¡å—

**åŠŸèƒ½æ¦‚è¿°**
æä¾›å¼ºå¤§çš„æ•°æ®åˆ†æå’Œå¯è§†åŒ–èƒ½åŠ›ï¼Œæ”¯æŒæŠ¥è¡¨ç»Ÿè®¡ã€å®æ—¶ç›‘æ§ã€æ™ºèƒ½åˆ†æã€‚

**æ ¸å¿ƒåŠŸèƒ½**
- å¤šç»´åº¦ç»Ÿè®¡æŠ¥è¡¨
- å®æ—¶æ•°æ®å¯è§†åŒ–
- è‡ªå®šä¹‰ä»ªè¡¨æ¿
- æ•°æ®é¢„æµ‹åˆ†æ
- å¯¼å‡ºåŠŸèƒ½

**æŠ€æœ¯å®ç°**
- Spring Boot Actuatorç›‘æ§
- MicrometeræŒ‡æ ‡æ”¶é›†
- Prometheus + Grafana
- InfluxDBæ—¶åºæ•°æ®

#### 5. æ¶ˆæ¯é€šçŸ¥æ¨¡å—

**åŠŸèƒ½æ¦‚è¿°**
æä¾›ç»Ÿä¸€çš„æ¶ˆæ¯é€šçŸ¥èƒ½åŠ›ï¼Œæ”¯æŒå®æ—¶é€šçŸ¥ã€é‚®ä»¶æœåŠ¡ã€çŸ­ä¿¡æ¨é€ã€‚

**æ ¸å¿ƒåŠŸèƒ½**
- å®æ—¶æ¶ˆæ¯æ¨é€
- é‚®ä»¶æ¨¡æ¿ç®¡ç†
- çŸ­ä¿¡éªŒè¯ç 
- æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†
- é€šçŸ¥å†å²ç®¡ç†

**æŠ€æœ¯å®ç°**
- Spring WebSocketå®æ—¶é€šä¿¡
- Spring Boot Mailé‚®ä»¶æœåŠ¡
- RabbitMQæ¶ˆæ¯é˜Ÿåˆ—
- Redisæ¶ˆæ¯ç¼“å­˜

#### 6. æ–‡ä»¶ç®¡ç†æ¨¡å—

**åŠŸèƒ½æ¦‚è¿°**
æä¾›ä¼ä¸šçº§æ–‡ä»¶ç®¡ç†èƒ½åŠ›ï¼Œæ”¯æŒåˆ†å¸ƒå¼å­˜å‚¨ã€ç‰ˆæœ¬æ§åˆ¶ã€æƒé™ç®¡ç†ã€‚

**æ ¸å¿ƒåŠŸèƒ½**
- æ–‡æ¡£å­˜å‚¨ã€ç‰ˆæœ¬æ§åˆ¶
- å›¾ç‰‡å¤„ç†ã€æ ¼å¼è½¬æ¢
- æƒé™æ§åˆ¶ã€ä¸‹è½½é™åˆ¶
- åœ¨çº¿é¢„è§ˆã€ç¼©ç•¥å›¾
- å­˜å‚¨ç©ºé—´ç®¡ç†

**æŠ€æœ¯å®ç°**
- Spring Contentæ–‡ä»¶ç®¡ç†
- MinIOåˆ†å¸ƒå¼å¯¹è±¡å­˜å‚¨
- ImageIOå›¾ç‰‡å¤„ç†
- MongoDBæ–‡ä»¶å…ƒæ•°æ®

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### æ•°æ®åº“æ¶æ„

#### 1. å…³ç³»å‹æ•°æ®åº“è®¾è®¡ (MySQL)

**ç”¨æˆ·æƒé™è¡¨è®¾è®¡**
```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    status ENUM('ACTIVE', 'INACTIVE', 'LOCKED') DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by BIGINT,
    updated_by BIGINT,
    INDEX idx_username (username),
    INDEX idx_email (email),
    INDEX idx_status (status)
);

-- è§’è‰²è¡¨
CREATE TABLE roles (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL,
    description VARCHAR(255),
    status ENUM('ACTIVE', 'INACTIVE') DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_name (name),
    INDEX idx_status (status)
);

-- æƒé™è¡¨
CREATE TABLE permissions (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    resource VARCHAR(100) NOT NULL,
    action VARCHAR(50) NOT NULL,
    description VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_resource (resource),
    INDEX idx_action (action)
);

-- ç”¨æˆ·è§’è‰²å…³è”è¡¨
CREATE TABLE user_roles (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    role_id BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_role (user_id, role_id)
);

-- è§’è‰²æƒé™å…³è”è¡¨
CREATE TABLE role_permissions (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    role_id BIGINT NOT NULL,
    permission_id BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE,
    UNIQUE KEY uk_role_permission (role_id, permission_id)
);
```

**å†…å®¹ç®¡ç†è¡¨è®¾è®¡**
```sql
-- æ–‡æ¡£è¡¨
CREATE TABLE documents (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    content LONGTEXT,
    category_id BIGINT,
    author_id BIGINT NOT NULL,
    status ENUM('DRAFT', 'PUBLISHED', 'ARCHIVED') DEFAULT 'DRAFT',
    version INT DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    published_at TIMESTAMP NULL,
    FOREIGN KEY (category_id) REFERENCES categories(id),
    FOREIGN KEY (author_id) REFERENCES users(id),
    INDEX idx_title (title),
    INDEX idx_category_id (category_id),
    INDEX idx_author_id (author_id),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
);

-- åˆ†ç±»è¡¨
CREATE TABLE categories (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    parent_id BIGINT,
    description TEXT,
    sort_order INT DEFAULT 0,
    status ENUM('ACTIVE', 'INACTIVE') DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES categories(id),
    INDEX idx_parent_id (parent_id),
    INDEX idx_name (name),
    INDEX idx_status (status)
);

-- æ ‡ç­¾è¡¨
CREATE TABLE tags (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL,
    color VARCHAR(7) DEFAULT '#1890ff',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_name (name)
);

-- æ–‡æ¡£æ ‡ç­¾å…³è”è¡¨
CREATE TABLE document_tags (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    document_id BIGINT NOT NULL,
    tag_id BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (document_id) REFERENCES documents(id) ON DELETE CASCADE,
    FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE,
    UNIQUE KEY uk_document_tag (document_id, tag_id)
);
```

#### 2. æ–‡æ¡£æ•°æ®åº“è®¾è®¡ (MongoDB)

**å·¥ä½œæµæ•°æ®è®¾è®¡**
```javascript
// æµç¨‹å®šä¹‰é›†åˆ
db.process_definitions.insertOne({
    _id: ObjectId(),
    name: "è¯·å‡å®¡æ‰¹æµç¨‹",
    key: "leave_approval",
    version: 1,
    description: "å‘˜å·¥è¯·å‡å®¡æ‰¹æµç¨‹",
    bpmnXml: "...", // BPMN XMLå†…å®¹
    status: "ACTIVE",
    createdBy: ObjectId("user_id"),
    createdAt: new Date(),
    updatedAt: new Date()
});

// æµç¨‹å®ä¾‹é›†åˆ
db.process_instances.insertOne({
    _id: ObjectId(),
    processDefinitionId: ObjectId("process_def_id"),
    processDefinitionKey: "leave_approval",
    businessKey: "leave_20231201_001",
    status: "RUNNING",
    startTime: new Date(),
    endTime: null,
    startedBy: ObjectId("user_id"),
    variables: {
        applicant: "å¼ ä¸‰",
        leaveDays: 3,
        reason: "å®¶ä¸­æœ‰äº‹"
    },
    tasks: [
        {
            id: ObjectId(),
            name: "éƒ¨é—¨ç»ç†å®¡æ‰¹",
            assignee: ObjectId("manager_id"),
            status: "PENDING",
            createTime: new Date(),
            dueTime: new Date(Date.now() + 24*60*60*1000)
        }
    ]
});

// ä»»åŠ¡å®ä¾‹é›†åˆ
db.task_instances.insertOne({
    _id: ObjectId(),
    processInstanceId: ObjectId("process_instance_id"),
    name: "éƒ¨é—¨ç»ç†å®¡æ‰¹",
    description: "è¯·å®¡æ‰¹å‘˜å·¥è¯·å‡ç”³è¯·",
    assignee: ObjectId("manager_id"),
    status: "PENDING",
    priority: 50,
    createTime: new Date(),
    dueTime: new Date(Date.now() + 24*60*60*1000),
    completionTime: null,
    variables: {
        approvalResult: null,
        comments: null
    }
});
```

#### 3. ç¼“å­˜è®¾è®¡ (Redis)

**ç¼“å­˜ç­–ç•¥è®¾è®¡**
```yaml
# ç¼“å­˜é…ç½®
cache:
  users:
    prefix: "user:"
    ttl: 3600  # 1å°æ—¶
    strategy: "WRITE_THROUGH"
  
  permissions:
    prefix: "permission:"
    ttl: 1800  # 30åˆ†é’Ÿ
    strategy: "WRITE_BEHIND"
  
  documents:
    prefix: "document:"
    ttl: 7200  # 2å°æ—¶
    strategy: "CACHE_ASIDE"
  
  sessions:
    prefix: "session:"
    ttl: 1800  # 30åˆ†é’Ÿ
    strategy: "WRITE_THROUGH"
```

## ğŸ” å®‰å…¨è®¾è®¡

### å®‰å…¨æ¶æ„

#### 1. è®¤è¯è®¾è®¡

**JWTè®¤è¯æµç¨‹**
```mermaid
sequenceDiagram
    participant C as å®¢æˆ·ç«¯
    participant G as ç½‘å…³
    participant A as è®¤è¯æœåŠ¡
    participant R as Redis
    participant D as æ•°æ®åº“
    
    C->>G: ç™»å½•è¯·æ±‚
    G->>A: è½¬å‘è®¤è¯è¯·æ±‚
    A->>D: éªŒè¯ç”¨æˆ·å‡­æ®
    D-->>A: è¿”å›ç”¨æˆ·ä¿¡æ¯
    A->>R: å­˜å‚¨ç”¨æˆ·ä¼šè¯
    A->>A: ç”ŸæˆJWT Token
    A-->>G: è¿”å›Token
    G-->>C: è¿”å›è®¤è¯ç»“æœ
    
    C->>G: æºå¸¦Tokençš„è¯·æ±‚
    G->>G: éªŒè¯Token
    G->>R: æ£€æŸ¥ä¼šè¯çŠ¶æ€
    R-->>G: è¿”å›ä¼šè¯ä¿¡æ¯
    G-->>C: è¿”å›è¯·æ±‚ç»“æœ
```

**è®¤è¯é…ç½®**
```java
@Configuration
@EnableWebSecurity
@EnableMethodSecurity(prePostEnabled = true)
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .csrf(csrf -> csrf.disable())
            .sessionManagement(session -> 
                session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
            .authorizeHttpRequests(authz -> authz
                .requestMatchers("/api/auth/**").permitAll()
                .requestMatchers("/api/public/**").permitAll()
                .requestMatchers(HttpMethod.GET, "/api/users/**").hasRole("USER")
                .requestMatchers(HttpMethod.POST, "/api/users/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            )
            .addFilterBefore(jwtAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);
        
        return http.build();
    }
    
    @Bean
    public JwtAuthenticationFilter jwtAuthenticationFilter() {
        return new JwtAuthenticationFilter();
    }
    
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
```

#### 2. æˆæƒè®¾è®¡

**RBACæƒé™æ¨¡å‹**
```mermaid
erDiagram
    User ||--o{ UserRole : has
    Role ||--o{ UserRole : assigned
    Role ||--o{ RolePermission : has
    Permission ||--o{ RolePermission : granted
    
    User {
        bigint id PK
        string username
        string email
        string password
        enum status
    }
    
    Role {
        bigint id PK
        string name
        string description
        enum status
    }
    
    Permission {
        bigint id PK
        string name
        string resource
        string action
        string description
    }
    
    UserRole {
        bigint userId FK
        bigint roleId FK
        datetime createdAt
    }
    
    RolePermission {
        bigint roleId FK
        bigint permissionId FK
        datetime createdAt
    }
```

#### 3. æ•°æ®å®‰å…¨

**æ•°æ®åŠ å¯†ç­–ç•¥**
- **ä¼ è¾“åŠ å¯†**: HTTPS/TLS 1.3
- **å­˜å‚¨åŠ å¯†**: AES-256æ•°æ®åº“åŠ å¯†
- **æ•æ„Ÿæ•°æ®**: å­—æ®µçº§åŠ å¯†å­˜å‚¨
- **å¯†é’¥ç®¡ç†**: å¤–éƒ¨å¯†é’¥ç®¡ç†æœåŠ¡

## ğŸš€ æ€§èƒ½è®¾è®¡

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 1. ç¼“å­˜ç­–ç•¥

**å¤šçº§ç¼“å­˜æ¶æ„**
```mermaid
graph TB
    A[åº”ç”¨å±‚] --> B[æœ¬åœ°ç¼“å­˜ Caffeine]
    B --> C[åˆ†å¸ƒå¼ç¼“å­˜ Redis]
    C --> D[æ•°æ®åº“ MySQL]
    
    E[CDNç¼“å­˜] --> F[é™æ€èµ„æº]
    E --> G[APIå“åº”]
    
    H[æœç´¢å¼•æ“] --> I[Elasticsearch]
    H --> J[å…¨æ–‡æœç´¢]
```

**ç¼“å­˜é…ç½®**
```java
@Configuration
@EnableCaching
public class CacheConfig {
    
    @Bean
    public CacheManager cacheManager() {
        CaffeineCacheManager caffeineManager = new CaffeineCacheManager();
        caffeineManager.setCaffeine(Caffeine.newBuilder()
            .maximumSize(1000)
            .expireAfterWrite(Duration.ofMinutes(10))
            .recordStats());
        
        RedisCacheManager redisManager = RedisCacheManager
            .builder(redisConnectionFactory())
            .cacheDefaults(redisCacheConfiguration())
            .build();
        
        return new CompositeCacheManager(caffeineManager, redisManager);
    }
    
    private RedisCacheConfiguration redisCacheConfiguration() {
        return RedisCacheConfiguration.defaultCacheConfig()
            .entryTtl(Duration.ofMinutes(30))
            .serializeKeysWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new StringRedisSerializer()))
            .serializeValuesWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new GenericJackson2JsonRedisSerializer()));
    }
}
```

#### 2. æ•°æ®åº“ä¼˜åŒ–

**è¿æ¥æ± é…ç½®**
```yaml
spring:
  datasource:
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      idle-timeout: 300000
      max-lifetime: 1200000
      connection-timeout: 20000
      leak-detection-threshold: 60000
      
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.MySQL8Dialect
        jdbc:
          batch_size: 20
        order_inserts: true
        order_updates: true
```

**ç´¢å¼•ä¼˜åŒ–ç­–ç•¥**
```sql
-- ç”¨æˆ·è¡¨ç´¢å¼•
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_status ON users(status);
CREATE INDEX idx_users_created_at ON users(created_at);

-- æ–‡æ¡£è¡¨ç´¢å¼•
CREATE INDEX idx_documents_title ON documents(title);
CREATE INDEX idx_documents_category_id ON documents(category_id);
CREATE INDEX idx_documents_author_id ON documents(author_id);
CREATE INDEX idx_documents_status ON documents(status);
CREATE INDEX idx_documents_created_at ON documents(created_at);

-- å¤åˆç´¢å¼•
CREATE INDEX idx_documents_category_status ON documents(category_id, status);
CREATE INDEX idx_documents_author_status ON documents(author_id, status);
```

#### 3. å¼‚æ­¥å¤„ç†

**å¼‚æ­¥ä»»åŠ¡é…ç½®**
```java
@Configuration
@EnableAsync
public class AsyncConfig {
    
    @Bean(name = "taskExecutor")
    public Executor taskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(10);
        executor.setMaxPoolSize(20);
        executor.setQueueCapacity(200);
        executor.setThreadNamePrefix("Async-");
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
        executor.initialize();
        return executor;
    }
    
    @Bean(name = "emailExecutor")
    public Executor emailExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);
        executor.setMaxPoolSize(10);
        executor.setQueueCapacity(100);
        executor.setThreadNamePrefix("Email-");
        executor.initialize();
        return executor;
    }
}

@Service
public class NotificationService {
    
    @Async("emailExecutor")
    public CompletableFuture<Void> sendEmail(String to, String subject, String content) {
        // å¼‚æ­¥å‘é€é‚®ä»¶
        emailService.send(to, subject, content);
        return CompletableFuture.completedFuture(null);
    }
    
    @Async("taskExecutor")
    public CompletableFuture<Void> processDocument(Long documentId) {
        // å¼‚æ­¥å¤„ç†æ–‡æ¡£
        documentProcessor.process(documentId);
        return CompletableFuture.completedFuture(null);
    }
}
```

## ğŸ“ˆ ç›‘æ§è®¾è®¡

### ç›‘æ§ä½“ç³»

#### 1. åº”ç”¨ç›‘æ§

**Actuatorç«¯ç‚¹é…ç½®**
```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,loggers,threaddump,heapdump
  endpoint:
    health:
      show-details: always
      show-components: always
    metrics:
      enabled: true
    prometheus:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    distribution:
      percentiles-histogram:
        http.server.requests: true
      percentiles:
        http.server.requests: 0.5,0.9,0.95,0.99
```

#### 2. ä¸šåŠ¡ç›‘æ§

**è‡ªå®šä¹‰æŒ‡æ ‡**
```java
@Component
public class BusinessMetrics {
    
    private final Counter userRegistrationCounter;
    private final Timer documentProcessingTimer;
    private final Gauge activeUsersGauge;
    
    public BusinessMetrics(MeterRegistry meterRegistry) {
        this.userRegistrationCounter = Counter.builder("user.registrations")
            .description("Number of user registrations")
            .register(meterRegistry);
        
        this.documentProcessingTimer = Timer.builder("document.processing.time")
            .description("Time taken to process documents")
            .register(meterRegistry);
        
        this.activeUsersGauge = Gauge.builder("users.active")
            .description("Number of active users")
            .register(meterRegistry, this, BusinessMetrics::getActiveUserCount);
    }
    
    public void incrementUserRegistration() {
        userRegistrationCounter.increment();
    }
    
    public Timer.Sample startDocumentProcessing() {
        return Timer.start();
    }
    
    public void recordDocumentProcessingTime(Timer.Sample sample) {
        sample.stop(documentProcessingTimer);
    }
    
    private double getActiveUserCount() {
        // å®ç°è·å–æ´»è·ƒç”¨æˆ·æ•°çš„é€»è¾‘
        return userService.getActiveUserCount();
    }
}
```

#### 3. æ—¥å¿—ç›‘æ§

**æ—¥å¿—é…ç½®**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <springProfile name="!prod">
        <include resource="org/springframework/boot/logging/logback/defaults.xml"/>
        <include resource="org/springframework/boot/logging/logback/console-appender.xml"/>
        <root level="INFO">
            <appender-ref ref="CONSOLE"/>
        </root>
    </springProfile>
    
    <springProfile name="prod">
        <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
            <file>logs/spring4demo.log</file>
            <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
                <fileNamePattern>logs/spring4demo.%d{yyyy-MM-dd}.%i.log</fileNamePattern>
                <maxFileSize>100MB</maxFileSize>
                <maxHistory>30</maxHistory>
                <totalSizeCap>3GB</totalSizeCap>
            </rollingPolicy>
            <encoder>
                <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
            </encoder>
        </appender>
        
        <root level="INFO">
            <appender-ref ref="FILE"/>
        </root>
    </springProfile>
</configuration>
```

## ğŸ”„ é›†æˆè®¾è®¡

### å¤–éƒ¨ç³»ç»Ÿé›†æˆ

#### 1. æ¶ˆæ¯é˜Ÿåˆ—é›†æˆ

**RabbitMQé…ç½®**
```java
@Configuration
@EnableRabbit
public class RabbitConfig {
    
    @Bean
    public TopicExchange userExchange() {
        return new TopicExchange("user.exchange");
    }
    
    @Bean
    public Queue userQueue() {
        return QueueBuilder.durable("user.queue").build();
    }
    
    @Bean
    public Binding userBinding() {
        return BindingBuilder
            .bind(userQueue())
            .to(userExchange())
            .with("user.created");
    }
    
    @Bean
    public RabbitTemplate rabbitTemplate(ConnectionFactory connectionFactory) {
        RabbitTemplate template = new RabbitTemplate(connectionFactory);
        template.setMessageConverter(new Jackson2JsonMessageConverter());
        return template;
    }
}
```

#### 2. æœç´¢å¼•æ“é›†æˆ

**Elasticsearché…ç½®**
```java
@Configuration
@EnableElasticsearchRepositories
public class ElasticsearchConfig {
    
    @Bean
    public ElasticsearchOperations elasticsearchTemplate(ElasticsearchClient client) {
        return new ElasticsearchRestTemplate(client);
    }
    
    @Bean
    public ElasticsearchClient elasticsearchClient() {
        return ElasticsearchClients.createSimple(
            HttpHost.create("http://localhost:9200"));
    }
}
```

#### 3. ç¼“å­˜é›†æˆ

**Redisé…ç½®**
```java
@Configuration
@EnableCaching
public class RedisConfig {
    
    @Bean
    public LettuceConnectionFactory redisConnectionFactory() {
        return new LettuceConnectionFactory(
            new RedisStandaloneConfiguration("localhost", 6379));
    }
    
    @Bean
    public RedisTemplate<String, Object> redisTemplate() {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(redisConnectionFactory());
        template.setKeySerializer(new StringRedisSerializer());
        template.setValueSerializer(new GenericJackson2JsonRedisSerializer());
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(new GenericJackson2JsonRedisSerializer());
        return template;
    }
}
```

## ğŸ“‹ æ¥å£è®¾è®¡

### RESTful APIè®¾è®¡

#### 1. ç”¨æˆ·ç®¡ç†API

```yaml
# ç”¨æˆ·ç®¡ç†APIè§„èŒƒ
/api/v1/users:
  get:
    summary: è·å–ç”¨æˆ·åˆ—è¡¨
    parameters:
      - name: page
        in: query
        type: integer
        default: 0
      - name: size
        in: query
        type: integer
        default: 20
      - name: keyword
        in: query
        type: string
    responses:
      200:
        description: æˆåŠŸè¿”å›ç”¨æˆ·åˆ—è¡¨
        schema:
          type: object
          properties:
            code:
              type: integer
            message:
              type: string
            data:
              type: object
              properties:
                content:
                  type: array
                  items:
                    $ref: '#/definitions/UserDTO'
                totalElements:
                  type: integer
                totalPages:
                  type: integer

  post:
    summary: åˆ›å»ºç”¨æˆ·
    parameters:
      - name: user
        in: body
        required: true
        schema:
          $ref: '#/definitions/CreateUserRequest'
    responses:
      201:
        description: ç”¨æˆ·åˆ›å»ºæˆåŠŸ
        schema:
          $ref: '#/definitions/UserDTO'

/api/v1/users/{id}:
  get:
    summary: è·å–ç”¨æˆ·è¯¦æƒ…
    parameters:
      - name: id
        in: path
        required: true
        type: integer
    responses:
      200:
        description: æˆåŠŸè¿”å›ç”¨æˆ·è¯¦æƒ…
        schema:
          $ref: '#/definitions/UserDTO'

  put:
    summary: æ›´æ–°ç”¨æˆ·
    parameters:
      - name: id
        in: path
        required: true
        type: integer
      - name: user
        in: body
        required: true
        schema:
          $ref: '#/definitions/UpdateUserRequest'
    responses:
      200:
        description: ç”¨æˆ·æ›´æ–°æˆåŠŸ
        schema:
          $ref: '#/definitions/UserDTO'

  delete:
    summary: åˆ é™¤ç”¨æˆ·
    parameters:
      - name: id
        in: path
        required: true
        type: integer
    responses:
      204:
        description: ç”¨æˆ·åˆ é™¤æˆåŠŸ
```

#### 2. å†…å®¹ç®¡ç†API

```yaml
# æ–‡æ¡£ç®¡ç†APIè§„èŒƒ
/api/v1/documents:
  get:
    summary: è·å–æ–‡æ¡£åˆ—è¡¨
    parameters:
      - name: categoryId
        in: query
        type: integer
      - name: status
        in: query
        type: string
        enum: [DRAFT, PUBLISHED, ARCHIVED]
      - name: page
        in: query
        type: integer
        default: 0
      - name: size
        in: query
        type: integer
        default: 20
    responses:
      200:
        description: æˆåŠŸè¿”å›æ–‡æ¡£åˆ—è¡¨
        schema:
          type: object
          properties:
            code:
              type: integer
            message:
              type: string
            data:
              type: object
              properties:
                content:
                  type: array
                  items:
                    $ref: '#/definitions/DocumentDTO'
                totalElements:
                  type: integer

  post:
    summary: åˆ›å»ºæ–‡æ¡£
    parameters:
      - name: document
        in: body
        required: true
        schema:
          $ref: '#/definitions/CreateDocumentRequest'
    responses:
      201:
        description: æ–‡æ¡£åˆ›å»ºæˆåŠŸ
        schema:
          $ref: '#/definitions/DocumentDTO'

/api/v1/documents/{id}:
  get:
    summary: è·å–æ–‡æ¡£è¯¦æƒ…
    parameters:
      - name: id
        in: path
        required: true
        type: integer
    responses:
      200:
        description: æˆåŠŸè¿”å›æ–‡æ¡£è¯¦æƒ…
        schema:
          $ref: '#/definitions/DocumentDTO'

  put:
    summary: æ›´æ–°æ–‡æ¡£
    parameters:
      - name: id
        in: path
        required: true
        type: integer
      - name: document
        in: body
        required: true
        schema:
          $ref: '#/definitions/UpdateDocumentRequest'
    responses:
      200:
        description: æ–‡æ¡£æ›´æ–°æˆåŠŸ
        schema:
          $ref: '#/definitions/DocumentDTO'

/api/v1/documents/{id}/publish:
  post:
    summary: å‘å¸ƒæ–‡æ¡£
    parameters:
      - name: id
        in: path
        required: true
        type: integer
    responses:
      200:
        description: æ–‡æ¡£å‘å¸ƒæˆåŠŸ
        schema:
          $ref: '#/definitions/DocumentDTO'
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•ä½“ç³»è®¾è®¡

#### 1. å•å…ƒæµ‹è¯•

**æµ‹è¯•è¦†ç›–ç‡è¦æ±‚**
- ä»£ç è¦†ç›–ç‡ > 80%
- åˆ†æ”¯è¦†ç›–ç‡ > 70%
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘è¦†ç›–ç‡ > 90%

**æµ‹è¯•ç¤ºä¾‹**
```java
@ExtendWith(MockitoExtension.class)
class UserServiceTest {
    
    @Mock
    private UserRepository userRepository;
    
    @Mock
    private PasswordEncoder passwordEncoder;
    
    @InjectMocks
    private UserServiceImpl userService;
    
    @Test
    @DisplayName("åˆ›å»ºç”¨æˆ· - æˆåŠŸ")
    void createUser_Success() {
        // Given
        CreateUserRequest request = CreateUserRequest.builder()
            .username("testuser")
            .email("test@example.com")
            .password("password123")
            .build();
        
        User savedUser = User.builder()
            .id(1L)
            .username("testuser")
            .email("test@example.com")
            .password("encodedPassword")
            .status(UserStatus.ACTIVE)
            .build();
        
        when(passwordEncoder.encode("password123")).thenReturn("encodedPassword");
        when(userRepository.existsByUsername("testuser")).thenReturn(false);
        when(userRepository.existsByEmail("test@example.com")).thenReturn(false);
        when(userRepository.save(any(User.class))).thenReturn(savedUser);
        
        // When
        UserDTO result = userService.createUser(request);
        
        // Then
        assertThat(result.getId()).isEqualTo(1L);
        assertThat(result.getUsername()).isEqualTo("testuser");
        assertThat(result.getEmail()).isEqualTo("test@example.com");
        
        verify(userRepository).save(any(User.class));
        verify(passwordEncoder).encode("password123");
    }
}
```

#### 2. é›†æˆæµ‹è¯•

**æµ‹è¯•é…ç½®**
```java
@SpringBootTest
@TestPropertySource(properties = {
    "spring.datasource.url=jdbc:h2:mem:testdb",
    "spring.jpa.hibernate.ddl-auto=create-drop"
})
@Transactional
class UserControllerIntegrationTest {
    
    @Autowired
    private TestRestTemplate restTemplate;
    
    @Autowired
    private UserRepository userRepository;
    
    @Test
    @DisplayName("è·å–ç”¨æˆ·åˆ—è¡¨ - é›†æˆæµ‹è¯•")
    void getUserList_Integration() {
        // Given
        User user = User.builder()
            .username("testuser")
            .email("test@example.com")
            .password("password")
            .status(UserStatus.ACTIVE)
            .build();
        userRepository.save(user);
        
        // When
        ResponseEntity<PageResponse<UserDTO>> response = restTemplate.getForEntity(
            "/api/v1/users?page=0&size=10", 
            new ParameterizedTypeReference<PageResponse<UserDTO>>() {});
        
        // Then
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(response.getBody().getContent()).hasSize(1);
        assertThat(response.getBody().getContent().get(0).getUsername()).isEqualTo("testuser");
    }
}
```

#### 3. ç«¯åˆ°ç«¯æµ‹è¯•

**æµ‹è¯•æ¡†æ¶**
```java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@TestMethodOrder(OrderAnnotation.class)
class UserE2ETest {
    
    @Autowired
    private TestRestTemplate restTemplate;
    
    private static Long userId;
    
    @Test
    @Order(1)
    @DisplayName("ç”¨æˆ·æ³¨å†Œç«¯åˆ°ç«¯æµ‹è¯•")
    void registerUser_E2E() {
        // Given
        CreateUserRequest request = CreateUserRequest.builder()
            .username("e2euser")
            .email("e2e@example.com")
            .password("password123")
            .build();
        
        // When
        ResponseEntity<UserDTO> response = restTemplate.postForEntity(
            "/api/v1/users", request, UserDTO.class);
        
        // Then
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.CREATED);
        assertThat(response.getBody().getUsername()).isEqualTo("e2euser");
        
        userId = response.getBody().getId();
    }
    
    @Test
    @Order(2)
    @DisplayName("ç”¨æˆ·ç™»å½•ç«¯åˆ°ç«¯æµ‹è¯•")
    void loginUser_E2E() {
        // Given
        LoginRequest request = LoginRequest.builder()
            .username("e2euser")
            .password("password123")
            .build();
        
        // When
        ResponseEntity<LoginResponse> response = restTemplate.postForEntity(
            "/api/v1/auth/login", request, LoginResponse.class);
        
        // Then
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(response.getBody().getToken()).isNotEmpty();
    }
}
```

---

*æœ¬æ–‡æ¡£ä¸ºç³»ç»Ÿçš„æ¦‚è¦è®¾è®¡ï¼Œæä¾›äº†ç³»ç»Ÿæ¶æ„ã€æ•°æ®åº“è®¾è®¡ã€å®‰å…¨è®¾è®¡ã€æ€§èƒ½è®¾è®¡ç­‰æ ¸å¿ƒå†…å®¹ï¼Œä¸ºè¯¦ç»†è®¾è®¡æä¾›äº†æŒ‡å¯¼ã€‚*